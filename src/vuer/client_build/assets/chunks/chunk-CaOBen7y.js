import{r as d,j as S,z as He}from"./chunk-CF7PZJR8.js";import{b7 as _r,b8 as yr,b9 as Me,ba as Or,bb as Ye,bc as qr,p as br,bd as Q,be as Qe,bf as Pr,bg as Dr,bh as Gr,bi as Oe,H as Br,I as Ur,b as Nr,bj as Lr,bk as $r,bl as pe,U as Jr,bm as wr,bn as Hr,bo as Vr,bp as Wr,bq as Xr,br as Kr,bs as Ve,bt as Yr,bu as Qr,bv as Zr,bw as et,bx as rt,by as tt}from"./chunk-DH1DswfA.js";import nt from"./chunk-wSzcG2rU.js";import{h as B,j as xe,Q as he,aU as at,O as ot,x as Ne,P as vr,a as Le,q as st,X as lt,z as We,cA as it,J as Mr,r as ut,D as Sr,ac as je,b as Ae,c8 as oe,ah as Ee,R as Ce,bq as se,br as le,aw as ie,ax as ct,L as kr,bo as jr,B as mt}from"./chunk-DvrnVFXc.js";import{a as ge,u as ue}from"./chunk-2B0sFjzh.js";import"./chunk-BdvozYt0.js";/* empty css              */import"./chunk-BXl3LOEh.js";import"./chunk-ChHTQ4Sk.js";import"./chunk-BHDKgRpG.js";import"./chunk-Q1j31JH2.js";import"./chunk-SmZMj1n8.js";function q(e,r,t){const n=e.BYTES_PER_ELEMENT||e.byteLength/e.length,i=e.byteOffset+r*n,o=Math.min(t,e.length);return new e.constructor(e.buffer,i,o)}function ne(e,r){const t=q(e,r*3,3);return[t[0],t[2],-t[1]]}function Gn(e,r,t){r[t*3]=e[0],r[t*3+1]=-e[2],r[t*3+2]=-e[1]}function ke(e,r){const t=q(e,r*4,4);return[t[1],t[3],-t[2],t[0]]}function Bn(e,r,t){r[t*4]=e[3],r[t*4+1]=e[0],r[t*4+2]=-e[2],r[t*4+3]=-e[1]}function Un(e,r){const t=q(e,r*9,9);return[t[0],t[3],t[6],t[2],t[5],t[8],-t[1],-t[4],-t[7]]}function ft(e,r,t){const n=r[3*t]-e[3*t],i=r[3*t+2]-e[3*t+2],o=r[3*t+1]-e[3*t+1],l=Math.atan2(i,n),s=Math.atan2(Math.sqrt(n*n+i*i),o);return[l,s,0]}function*ve(e,r,t=1){if(typeof r>"u"&&(r=e,e=0),!(t>0&&e>=r||t<0&&e<=r))for(let n=e;t>0?n<r:n>r;n+=t)yield n}function Ar(e){var r;return((r=e.split("/").pop())==null?void 0:r.split("?")[0].split("#")[0])||""}function $e(e){try{const r=new URL(e);if(r.protocol==="http:"||r.protocol==="https:"){const t=r.pathname.split("/").slice(0,-1);return t.length>1?t.join("/"):"/"}else if(r.protocol==="file:"){const t=r.pathname.split("/").slice(0,-1);return decodeURI(t.join("/"))}else throw new Error("Invalid URL provided: unsupported protocol")}catch{const r=e.replace(/\/+$/,"").split("/");return r.length<=1?"":r.slice(0,-1).join("/")}}function Er(...e){return e.filter(r=>r).map((r,t)=>t===0?r.replace(/\/+$/,""):r.replace(/^\/+/,"")).join("/")}async function pt(e,r,t){const n=await fetch(r),i=t.split("/");let o="";for(let s=0;s<i.length-1;s++)o+=i[s],e.analyzePath(o).exists||e.mkdir(o),o+="/";if(t.endsWith(".urdf")){const s=await n.text(),f=dt(s);e.writeFile(t,f);return}const l=new Uint8Array(await n.arrayBuffer());e.writeFile(t,l)}function dt(e){const r=new DOMParser().parseFromString(e,"application/xml");let t=0;function n(i,o){return t++,`${i}.${o.join(".")}.${t}`}return Array.from(r.getElementsByTagName("link")).forEach((i,o)=>{const l=[String(o+1)];Array.from(i.getElementsByTagName("visual")).forEach((s,f)=>{const y=[...l,String(f)];s.hasAttribute("name")||s.setAttribute("name",n("visual",y)),Array.from(s.getElementsByTagName("geometry")).forEach((x,u)=>{const c=[...y,String(u)];x.hasAttribute("name")||x.setAttribute("name",n("geom",c))})}),Array.from(i.getElementsByTagName("collision")).forEach((s,f)=>{const y=[...l,String(f)];s.hasAttribute("name")||s.setAttribute("name",n("collision",y)),Array.from(s.getElementsByTagName("geometry")).forEach((x,u)=>{const c=[...y,String(u)];x.hasAttribute("name")||x.setAttribute("name",n("geom",c))})})}),new XMLSerializer().serializeToString(r)}function xt(e){let r=e.length;for(let t=0;t<e.length;t++)r=(r<<5)-r+e[t],r|=0;return r}function Ze(e){if(!e||e.length===0)return 0;const r=e.length;let t=r;const n=e[0],i=e[r-1];for(let o=0;o<n.length;o++)t=(t<<5)-t+n.charCodeAt(o),t|=0;if(r>1)for(let o=0;o<i.length;o++)t=(t<<5)-t+i.charCodeAt(o),t|=0;if(r>2){const o=e[r>>1];for(let l=0;l<o.length;l++)t=(t<<5)-t+o.charCodeAt(l),t|=0}return t}async function ht(e,r,t,n){let i={};i=Array.isArray(t)?Object.fromEntries([r,...t].map(o=>[$e(o)+"/"+Ar(o),o])):t||{},await Promise.all(Object.keys(i).map(async o=>{const l=i[o];try{await pt(e,l,Er(n,o))}catch(s){console.error(`Error downloading asset at ${l}:`,s)}})),console.info(`file download complete for ${t?.length||Object.keys(i).length} assets.`)}const Cr=d.createContext(null),gt=({children:e})=>{const[r,t]=d.useState(null);return d.useEffect(()=>{let n=!0;return nt().then(i=>{n&&t(i)}),()=>{n=!1,console.info("removing MuJoCo module!"),t(null)}},[]),r?S.jsx(Cr.Provider,{value:r,children:e}):null},me=()=>{const e=He.useContext(Cr);return e||(console.warn("mujoco has not been initialized. Make sure that you are using MuJoCoProvider, because useMuJoCo must be used within it.",e),null)},Rr=d.createContext(null);function er({src:e,workDir:r="/workspace",assets:t=null,children:n,...i}){const o=me(),[l,s]=d.useState(!1),[f,y]=d.useState(null),x=Array.isArray(t)?Ze(t):Ze(Object.values(t||{}));d.useEffect(()=>{if(!(o!=null&&o.FS))return;let c=!1;return s(!0),y(null),console.log("Downloading assets..."),ht(o.FS,e,t,r).then(()=>{if(c)return;const v=Er(r,$e(e),Ar(e));v&&(console.log("Download complete."),y(v),s(!1))}),()=>{c=!0}},[o?.FS,e,x,r]);const u=d.useMemo(()=>{var c,v;if(l)return{sim:null,dt:null,model:null,state:null,mujoco:o};if(!(o!=null&&o.FS)||!f)return{sim:null,dt:null,model:null,state:null,mujoco:o};const w=$e(f);o.FS.chdir(w),console.log("Creating new MuJoCo instance");const a=new o.Model(f),g=new o.State(a),m=new o.Simulation(a,g),h=(v=(c=a?.getOptions)==null?void 0:c.call(a))==null?void 0:v.timestep;return{sim:m,model:a,dt:h,state:g,mujoco:o}},[o,f,l]);return!u.mujoco||!u.sim?null:S.jsx(Rr.Provider,{value:u,children:n})}const K=()=>{const e=He.useContext(Rr);return(!e.sim||!e.model)&&console.warn(`
    MuJoCo has not been initialized.
    Make sure that you are using MuJoCoProvider, because
    useMuJoCo must be used within a MuJoCoProvider.
    `),e};function rr(e,r,t=null){if(!t&&e.length!==r.length)return!1;for(let n=0;n<Math.min(t||e.length,r.length);n++)if(e[n]!==r[n])return!1;return!0}const _t=e=>`#${e.map(r=>Math.round(r*255).toString(16).padStart(2,"0")).join("")}`,yt=({n:e,ambient:r})=>{const{mjtLightType:t}=me(),{sim:n,model:i}=K(),o=d.useRef(null);return ue(()=>{var l;const s=(l=o.current)==null?void 0:l.children;s&&n.light_xpos.length&&n.light_xdir.length&&s.forEach((f,y)=>{if(!("isLight"in f))return;const x=f,u=ne(n.light_xpos,y),c=ft(n.light_xpos,n.light_xdir,y);x&&(rr(x.position.toArray(),u)?(x.position.set(...u),x.rotation.set(...c)):rr([...x.rotation],c)&&x.rotation.set(...c))})}),S.jsx("group",{ref:o,children:Array.from(ve(0,e)).map((l,s)=>{const f=Array.from(i.light_diffuse.slice(3*s,3*s+3)),y=_t(f),x=i.light_castshadow[s]?{castShadow:!0,"shadow-mapSize-width":1024,"shadow-mapSize-height":1024,"shadow-camera-left":-25,"shadow-camera-right":25,"shadow-camera-top":25,"shadow-camera-bottom":-25}:{};return i.light_type[s]==t.mjLIGHT_DIRECTIONAL?S.jsx(Vr,{_key:`mj-directional-light-${s}`,intensity:1,color:y,...x},s):S.jsx(Wr,{_key:`mj-spot-light-${s}`,intensity:1,color:y,decay:i.light_attenuation[3*s],penumbra:.5,...x},s)})},"lighting-gorup")},bt=/^(left|right)-(index|middle|ring|pinky)-finger-(tip|phalanx-distal|phalanx-intermediate|phalanx-proximal)$/,wt=/^(left|right)-thumb-(tip|phalanx-distal|phalanx-proximal)$/,vt=/^(left|right)-wrist$/,Mt=({id:e,mocapId:r,mocap_pos:t,mocap_quat:n,names:i,onSiteMove:o,showFrame:l=!0,markerScale:s=.1,gizmoScale:f,handleSize:y,handleWireframe:x})=>{const u=ne(t,r[e]),c=ke(n,r[e]),v=i[r[e]],[w,a]=d.useMemo(()=>[new B(...u),new he(...c)],[u,c]),g=d.useMemo(()=>{const M=new xe;return M.compose(new B(...u),new he(...c),new B(1,1,1)),M},[u,c]),m=d.useCallback(M=>{w.setFromMatrixPosition(M),a.setFromRotationMatrix(M);const k=r[e]*3;t[k]=w.x,t[k+1]=-w.z,t[k+2]=w.y;const R=r[e]*4;n[R]=a.w,n[R+1]=a.x,n[R+2]=-a.z,n[R+3]=a.y,o?.({site_id:e})},[o,t,n,r,e,w,a]),h=d.useCallback(({world:M})=>m(M),[m]),b=wr(({mode:M})=>M),p=b==="immersive-ar"||b==="immersive-vr",_=v.endsWith("-relative"),A=_?v.replace("-relative",""):v,j=A.match(bt),z=A.match(wt),D=A.match(vt);let G=null,E=null;if(j){const[,M,k,R]=j;E=`${k}-finger-${R}`,G=M}else if(z){const[,M,k]=z;E=`thumb-${k}`,G=M}else if(D){const[,M]=D;E="wrist",G=M}return E&&G?S.jsx(Xr,{jointName:E,position:u,quaternion:c,hand:G,markerScale:.2*s,relativeTracking:_,onMove:h,showFrame:!0}):p?S.jsx(Kr,{position:u,quaternion:c,showFrame:!0,onMove:h,markerScale:s,handleSize:y,wireframe:x}):S.jsx(yr,{matrix:g,annotations:!0,onDrag:m,scale:f||s,lineWidth:5,disableScaling:!0,visible:!l,depthTest:!1},e)},Tr=({n:e,mocapId:r,mocap_pos:t,mocap_quat:n,names:i,showFrame:o,onMove:l,gizmoScale:s,markerScale:f=1,handleWireframe:y=!1,handleSize:x=.1})=>{const{showMocapFrame:u}=Q("Render",{showMocapFrame:{value:o}},[o]),c=d.useMemo(()=>new Set,[]),v=d.useCallback(w=>{c.add(w.site_id),setTimeout(()=>{if(!c.size){console.log(Tr.name,"async timeout with no dirty mocap");return}const a=[...c];c.clear(),l({mocap_ids:a})},0)},[c,l]);return S.jsx("group",{children:Array.from(ve(0,e)).filter(w=>r[w]>=0).map(w=>S.jsx(Mt,{id:w,_key:`mocap-${w}`,mocapId:r,mocap_pos:t,mocap_quat:n,gizmoScale:s,markerScale:f,handleSize:x,handleWireframe:y,names:i,showFrame:u,onSiteMove:v},`mocap-${w}`))},"mocap-group")};function St({model:e,skinId:r,...t}){const n=e.skin_matid[r],{mjtTextureRole:i}=me(),o=e.mat_texid[n*i.mjNTEXROLE.value+i.mjTEXROLE_RGB.value],{color:l,alpha:s,texture:f}=d.useMemo(()=>{let u,c=new Ae().setRGB(e.skin_rgba[r*4],e.skin_rgba[r*4+1],e.skin_rgba[r*4+2],oe),v=e.geom_rgba[r*4+3];if(n!=-1&&(c=c.setRGB(e.mat_rgba[n*4],e.mat_rgba[n*4+1],e.mat_rgba[n*4+2],oe),v=e.mat_rgba[n*4+3],o!=-1)){const w=e.tex_width[o],a=e.tex_height[o],g=e.tex_adr[o],m=e.tex_data,h=new Uint8Array(w*a*4);for(let p=0;p<w*a;p++)h[p*4]=m[g+p*3],h[p*4+1]=m[g+(p*3+1)],h[p*4+2]=m[g+(p*3+2)],h[p*4+3]=255;if(e.tex_colorspace[o]==1)for(let p=0;p<h.length;p+=4)for(let _=0;_<3;_++){const A=h[p+_]/255;h[p+_]=Math.pow(A,1/2.2)*255}u=new Ee(h,w,a,Ce);const b=e.tex_type[o];switch(b){case 0:u.wrapS=ie,u.wrapT=ie,e.mat_texuniform[n]==1?(console.log("Texture repeat on skin error"),console.assert(!1)):u.repeat.set(e.mat_texrepeat[n*2],e.mat_texrepeat[n*2+1]);break;case 1:u.wrapS=le,u.wrapT=le;break;case 2:u.wrapS=se,u.wrapT=se;break;default:console.warn(`Unsupported texture type: ${b}`)}u.needsUpdate=!0}return{color:c,alpha:v,texture:u}},[r]),{mode:y,wireframe:x}=Q("Render",{mode:{value:"rgb",options:["rgb","depth","normal"]},wireframe:!1});return y==="depth"?S.jsx("meshDepthMaterial",{wireframe:x,transparent:!1,opacity:1,side:2}):y==="normal"?S.jsx("meshNormalMaterial",{wireframe:x,transparent:!1,opacity:1,side:2}):S.jsx("meshPhysicalMaterial",{color:l,ior:1,transparent:s<1,opacity:s,clearcoat:.5,specularIntensity:n!=-1?e.mat_specular[n]:void 0,reflectivity:n!=-1?e.mat_reflectance[n]:void 0,roughness:n!=-1?1-e.mat_shininess[n]:void 0,metalness:n!=-1?.4:void 0,map:f,wireframe:x,...t})}function kt(e){return new Float32Array([-e[0],-e[1],-e[2],e[3]])}function jt(e,r){return new Float32Array([e[3]*r[0]+e[0]*r[3]+e[1]*r[2]-e[2]*r[1],e[3]*r[1]-e[0]*r[2]+e[1]*r[3]+e[2]*r[0],e[3]*r[2]+e[0]*r[1]-e[1]*r[0]+e[2]*r[3],e[3]*r[3]-e[0]*r[0]-e[1]*r[1]-e[2]*r[2]])}function At(e){const r=e[0],t=e[1],n=e[2],i=e[3],o=r+r,l=t+t,s=n+n,f=r*o,y=r*l,x=r*s,u=t*l,c=t*s,v=n*s,w=i*o,a=i*l,g=i*s;return new Float32Array([1-(u+v),y+g,x-a,y-g,1-(f+v),c+w,x+a,c-w,1-(f+u)])}function tr(e,r){return new Float32Array([e[0]*r[0]+e[1]*r[1]+e[2]*r[2],e[3]*r[0]+e[4]*r[1]+e[5]*r[2],e[6]*r[0]+e[7]*r[1]+e[8]*r[2]])}function Et(e,r,t){!e.skin_scenevert||e.skin_scenevert.length!==3*e.nskinvert?e.skin_scenevert=new Float32Array(3*e.nskinvert):e.skin_scenevert.fill(0),!e.skin_normal||e.skin_normal.length!==3*e.nskinvert?e.skin_normal=new Float32Array(3*e.nskinvert):e.skin_normal.fill(0);const n=e.skin_vertadr[t],i=e.skin_scenevert;for(let s=e.skin_boneadr[t];s<e.skin_boneadr[t]+e.skin_bonenum[t];s++){let f=q(e.skin_bonebindpos,3*s,3),y=q(e.skin_bonebindquat,4*s,4),x=e.skin_bonebodyid[s],u=q(r.xquat,4*x,4),c=kt(y),v=jt(u,c),w=At(v),a=tr(w,f);for(let g=0;g<3;g++)a[g]=r.xpos[3*x+g]-a[g];for(let g=e.skin_bonevertadr[s];g<e.skin_bonevertadr[s]+e.skin_bonevertnum[s];g++){let m=e.skin_bonevertid[g],h=e.skin_bonevertweight[g],b=q(e.skin_vert,3*(m+n),3),p=tr(w,b);for(let _=0;_<3;_++)p[_]+=a[_];for(let _=0;_<3;_++)i[3*(m+n)+_]+=h*p[_]}}for(let s=e.skin_faceadr[t];s<e.skin_faceadr[t]+e.skin_facenum[t];s++){let f=e.skin_face[3*s],y=e.skin_face[3*s+1],x=e.skin_face[3*s+2],u=new Float32Array(3),c=new Float32Array(3);for(let w=0;w<3;w++)u[w]=i[3*(y+n)+w]-i[3*(f+n)+w],c[w]=i[3*(x+n)+w]-i[3*(f+n)+w];let v=new Float32Array(3);v[0]=u[1]*c[2]-u[2]*c[1],v[1]=u[2]*c[0]-u[0]*c[2],v[2]=u[0]*c[1]-u[1]*c[0];for(let w=0;w<3;w++)e.skin_normal[3*(f+n)+w]+=v[w],e.skin_normal[3*(y+n)+w]+=v[w],e.skin_normal[3*(x+n)+w]+=v[w]}for(let s=n;s<n+e.skin_vertnum[t];s++){let f=q(e.skin_normal,3*s,3),y=Math.sqrt(f[0]*f[0]+f[1]*f[1]+f[2]*f[2]),x=1/Math.max(1e-6,y);for(let u=0;u<3;u++)e.skin_normal[3*s+u]*=x}if(e.skin_inflate){let s=e.skin_inflate[t];for(let f=n;f<n+e.skin_vertnum[t];f++)for(let y=0;y<3;y++)i[3*f+y]+=s*e.skin_normal[3*f+y]}let o=i;for(let s=0;s<o.length;s+=3){const f=o[s+1];o[s+1]=o[s+2],o[s+2]=-f}let l=e.skin_normal;for(let s=0;s<l.length;s+=3){const f=l[s+1];l[s+1]=l[s+2],l[s+2]=-f}return{face_vertices:o,normal:l}}function Ct({model:e,simulation:r,skinId:t,...n}){const i=d.useRef(null),o=d.useMemo(()=>Uint32Array.from(q(e.skin_face,3*e.skin_faceadr[t],3*e.skin_facenum[t])),[e]),l=d.useMemo(()=>{let s;return e.skin_texcoordadr[t]>=0&&(s=q(e.skin_texcoord,2*e.skin_texcoordadr[t],2*e.skin_vertnum[t])),s},[e]);return ue(()=>{const s=i.current;if(!s)return;const{face_vertices:f,normal:y}=Et(e,r,t);try{s.attributes.position.array.set(f),s.attributes.position.needsUpdate=!0}catch{s.setAttribute("position",new je(new Float32Array(f.length),3))}try{s.attributes.normal.array.set(y),s.attributes.normal.needsUpdate=!0}catch{s.setAttribute("normal",new je(new Float32Array(y.length),3))}}),S.jsxs("bufferGeometry",{ref:i,...n,children:[o!=null&&o.length?S.jsx("bufferAttribute",{attach:"index",array:o,count:o.length,itemSize:1}):null,l!=null&&l.length?S.jsx("bufferAttribute",{attach:"attributes-uv",array:l,count:l.length/2,itemSize:2}):null]})}function Rt({model:e,simulation:r,skinId:t,...n}){return S.jsxs("mesh",{receiveShadow:!0,castShadow:!0,frustumCulled:!1,...n,children:[S.jsx(Ct,{attach:"geometry",model:e,simulation:r,skinId:t}),S.jsx(St,{attach:"material",model:e,skinId:t,...n})]})}function Tt(e,r=!1){const t=e[0].index!==null,n=new Set(Object.keys(e[0].attributes)),i=new Set(Object.keys(e[0].morphAttributes)),o={},l={},s=e[0].morphTargetsRelative,f=new mt;let y=0;for(let x=0;x<e.length;++x){const u=e[x];let c=0;if(t!==(u.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+x+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const v in u.attributes){if(!n.has(v))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+x+'. All geometries must have compatible attributes; make sure "'+v+'" attribute exists among all geometries, or in none of them.'),null;o[v]===void 0&&(o[v]=[]),o[v].push(u.attributes[v]),c++}if(c!==n.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+x+". Make sure all geometries have the same number of attributes."),null;if(s!==u.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+x+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const v in u.morphAttributes){if(!i.has(v))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+x+".  .morphAttributes must be consistent throughout all geometries."),null;l[v]===void 0&&(l[v]=[]),l[v].push(u.morphAttributes[v])}if(r){let v;if(t)v=u.index.count;else if(u.attributes.position!==void 0)v=u.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+x+". The geometry must have either an index or a position attribute"),null;f.addGroup(y,v,x),y+=v}}if(t){let x=0;const u=[];for(let c=0;c<e.length;++c){const v=e[c].index;for(let w=0;w<v.count;++w)u.push(v.getX(w)+x);x+=e[c].attributes.position.count}f.setIndex(u)}for(const x in o){const u=nr(o[x]);if(!u)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+x+" attribute."),null;f.setAttribute(x,u)}for(const x in l){const u=l[x][0].length;if(u===0)break;f.morphAttributes=f.morphAttributes||{},f.morphAttributes[x]=[];for(let c=0;c<u;++c){const v=[];for(let a=0;a<l[x].length;++a)v.push(l[x][a][c]);const w=nr(v);if(!w)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+x+" morphAttribute."),null;f.morphAttributes[x].push(w)}}return f}function nr(e){let r,t,n,i=-1,o=0;for(let y=0;y<e.length;++y){const x=e[y];if(r===void 0&&(r=x.array.constructor),r!==x.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(t===void 0&&(t=x.itemSize),t!==x.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(n===void 0&&(n=x.normalized),n!==x.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(i===-1&&(i=x.gpuType),i!==x.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;o+=x.count*t}const l=new r(o),s=new je(l,t,n);let f=0;for(let y=0;y<e.length;++y){const x=e[y];if(x.isInterleavedBufferAttribute){const u=f/t;for(let c=0,v=x.count;c<v;c++)for(let w=0;w<t;w++){const a=x.getComponent(c,w);s.setComponent(c+u,w,a)}}else l.set(x.array,f);f+=x.count*t}return i!==void 0&&(s.gpuType=i),s}var ar=typeof Float32Array<"u"?Float32Array:Array;function Ft(){var e=new ar(3);return ar!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function we(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e[2]=r[2]+t[2],e}function qe(e,r,t){return e[0]=r[0]-t[0],e[1]=r[1]-t[1],e[2]=r[2]-t[2],e}function zt(e,r){return e[0]=-r[0],e[1]=-r[1],e[2]=-r[2],e}function Pe(e,r){var t=r[0],n=r[1],i=r[2],o=t*t+n*n+i*i;return o>0&&(o=1/Math.sqrt(o)),e[0]=r[0]*o,e[1]=r[1]*o,e[2]=r[2]*o,e}function or(e,r,t){var n=r[0],i=r[1],o=r[2],l=t[0],s=t[1],f=t[2];return e[0]=i*f-o*s,e[1]=o*l-n*f,e[2]=n*s-i*l,e}function De(e,r,t,n){var i=[],o=[];return i[0]=r[0]-t[0],i[1]=r[1]-t[1],i[2]=r[2]-t[2],o[0]=i[0],o[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),o[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),e[0]=o[0]+t[0],e[1]=o[1]+t[1],e[2]=o[2]+t[2],e}(function(){var e=Ft();return function(r,t,n,i,o,l){var s,f;for(t||(t=3),n||(n=0),i?f=Math.min(i*t+n,r.length):f=r.length,s=n;s<f;s+=t)e[0]=r[s],e[1]=r[s+1],e[2]=r[s+2],o(e,e,l),r[s]=e[0],r[s+1]=e[1],r[s+2]=e[2];return r}})();function It({model:e,flexId:r,...t}){const n=e.flex_matid[r],{mjtTextureRole:i}=me(),o=e.mat_texid[n*i.mjNTEXROLE.value+i.mjTEXROLE_RGB.value],{color:l,alpha:s,texture:f}=d.useMemo(()=>{let u,c=new Ae().setRGB(e.flex_rgba[r*4],e.flex_rgba[r*4+1],e.flex_rgba[r*4+2],oe),v=e.geom_rgba[r*4+3];if(n!=-1&&(c=c.setRGB(e.mat_rgba[n*4],e.mat_rgba[n*4+1],e.mat_rgba[n*4+2],oe),v=e.mat_rgba[n*4+3],o!=-1)){const w=e.tex_width[o],a=e.tex_height[o],g=e.tex_adr[o],m=e.tex_data,h=new Uint8Array(w*a*4);for(let p=0;p<w*a;p++)h[p*4]=m[g+p*3],h[p*4+1]=m[g+(p*3+1)],h[p*4+2]=m[g+(p*3+2)],h[p*4+3]=255;if(e.tex_colorspace[o]==1)for(let p=0;p<h.length;p+=4)for(let _=0;_<3;_++){const A=h[p+_]/255;h[p+_]=Math.pow(A,1/2.2)*255}u=new Ee(h,w,a,Ce);const b=e.tex_type[o];switch(b){case 0:u.wrapS=ie,u.wrapT=ie,e.mat_texuniform[n]==1?(console.log("Texture repeat for flex error"),console.assert(!1)):u.repeat.set(e.mat_texrepeat[n*2],e.mat_texrepeat[n*2+1]);break;case 1:u.wrapS=le,u.wrapT=le;break;case 2:u.wrapS=se,u.wrapT=se;break;default:console.warn(`Unsupported texture type: ${b}`)}u.needsUpdate=!0}return{color:c,alpha:v,texture:u}},[r]),{mode:y,wireframe:x}=Q("Render",{mode:{value:"rgb",options:["rgb","depth","normal"]},wireframe:!1});return y==="depth"?S.jsx("meshDepthMaterial",{wireframe:x,transparent:!1,opacity:1,side:2}):y==="normal"?S.jsx("meshNormalMaterial",{wireframe:x,transparent:!1,opacity:1,side:2}):S.jsx("meshPhysicalMaterial",{color:l,ior:1,transparent:s<1,opacity:s,clearcoat:.5,specularIntensity:n!=-1?e.mat_specular[n]:void 0,reflectivity:n!=-1?e.mat_reflectance[n]:void 0,roughness:n!=-1?1-e.mat_shininess[n]:void 0,metalness:n!=-1?.4:void 0,map:f,wireframe:x,...t})}function Ge(e){for(let r=0;r<e.nflex;r++)r==0?e.flex_faceadr[r]=0:e.flex_faceadr[r]=e.flex_faceadr[r-1]+e.flex_facenum[r-1]}function Se(e){let r=0;for(let t=0;t<e.nflex;t++)r+=e.flex_facenum[t];return r}function sr(e,r){if(e.flex_dim[r]==0)e.flex_facenum[r]=0;else if(e.flex_dim[r]==2)e.flex_facenum[r]=2*e.flex_shellnum[r]+2*e.flex_elemnum[r];else{let t=0,n=0,i=1;for(;i!==0;){i=0;for(let o=0;o<e.flex_elemnum[r];o++)e.flex_elemlayer[e.flex_elemadr[r]+o]===n&&i++;t=Math.max(t,i),n++}e.flex_facenum[r]=Math.max(e.flex_shellnum[r],4*t)}}function Ot({model:e,simulation:r,flexId:t,smoothShading:n=!0,...i}){const o=d.useRef(null);let l=e.flex_dim[t];const s=e.flex_texcoordadr[t]>=0?q(e.flex_texcoord,2*e.flex_texcoordadr[t],2*e.nflextexcoord):void 0;if(l===1){const a=d.useRef(null),g=d.useMemo(()=>new Mr(e.flex_radius[t]),[e.flex_radius[t]]),m=d.useMemo(()=>new We(e.flex_radius[t],e.flex_radius[t]),[e.flex_radius[t]]);return ue(()=>{const h=[];for(let p=0;p<e.flex_vertnum[t];p++){const _=3*(e.flex_vertadr[t]+p),A=r.flexvert_xpos[_],j=r.flexvert_xpos[_+2],z=-r.flexvert_xpos[_+1];g.clone().applyMatrix4(new xe().makeTranslation(A,j,z))}for(let p=0;p<e.flex_edgenum[t];p++){const _=e.flex_edgeadr[t]+p,A=e.flex_edge[2*_],j=e.flex_edge[2*_+1],z=3*(e.flex_vertadr[t]+A),D=3*(e.flex_vertadr[t]+j),G=new B(r.flexvert_xpos[z],r.flexvert_xpos[z+2],-r.flexvert_xpos[z+1]),E=new B(r.flexvert_xpos[D],r.flexvert_xpos[D+2],-r.flexvert_xpos[D+1]),M=new B().subVectors(E,G),k=M.length(),R=new B().addVectors(G,E).multiplyScalar(.5);M.normalize();const T=new he().setFromUnitVectors(new B(0,1,0),M),I=new xe().makeScale(1,k,1),C=new xe().makeRotationFromQuaternion(T),P=new xe().makeTranslation(R.x,R.y,R.z).multiply(C).multiply(I),O=m.clone();O.applyMatrix4(P),h.push(O)}const b=Tt(h,!1);a.current&&(a.current.copy(b),a.current.computeVertexNormals())}),S.jsx("bufferGeometry",{ref:a,attach:"geometry",...i})}const f=d.useMemo(()=>{e.flex_facenum||(e.flex_facenum=new Int32Array(e.nflex)),e.flex_facenum[t]==0&&sr(e,t),e.flex_faceused||(e.flex_faceused=new Int32Array(e.nflex));let a=e.flex_facenum[t],g=new Int32Array(3*a),m=0;if(n)if(l==2){for(let h=0;h<e.flex_elemnum[t];h++){const b=q(e.flex_elemtexcoord,e.flex_elemdataadr[t]+h*(l+1),3);g[3*m]=b[0],g[3*m+1]=b[1],g[3*m+2]=b[2],m++,g[3*m]=b[0],g[3*m+1]=b[2],g[3*m+2]=b[1],m++}for(let h=0;h<e.flex_shellnum[t];h++){const b=q(e.flex_shell,e.flex_shelldataadr[t]+h*l,3);g[3*m]=b[0],g[3*m+1]=b[1],g[3*m+2]=b[1],m++,g[3*m]=b[1],g[3*m+1]=b[0],g[3*m+2]=b[0],m++}}else for(let h=0;h<e.flex_shellnum[t];h++){const b=q(e.flex_shell,e.flex_shelldataadr[t]+h*l,3);g[3*m]=b[0],g[3*m+1]=b[1],g[3*m+2]=b[2],m++}else for(let h=0;h<e.flex_elemnum[t];h++)if(l===2||e.flex_elemlayer[e.flex_elemadr[t]+h]==0)if(l==2){const b=q(e.flex_elemtexcoord,e.flex_elemdataadr[t]+h*(l+1),3);g[3*m]=b[0],g[3*m+1]=b[1],g[3*m+2]=b[2],m++,g[3*m]=b[0],g[3*m+1]=b[2],g[3*m+2]=b[1],m++}else{const b=q(e.flex_elemtexcoord,e.flex_elemdataadr[t]+h*(l+1),4);g[3*m]=b[0],g[3*m+1]=b[1],g[3*m+2]=b[2],m++,g[3*m]=b[0],g[3*m+1]=b[2],g[3*m+2]=b[3],m++,g[3*m]=b[0],g[3*m+1]=b[3],g[3*m+2]=b[1],m++,g[3*m]=b[1],g[3*m+1]=b[3],g[3*m+2]=b[2],m++}return e.flex_faceused[t]=m,e.flex_faceused[t]>e.flex_facenum[t]&&(console.log("Too many flex faces"),console.log(e.flex_faceused[t],e.flex_facenum[t])),g},[t]),y=d.useMemo(()=>{if(e.flex_facenum||(e.flex_facenum=new Int32Array(e.nflex)),e.flex_facenum[t]==0&&sr(e,t),!e.flex_scenetexcoord){let h=Se(e);e.flex_scenetexcoord=new Float32Array(6*h)}e.flex_faceadr||(e.flex_faceadr=new Int32Array(e.nflex),Ge(e));let a=e.flex_facenum[t],g=e.flex_texcoordadr[t]>=0?q(e.flex_scenetexcoord,6*e.flex_faceadr[t],6*a):void 0;if(!s)return g;let m=f.length/3;for(let h=0;h<m;h++)for(let b=0;b<3;b++){const p=f[h*3+b];g[h*6+b*2]=s[p*2],g[h*6+b*2+1]=s[p*2+1]}return g},[t,f[0]]);let x=new Float32Array(3),u=new Float32Array(3),c=new Float32Array(3);function v(a,g,m,h){if(a.flex_faceadr||(a.flex_faceadr=new Int32Array(a.nflex),Ge(a)),a.flex_faceused||(a.flex_faceused=new Int32Array(a.nflex)),!a.flex_face){let D=Se(a);a.flex_face=new Float32Array(9*D)}if(!a.flex_normal){let D=Se(a);a.flex_normal=new Float32Array(9*D)}const b=a.flex_radius[m],p=a.flex_facenum[m];let _=q(g.flexvert_xpos,3*a.flex_vertadr[m],3*a.flex_vertnum[m]),A=q(a.flex_face,9*a.flex_faceadr[m],9*p),j=q(a.flex_normal,9*a.flex_faceadr[m],9*p);function z(D,G,E,M){const k=q(_,3*G,3),R=q(_,3*E,3),T=q(_,3*M,3);for(let O=0;O<3;O++)x[O]=R[O]-k[O],u[O]=T[O]-k[O];c[0]=x[1]*u[2]-x[2]*u[1],c[1]=x[2]*u[0]-x[0]*u[2],c[2]=x[0]*u[1]-x[1]*u[0];const I=Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2]);I>0&&(c[0]/=I,c[1]/=I,c[2]/=I);const C=9*D;for(let O=0;O<3;O++)A[C+O]=k[O]+c[O]*b,A[C+3+O]=R[O]+c[O]*b,A[C+6+O]=T[O]+c[O]*b;for(let O=0;O<3;O++)j[C+O]=c[O],j[C+3+O]=c[O],j[C+6+O]=c[O];let P=A[C+1];A[C+1]=A[C+2],A[C+2]=-P,P=A[C+4],A[C+4]=A[C+5],A[C+5]=-P,P=A[C+7],A[C+7]=A[C+8],A[C+8]=-P,P=j[C+1],j[C+1]=j[C+2],j[C+2]=-P,P=j[C+4],j[C+4]=j[C+5],j[C+5]=-P,P=j[C+7],j[C+7]=j[C+8],j[C+8]=-P}for(let D=0;D<p;D++)z(D,h[3*D],h[3*D+1],h[3*D+2]);return{face_vertices:A,normal:j,vertices:_}}function w(a,g,m){if(a.vert_normal?a.vert_normal.fill(0):a.vert_normal=new Float32Array(3*a.flex_vertnum[m]),a.flex_faceadr||(a.flex_faceadr=new Int32Array(a.nflex),Ge(a)),a.flex_faceused||(a.flex_faceused=new Int32Array(a.nflex)),!a.flex_face){let M=Se(a);a.flex_face=new Float32Array(9*M)}if(!a.flex_normal){let M=Se(a);a.flex_normal=new Float32Array(9*M)}let h=a.flex_dim[m],b=q(g.flexvert_xpos,3*a.flex_vertadr[m],3*a.flex_vertnum[m]),p=q(a.flex_face,9*a.flex_faceadr[m],9*a.flex_facenum[m]),_=q(a.flex_normal,9*a.flex_faceadr[m],9*a.flex_facenum[m]),A=a.flex_flatskin[m],j=a.flex_radius[m];function z(M,k,R){const T=q(b,3*M,3),I=q(b,3*k,3),C=q(b,3*R,3);qe(x,I,T),qe(u,C,T),or(c,x,u),Pe(c,c)}function D(M,k,R,T,I){const C=I>0?1:-1;if(A){z(k,R,T);for(let P=0;P<3;P++)_[9*M+3*P]=C*c[0],_[9*M+3*P+1]=C*c[2],_[9*M+3*P+2]=-C*c[1]}else _[9*M]=C*a.vert_normal[3*k],_[9*M+1]=C*a.vert_normal[3*k+2],_[9*M+2]=-C*a.vert_normal[3*k+1],_[9*M+3]=C*a.vert_normal[3*R],_[9*M+4]=C*a.vert_normal[3*R+2],_[9*M+5]=-C*a.vert_normal[3*R+1],_[9*M+6]=C*a.vert_normal[3*T],_[9*M+7]=C*a.vert_normal[3*T+2],_[9*M+8]=-C*a.vert_normal[3*T+1];p[9*M]=b[3*k]+I*a.vert_normal[3*k],p[9*M+1]=b[3*k+2]+I*a.vert_normal[3*k+2],p[9*M+2]=-b[3*k+1]-I*a.vert_normal[3*k+1],p[9*M+3]=b[3*R]+I*a.vert_normal[3*R],p[9*M+4]=b[3*R+2]+I*a.vert_normal[3*R+2],p[9*M+5]=-b[3*R+1]-I*a.vert_normal[3*R+1],p[9*M+6]=b[3*T]+I*a.vert_normal[3*T],p[9*M+7]=b[3*T+2]+I*a.vert_normal[3*T+2],p[9*M+8]=-b[3*T+1]-I*a.vert_normal[3*T+1]}function G(M,k,R,T){const I=q(b,3*k,3),C=q(b,3*R,3);qe(x,C,I),or(c,x,a.vert_normal.subarray(3*R,3*R+3)),Pe(c,c),T<0&&zt(c,c);const P=q(_,9*M,3),O=q(_,9*M+3,3),Z=q(_,9*M+6,3);De(P,c,[0,0,0],Math.PI/2),De(O,c,[0,0,0],Math.PI/2),De(Z,c,[0,0,0],Math.PI/2),p[9*M]=b[3*k]+T*a.vert_normal[3*k],p[9*M+1]=b[3*k+2]+T*a.vert_normal[3*k+2],p[9*M+2]=-b[3*k+1]-T*a.vert_normal[3*k+1],p[9*M+3]=b[3*R]+-T*a.vert_normal[3*R],p[9*M+4]=b[3*R+2]+-T*a.vert_normal[3*R+2],p[9*M+5]=-b[3*R+1]- -T*a.vert_normal[3*R+1],p[9*M+6]=b[3*R]+T*a.vert_normal[3*R],p[9*M+7]=b[3*R+2]+T*a.vert_normal[3*R+2],p[9*M+8]=-b[3*R+1]-T*a.vert_normal[3*R+1]}if(h===2)for(let M=0;M<a.flex_elemnum[m];M++){const k=q(a.flex_elem,a.flex_elemdataadr[m]+M*(h+1),3),R=k[0],T=k[1],I=k[2];z(R,T,I);const C=q(a.vert_normal,3*R,3),P=q(a.vert_normal,3*T,3),O=q(a.vert_normal,3*I,3);we(C,C,c),we(P,P,c),we(O,O,c)}else for(let M=0;M<a.flex_shellnum[m];M++){const k=q(a.flex_shell,a.flex_shelldataadr[m]+M*h,3),R=k[0],T=k[1],I=k[2];z(R,T,I);const C=q(a.vert_normal,3*R,3),P=q(a.vert_normal,3*T,3),O=q(a.vert_normal,3*I,3);we(C,C,c),we(P,P,c),we(O,O,c)}for(let M=0;M<a.flex_vertnum[m];M++){const k=q(a.vert_normal,3*M,3);Pe(k,k)}let E=0;if(h===2)for(let M=0;M<a.flex_elemnum[m];M++){const k=q(a.flex_elem,a.flex_elemdataadr[m]+M*(h+1),3);D(E,k[0],k[1],k[2],j),E++,D(E,k[0],k[2],k[1],-j),E++}else for(let M=0;M<a.flex_shellnum[m];M++){const k=q(a.flex_shell,a.flex_shelldataadr[m]+M*h,3);D(E,k[0],k[1],k[2],j),E++}if(h==2)for(let M=0;M<a.flex_shellnum[m];M++){const k=q(a.flex_shell,a.flex_shelldataadr[m]+M*h,3);G(E,k[0],k[1],j),E++,G(E,k[1],k[0],-j),E++}return a.flex_faceused[m]=E,a.flex_faceused[m]>a.flex_facenum[m]&&(console.log("Too many flex faces"),console.log(a.flex_faceused[m],a.flex_facenum[m])),{face_vertices:p,normal:_}}return ue(()=>{const a=o.current;if(!a)return;const{face_vertices:g,normal:m}=n?w(e,r,t):v(e,r,t,f);try{a.attributes.position.array.set(g),a.attributes.position.needsUpdate=!0}catch{a.setAttribute("position",new je(g,3))}try{a.attributes.normal.array.set(m),a.attributes.normal.needsUpdate=!0}catch{a.setAttribute("normal",new je(m,3))}}),S.jsxs("bufferGeometry",{ref:o,...i,children:[y?S.jsx("bufferAttribute",{attach:"attributes-uv",array:y,count:y.length/2,itemSize:2}):null,"// TODO : Fix this"]})}function qt({model:e,simulation:r,flexId:t,...n}){return S.jsxs("mesh",{receiveShadow:!0,castShadow:!0,frustumCulled:!1,...n,children:[S.jsx(Ot,{attach:"geometry",model:e,simulation:r,flexId:t}),S.jsx(It,{attach:"material",model:e,flexId:t,...n})]})}function lr({size:e,model:r,g:t,texId:n,children:i,...o}){const l=r.geom_dataid[t],s=d.useMemo(()=>{const v=r.mesh_vertnum[l],w=r.mesh_facenum[l],a=q(r.mesh_face,r.mesh_faceadr[l]*3,w*3),g=q(r.mesh_vert,r.mesh_vertadr[l]*3,v*3),m=q(r.mesh_normal,r.mesh_normaladr[l]*3,r.mesh_normalnum[l]*3),h=q(r.mesh_facetexcoord,r.mesh_faceadr[l]*3,w*3),b=q(r.mesh_facenormal,r.mesh_faceadr[l]*3,w*3),p=new Float32Array(v*3),_=new Float32Array(v*2),A=new Float32Array(v*3),j=q(r.mesh_texcoord,r.mesh_texcoordadr[l]*2,r.mesh_texcoordnum[l]*2);for(let z=0;z<w;z++)for(let D=0;D<3;D++){const G=z*3+D,E=a[G],M=h[G],k=b[G];p[E*3]=g[E*3],p[E*3+1]=g[E*3+2],p[E*3+2]=-g[E*3+1],A[E*3]=m[k*3],A[E*3+1]=m[k*3+2],A[E*3+2]=-m[k*3+1],_[E*2]=j[M*2],_[E*2+1]=j[M*2+1]}return{faces:Uint32Array.from(a),vertices:p,normals:A,uvs:_}},[t,l]),{faces:f,vertices:y,normals:x,uvs:u}=s||{},c=d.useRef(null);return d.useLayoutEffect(()=>{var v;(v=c.current)==null||v.computeVertexNormals()},[]),S.jsxs("mesh",{...o,children:[S.jsxs("bufferGeometry",{ref:c,children:[f!=null&&f.length?S.jsx("bufferAttribute",{attach:"index",array:f,count:f.length,itemSize:1}):null,y!=null&&y.length?S.jsx("bufferAttribute",{attach:"attributes-position",array:y,count:y.length/3,itemSize:3}):null,x!=null&&x.length?S.jsx("bufferAttribute",{attach:"attributes-normal",array:x,count:x.length/3,itemSize:3}):null,u!=null&&u.length?S.jsx("bufferAttribute",{attach:"attributes-uv",array:u,count:u.length/2,itemSize:2}):null]}),i]})}const Pt=({dataId:e,...r})=>{const t=d.useRef(null),{model:n}=K(),i=e,{nrow:o,ncol:l,data:s,size:f}=d.useMemo(()=>{const u=n.hfield_nrow[i],c=n.hfield_ncol[i],v=n.hfield_adr[i],w=u*c,a=n.hfield_data.subarray(v,v+w),g=n.hfield_size.subarray(i*4,i*4+4);return{nrow:u,ncol:c,data:a,size:g}},[n,i]),y=d.useMemo(()=>{const u=new vr(f[0]*2,f[1]*2,l-1,o-1);for(let c=0;c<u.attributes.position.count;c++){const v=c%l,w=Math.floor(c/l),a=s[w*l+v]*f[2],g=u.attributes.position.getX(c),m=u.attributes.position.getY(c);u.attributes.position.setXYZ(c,g,a,m)}return u.computeVertexNormals(),u},[o,l,s,f]),x=d.useMemo(()=>new ct({color:"#5577aa"}),[]);return S.jsx("mesh",{ref:t,geometry:y,material:x,...r})},Te={0:Lt,1:Pt,2:Dt,3:Bt,4:Gt,5:Ut,6:Nt,7:lr,8:lr,"*":$t};function Dt({size:e,model:r,g:t,textId:n,...i}){return S.jsx(Ve,{args:[e[0]],...i})}function Gt({size:e,model:r,g:t,textId:n,...i}){return S.jsx(Ve,{args:[e[0]],scale:[1,e[2]/e[0],e[1]/e[0]],...i})}function Bt({size:e,model:r,g:t,textId:n,...i}){return S.jsx(Zr,{args:[e[0],e[1]*2,20,20],...i})}function Ut({size:e,model:r,g:t,textId:n,...i}){return S.jsx(Qr,{args:[e[0],e[0],e[1]*2],...i})}function Nt({size:e,model:r,g:t,textId:n,...i}){return S.jsx(Yr,{args:[e[0]*2,e[2]*2,e[1]*2],...i})}function Lt({size:e,model:r,g:t,textId:n,...i}){const o=d.useRef(null);d.useLayoutEffect(()=>{var s;const f=o.current.geometry;return(s=f.rotateX)==null||s.call(f,Math.PI/2),()=>{var y;(y=f.rotateX)==null||y.call(f,-Math.PI/2)}},[]);const l=d.useMemo(()=>{if(Math.min(...e)<=0)return[100,100,1,1];{let s=e[0]*2,f=e[1]*2;return[s,f,1,1]}},[e]);return S.jsx(et,{ref:o,args:l,...i})}function $t({size:e,model:r,g:t,textId:n,...i}){return S.jsx(Ve,{args:[1],...i})}function Jt({model:e,g:r,matId:t,texId:n,...i}){const{mjtGeom:o}=me(),{color:l,alpha:s,texture:f}=d.useMemo(()=>{let u,c=new Ae().setRGB(e.geom_rgba[r*4],e.geom_rgba[r*4+1],e.geom_rgba[r*4+2],oe),v=e.geom_rgba[r*4+3];if(t!=-1&&(c=c.setRGB(e.mat_rgba[t*4],e.mat_rgba[t*4+1],e.mat_rgba[t*4+2],oe),v=e.mat_rgba[t*4+3],n!=-1)){let w=e.geom_size[r*3],a=e.geom_size[r*3+1],g=e.geom_size[r*3+2];e.geom_type[r]===o.mjGEOM_PLANE.value&&(w<=0||a<=0||g<=0)&&(w=100,a=100);const m=e.tex_width[n],h=e.tex_height[n],b=e.tex_adr[n],p=e.tex_data,_=new Uint8Array(m*h*4);for(let j=0;j<m*h;j++)_[j*4]=p[b+j*3],_[j*4+1]=p[b+(j*3+1)],_[j*4+2]=p[b+(j*3+2)],_[j*4+3]=255;if(e.tex_colorspace[n]==1)for(let j=0;j<_.length;j+=4)for(let z=0;z<3;z++){const D=_[j+z]/255;_[j+z]=Math.pow(D,1/2.2)*255}u=new Ee(_,m,h,Ce),u.magFilter=kr,u.minFilter=jr,u.generateMipmaps=!0;const A=e.tex_type[n];switch(A){case 0:u.wrapS=ie,u.wrapT=ie,e.mat_texuniform[t]==1?u.repeat.set(w*e.mat_texrepeat[t*2],a*e.mat_texrepeat[t*2+1]):u.repeat.set(e.mat_texrepeat[t*2],e.mat_texrepeat[t*2+1]);break;case 1:u.wrapS=le,u.wrapT=le;break;case 2:u.wrapS=se,u.wrapT=se;break;default:console.warn(`Unsupported texture type: ${A}`)}u.needsUpdate=!0}return{color:c,alpha:v,texture:u}},[r,t,n]),{mode:y,wireframe:x}=Q("Render",{mode:{value:"rgb",options:["rgb","depth","normal"]},wireframe:!1},[]);return y==="depth"?S.jsx("meshDepthMaterial",{wireframe:x,transparent:!1,opacity:1,side:2}):y==="normal"?S.jsx("meshNormalMaterial",{wireframe:x,transparent:!1,opacity:1,side:2}):S.jsx("meshPhysicalMaterial",{color:l,ior:1,transparent:s<1,opacity:s,clearcoat:.5,specularIntensity:t!=-1?e.mat_specular[t]:void 0,reflectivity:t!=-1?e.mat_reflectance[t]:void 0,roughness:t!=-1?1-e.mat_shininess[t]:void 0,metalness:t!=-1?.4:void 0,map:f,wireframe:x,...i})}function Ht(e,r){return[r[e*3],r[e*3+1],r[e*3+2]]}function Vt({size:e,type:r,index:t,children:n,...i}){const o=Te[r]||Te["*"],{mjtTextureRole:l}=me(),{model:s}=K(),f=s.geom_matid[t],y=s.mat_texid[f*l.mjNTEXROLE.value+l.mjTEXROLE_RGB.value];return S.jsxs(o,{castShadow:!0,receiveShadow:!0,size:e,model:s,g:t,texId:y,depthWrite:!0,depthTest:!0,frustumCulled:!0,...i,children:[S.jsx(Jt,{attach:"material",model:s,g:t,matId:f,texId:y,side:Sr}),n]})}function Wt({model:e,g:r,matId:t,texId:n,...i}){const{mjtGeom:o}=me(),{color:l,alpha:s,texture:f}=d.useMemo(()=>{let u,c=new Ae().setRGB(e.site_rgba[r*4],e.site_rgba[r*4+1],e.site_rgba[r*4+2],oe),v=e.site_rgba[r*4+3];if(t!=-1&&(c=c.setRGB(e.mat_rgba[t*4],e.mat_rgba[t*4+1],e.mat_rgba[t*4+2],oe),v=e.mat_rgba[t*4+3],n!=-1)){let w=e.site_size[r*3],a=e.site_size[r*3+1],g=e.site_size[r*3+2];e.site_type[r]===o.mjGEOM_PLANE.value&&(w<=0||a<=0||g<=0)&&(w=100,a=100);const m=e.tex_width[n],h=e.tex_height[n],b=e.tex_adr[n],p=e.tex_data,_=new Uint8Array(m*h*4);for(let j=0;j<m*h;j++)_[j*4]=p[b+j*3],_[j*4+1]=p[b+(j*3+1)],_[j*4+2]=p[b+(j*3+2)],_[j*4+3]=255;if(e.tex_colorspace[n]==1)for(let j=0;j<_.length;j+=4)for(let z=0;z<3;z++){const D=_[j+z]/255;_[j+z]=Math.pow(D,1/2.2)*255}u=new Ee(_,m,h,Ce),u.magFilter=kr,u.minFilter=jr;const A=e.tex_type[n];switch(A){case 0:u.wrapS=ie,u.wrapT=ie,e.mat_texuniform[t]==1?u.repeat.set(w*e.mat_texrepeat[t*2],a*e.mat_texrepeat[t*2+1]):u.repeat.set(e.mat_texrepeat[t*2],e.mat_texrepeat[t*2+1]);break;case 1:u.wrapS=le,u.wrapT=le;break;case 2:u.wrapS=se,u.wrapT=se;break;default:console.warn(`Unsupported texture type: ${A}`)}u.needsUpdate=!0}return{color:c,alpha:v,texture:u}},[r,t,n]),{mode:y,wireframe:x}=Q("Render",{mode:{value:"rgb",options:["rgb","depth","normal"]},wireframe:!1});return y==="depth"?S.jsx("meshDepthMaterial",{wireframe:x,transparent:!1,opacity:1,side:2}):y==="normal"?S.jsx("meshNormalMaterial",{wireframe:x,transparent:!1,opacity:1,side:2}):S.jsx("meshStandardMaterial",{color:l,ior:1,transparent:s<1,opacity:s,clearcoat:.5,roughness:t!=-1?1-e.mat_shininess[t]:void 0,metalness:t!=-1?.4:void 0,map:f,wireframe:x,...i})}function Xt(e,r){return[r[e*3],r[e*3+1],r[e*3+2]]}function ir({size:e,type:r,index:t,children:n,...i}){const o=Te[r]||Te["*"],{mjtTextureRole:l}=me(),{model:s}=K(),f=s.site_matid[t],y=s.mat_texid[f*l.mjNTEXROLE.value+l.mjTEXROLE_RGB.value];return S.jsxs(o,{castShadow:!0,receiveShadow:!0,size:e,model:s,g:t,texId:y,...i,children:[S.jsx(Wt,{attach:"material",model:s,g:t,matId:f,texId:y,side:Sr}),n]})}const Be=new Set;function Fe(){const{sim:e,model:r}=K()||{},t=d.useCallback(l=>(Be.add(l),()=>{Be.delete(l)}),[]),n=d.useCallback(()=>{if(e&&r){for(let l=0;l<e.qfrc_applied.length;l++)e.qfrc_applied[l]=0;for(let l=0;l<e.xfrc_applied.length;l++)e.xfrc_applied[l]=0}Be.forEach(l=>l())},[e,r]),i=l=>new B(l.x,-l.z,l.y),o=d.useCallback(({pullPos:l,anchorPos:s,scale:f=10,bodyId:y})=>{if(!e||!r)return;const x=ne(e.xpos,y),u=new B(...x),c=l.clone().sub(u),v=(r.body_mass[y]||1)*f,w=c.multiplyScalar(v),a=i(w),g=i(s||u);e.applyForce(a.x,a.y,a.z,0,0,0,g.x,g.y,g.z,y);const m=new B(e.xpos[y*3+0],e.xpos[y*3+1],e.xpos[y*3+2]),h=new B(g.x-m.x,g.y-m.y,g.z-m.z).clone().cross(a),b=y*6;e.xfrc_applied[b+0]=a.x,e.xfrc_applied[b+1]=a.y,e.xfrc_applied[b+2]=a.z,e.xfrc_applied[b+3]=h.x,e.xfrc_applied[b+4]=h.y,e.xfrc_applied[b+5]=h.z},[e,r]);return[t,n,o]}const Fr=d.createContext(null);function ur({dragForceScale:e=1,showArrow:r=!0,showForceText:t=!0,arrowColor:n=16711680,arrowOpacity:i=.5,enabled:o=!0,onDragStart:l,onDragEnd:s,onVisualizationUpdate:f,children:y}){const{gl:x,scene:u,camera:c,controls:v,raycaster:w}=ge(),{sim:a,model:g}=K()||{},[m]=Fe(),h=wr(F=>F.mode),b=h==="immersive-ar"||h==="immersive-vr",p=d.useRef(!1),_=d.useRef(null),A=d.useRef(null),j=d.useRef(null),z=d.useRef(!1),D=d.useRef(0),G=d.useRef(null),E=d.useRef(null),M=d.useRef(new B),k=d.useRef(new B),R=d.useRef(new B),T=d.useRef(null),I=d.useRef(null),C=d.useRef(null),P=d.useRef(!0),O=d.useRef(null),Z=d.useRef(null),[fe,J]=d.useState(!1),[ee,re]=d.useState(""),L=d.useRef(null);d.useEffect(()=>{if(!r)return;const F=new lt,N=new We(.005,.005,1,32),H=new Ne({color:n,transparent:!0,opacity:i}),V=new Le(N,H);I.current=V,V.position.set(0,.5,0);const X=new it(.02,.05,32),W=new Ne({color:n,transparent:!0,opacity:i}),ae=new Le(X,W);return C.current=ae,ae.position.set(0,1,0),F.add(V),F.add(ae),F.visible=!1,u.add(F),T.current=F,()=>{T.current&&(u.remove(T.current),T.current=null),I.current=null,C.current=null}},[u,r,n,i]);const Y=F=>{var N;if(!o||!a||!g||!b&&!F.altKey||G.current!==null)return;G.current=F.pointerId,(N=F.target)==null||N.setPointerCapture(F.pointerId);const H=F.point,V=F.object,X=F.eventObject,W=X.userData.bodyId;!V||!(V instanceof ut)||W<=0||(v&&"enabled"in v&&(P.current=v.enabled,v.enabled=!1),z.current=!0,p.current=!0,D.current=F.distance,_.current=X,A.current=V,j.current=W,M.current.copy(V.worldToLocal(H.clone())),k.current.copy(H),R.current.copy(H),T.current&&(T.current.position.copy(H),T.current.visible=!0),l?.(W),E.current=m(ye))},_e=F=>{if(!p.current||!A.current||G.current!==F.pointerId)return;const N=F.ray.origin.clone();N.addScaledVector(F.ray.direction,D.current),R.current.copy(N),$()},U=F=>{var N;G.current===F.pointerId&&(G.current=null,(N=F.target)==null||N.releasePointerCapture(F.pointerId),z.current=!1,p.current=!1,_.current=null,A.current=null,j.current=null,O.current=null,Z.current=null,v&&"enabled"in v&&(v.enabled=P.current),T.current&&(T.current.visible=!1),L.current&&(L.current.visible=!1),E.current&&(E.current(),E.current=null),s?.())},$=()=>{if(!A.current||!T.current||!I.current||!C.current)return;T.current.position.copy(k.current);const F=R.current.clone().sub(k.current),N=F.length(),H=F.clone().normalize();f?.({currentWorldPoint:R.current.clone(),worldHitPoint:k.current.clone(),length:N,direction:F.clone(),normalizedDirection:H.clone()});const V=I.current,X=C.current;V&&(V.scale.set(1,N,1),V.position.set(0,N/2,0)),X&&X.position.set(0,N,0),T.current.setRotationFromQuaternion(new he().setFromUnitVectors(new B(0,1,0),H)),L.current&&(L.current.position.copy(R.current),L.current.visible=!0)},ce=d.useCallback(()=>{if(!A.current||!a||!g||!p.current||!j.current)return;const F=j.current,N=g.body_mass[F]||1,H=R.current.clone().sub(k.current);let V=N*100*e;const X=H.multiplyScalar(V),W=te(X),ae=te(k.current);O.current=W,Z.current=F,a.applyForce(W.x,W.y,W.z,0,0,0,ae.x,ae.y,ae.z,F);const ze=new B(a.xpos[F*3+0],a.xpos[F*3+1],a.xpos[F*3+2]),Ie=new B(ae.x-ze.x,ae.y-ze.y,ae.z-ze.z).clone().cross(W),be=F*6;a.xfrc_applied[be+0]=W.x,a.xfrc_applied[be+1]=W.y,a.xfrc_applied[be+2]=W.z,a.xfrc_applied[be+3]=Ie.x,a.xfrc_applied[be+4]=Ie.y,a.xfrc_applied[be+5]=Ie.z},[A,a,g,e,p]),te=F=>new B(F.x,-F.z,F.y),de=d.useCallback(()=>{if(a&&g&&!(!p.current||!A.current||!j.current)){if(_.current){const F=j.current,N=ne(a.xpos,F),H=ke(a.xquat,F);_.current.position.set(...N),_.current.quaternion.set(...H),_.current.updateWorldMatrix(!0,!0)}k.current.copy(M.current),A.current.localToWorld(k.current)}},[a,g,p,A,M,k]),ye=d.useCallback(()=>{if(!(!p.current||!A.current)&&(de(),ce(),$(),O.current)){const F=O.current,N=F.x.toFixed(2),H=F.y.toFixed(2),V=F.z.toFixed(2),X=`|F|: ${F.length().toFixed(2)} N
Fx: ${N}
Fy: ${H}
Fz: ${V}`;re(X),J(!0),L.current&&L.current.quaternion.copy(c.quaternion)}},[de,ce,$,c]);ue(()=>{p.current||(J(!1),re(""))});const Re=d.useMemo(()=>({dragging:p,selectedPhysicsObject:A,computeForce:de,applyForce:ce,updateForce:ye,startDragVr:Y,updateDragVr:_e,endDragVr:U}),[p,A,de,ce,ye]);return S.jsxs(Fr.Provider,{value:Re,children:[y,t&&S.jsx(_r,{ref:L,position:[0,0,0],fontSize:.05,color:"white",anchorX:"center",anchorY:"middle",visible:fe,"material-depthTest":!1,"material-depthWrite":!1,renderOrder:999,children:ee})]})}const Xe=()=>d.useContext(Fr),Kt=({model:e,sim:r,visible:t,showSites:n,showSiteFrame:i,siteFrameScale:o=.01})=>{const l=d.useRef(null),{startDragVr:s,updateDragVr:f,endDragVr:y}=Xe(),{showSiteFrame:x,showSites:u,siteFrameScale:c}=Q("Render.Sites",{showSites:{value:n},showSiteFrame:{value:i},siteFrameScale:{value:o,min:.001,max:.1,step:1e-4}},[n,i]);return ue(()=>{var v,w;(w=(v=l?.current)==null?void 0:v.children)==null||w.forEach((a,g)=>{const m=ne(r.xpos,g),h=ke(r.xquat,g);a.position.set(...m),a.quaternion.set(...h)})}),S.jsx("group",{ref:l,children:e?.nbody&&Array.from(ve(0,e.nbody)).map((v,w)=>{const a=e.body_geomadr[w],g=a+e.body_geomnum[w],m=Array.from(e.site_bodyid).map((h,b)=>h===w?b:-1).filter(h=>h>=0);return S.jsxs("group",{ref:l,userData:{isDraggable:!0,bodyId:w},onPointerDown:s,onPointerMove:f,onPointerUp:y,children:[Array.from(ve(a,g)).map(h=>{const b=Ht(h,e.geom_size),p=e.geom_type[h],_=ne(e.geom_pos,h),A=ke(e.geom_quat,h),j=e.geom_group[h],z=e.geom_dataid[h];if(t?.includes(j))return S.jsx(Vt,{size:b,type:p,index:h,dataId:z,position:_,quaternion:A},h)}),u&&m.length>=0&&m.map(h=>{const b=Xt(h,e.site_size),p=e.site_type[h],_=ne(e.site_pos,h),A=ke(e.site_quat,h);return x?S.jsx(ir,{type:p,size:b,index:h,position:_,quaternion:A,children:S.jsx(Hr,{scale:c},"frame-"+h)},h):S.jsx(ir,{type:p,size:b,index:h,position:_,quaternion:A},h)})]},w)})},"robot")};function cr({model:e,tendonId:r,...t}){const n=e.tendon_matid[r],{mjtTextureRole:i}=me(),o=e.mat_texid[n*i.mjNTEXROLE.value+i.mjTEXROLE_RGB.value],{color:l,alpha:s,texture:f}=d.useMemo(()=>{let u,c=new Ae().setRGB(e.tendon_rgba[r*4],e.tendon_rgba[r*4+1],e.tendon_rgba[r*4+2],oe),v=e.tendon_rgba[r*4+3];if(n!=-1&&(c=c.setRGB(e.mat_rgba[n*4],e.mat_rgba[n*4+1],e.mat_rgba[n*4+2],oe),v=e.mat_rgba[n*4+3],o!=-1)){const w=e.tex_width[o],a=e.tex_height[o],g=e.tex_adr[o],m=e.tex_data,h=new Uint8Array(w*a*4);for(let p=0;p<w*a;p++)h[p*4]=m[g+p*3],h[p*4+1]=m[g+(p*3+1)],h[p*4+2]=m[g+(p*3+2)],h[p*4+3]=255;if(e.tex_colorspace[o]==1)for(let p=0;p<h.length;p+=4)for(let _=0;_<3;_++){const A=h[p+_]/255;h[p+_]=Math.pow(A,1/2.2)*255}u=new Ee(h,w,a,Ce);const b=e.tex_type[o];switch(b){case 0:u.wrapS=ie,u.wrapT=ie,u.repeat.set(e.mat_texrepeat[n*2],e.mat_texrepeat[n*2+1]);break;case 1:u.wrapS=le,u.wrapT=le;break;case 2:u.wrapS=se,u.wrapT=se;break;default:console.warn(`Unsupported texture type: ${b}`)}u.needsUpdate=!0}return{color:c,alpha:v,texture:u}},[r]),{mode:y,wireframe:x}=Q("Render",{mode:{value:"rgb",options:["rgb","depth","normal"]},wireframe:!1});return y==="depth"?S.jsx("meshDepthMaterial",{wireframe:x,transparent:!1,opacity:1,side:2}):y==="normal"?S.jsx("meshNormalMaterial",{wireframe:x,transparent:!1,opacity:1,side:2}):S.jsx("meshPhysicalMaterial",{color:l,ior:1,transparent:s<1,opacity:s,clearcoat:.5,specularIntensity:n!=-1?e.mat_specular[n]:void 0,reflectivity:n!=-1?e.mat_reflectance[n]:void 0,roughness:n!=-1?1-e.mat_shininess[n]:void 0,metalness:n!=-1?.4:void 0,map:f,wireframe:x,...t})}function Yt({model:e,sim:r}){const t=d.useMemo(()=>new We(1,1,1),[]),n=d.useMemo(()=>new Mr(1,8,8),[]);return S.jsx(S.Fragment,{children:Array.from({length:e.ntendon}).map((i,o)=>S.jsx(Qt,{model:e,sim:r,tendonId:o,cylinderGeometry:t,sphereGeometry:n},o))})}function Qt({model:e,sim:r,tendonId:t,cylinderGeometry:n,sphereGeometry:i}){const o=d.useRef(null),l=d.useRef(null),s=d.useMemo(()=>new xe,[]),f=d.useMemo(()=>new B,[]),y=d.useMemo(()=>new B,[]),x=d.useMemo(()=>new B,[]),u=d.useMemo(()=>new B,[]),c=d.useMemo(()=>new he,[]),v=d.useMemo(()=>new he,[]);return ue(()=>{if(!o.current||!l.current)return;let w=0;const a=r.ten_wrapadr[t],g=e.tendon_width[t];for(let m=a;m<a+r.ten_wrapnum[t]-1;m++){f.fromArray(ne(r.wrap_xpos,m)),y.fromArray(ne(r.wrap_xpos,m+1));const h=f.lengthSq()>1e-4,b=y.lengthSq()>1e-4;if(h&&(u.set(g,g,g),s.compose(f,v,u),l.current.setMatrixAt(w,s)),b&&(u.set(g,g,g),s.compose(y,v,u),l.current.setMatrixAt(w+1,s)),h&&b){x.addVectors(f,y).multiplyScalar(.5);const p=y.clone().sub(f).normalize();c.setFromUnitVectors(new B(0,1,0),p);const _=f.distanceTo(y);u.set(g,_,g),s.compose(x,c,u),o.current.setMatrixAt(w,s),w++}}o.current.count=w,l.current.count=w>0?w+1:0,o.current.visible=!0,l.current.visible=!0,o.current.instanceMatrix.needsUpdate=!0,l.current.instanceMatrix.needsUpdate=!0}),S.jsxs("group",{children:[S.jsx("instancedMesh",{ref:o,args:[n,void 0,256],castShadow:!0,receiveShadow:!0,frustumCulled:!1,children:S.jsx(cr,{model:e,tendonId:t})}),S.jsx("instancedMesh",{ref:l,args:[i,void 0,256],castShadow:!0,receiveShadow:!0,frustumCulled:!1,children:S.jsx(cr,{model:e,tendonId:t})})]})}function Ke(e,r){const t={};return r.split(" ").forEach(n=>{e!=null&&e[n]&&(t[n]=Array.from(e[n]))}),t}const mr=d.forwardRef(({_key:e="",position:r,rotation:t,scale:n,frameKeys:i,visible:o,onLoad:l,useLights:s=!0,useMocap:f=!0,showMocapFrame:y=!0,showSites:x=!0,showSiteFrame:u=!0,onMocapMove:c,mocapMarkerScale:v=.1,mocapGizmoScale:w,mocapHandleSize:a=.1,mocapHandleWireframe:g=!1,children:m,...h},b)=>{const{sim:p,model:_,state:A,mujoco:j}=K()||{};function z(M,k){const R=new TextDecoder("utf-8"),T=M.name_bodyadr[k],I=M.names.indexOf(0,T);return R.decode(M.names.subarray(T,I))}const D=d.useMemo(()=>{if(!_||!_.body_mocapid)return[];const M=[];for(let k=0;k<_.nbody;k++){const R=_.body_mocapid[k];R>=0&&(M[R]=z(_,k))}return M},[_]);d.useEffect(()=>{const M=()=>{p?.resetData(),p?.forward()};b&&(b.current={sim:p,model:_,state:A,mujoco:j,reset:M})},[b,p,_,A,j]);const G=He.useRef(null),E=h||{};return d.useEffect(()=>{p&&E.qpos&&p.qpos.set(E.qpos),p&&E.qvel&&p.qvel.set(E.qvel)},[p,E.qpos,E.qvel]),d.useEffect(()=>{p&&E.act&&p.act.set(E.act)},[p,E.act]),d.useEffect(()=>{p&&E.ctrl&&p.ctrl.set(E.ctrl)},[p,E.ctrl]),d.useEffect(()=>{p&&E.mocap_pos&&p.mocap_pos.set(E.mocap_pos),p&&E.mocap_quat&&p.mocap_quat.set(E.mocap_quat)},[p,E.mocap_pos,E.mocap_quat]),d.useEffect(()=>{p&&p.forward()},[p,E.qpos,E.qvel,E.act,E.ctrl,E.mocap_pos,E.mocap_quat]),d.useEffect(()=>{if(!_||!p||!l)return;const M=Ke(p,i);l(M)},[_,p]),!p||!_?null:S.jsxs("group",{position:r,rotation:t,scale:n,children:[S.jsx("group",{ref:G,children:S.jsx(Kt,{model:_,sim:p,visible:o,showSites:x,showSiteFrame:u})},"robot"),_?.nskin&&Array.from(ve(0,_.nskin)).map((M,k)=>S.jsx(Rt,{name:`skin-${k}`,model:_,simulation:p,skinId:k},`skin-${k}`)),_?.nflex&&Array.from(ve(0,_.nflex)).map((M,k)=>S.jsx(qt,{name:`Flex-${k}`,model:_,simulation:p,flexId:k,smoothShading:!0},`flex-${k}`)),_?.ntendon&&S.jsx(Yt,{model:_,sim:p}),s&&S.jsx(yt,{n:_.nlight,ambient:_.light_ambient}),f&&S.jsx(Tr,{n:_.nbody,mocapId:_.body_mocapid,mocap_pos:p.mocap_pos,mocap_quat:p.mocap_quat,onMove:c,names:D,showFrame:y,markerScale:v,gizmoScale:w,handleSize:a,handleWireframe:g}),m]})});function Zt(e){const[r,t]=d.useState(e),n=d.useRef(r);return[r,i=>{const o=i instanceof Function?i(n.current):i;n.current=o,t(o)},n]}function en(e){if(!(e!=null&&e.length))return[];const r=new Set(e.sort());return Array.from(r)}const fr=({visible:e=[0,1,2],onChange:r})=>{const{model:t}=K()||{},n=en(Object.values(t.geom_group)),i=Q("Render.Groups",Object.fromEntries(n.map(o=>{let l=!1;return e!=null&&e.includes(o)&&(l=!0),[`${o}`,{value:l,label:`geom group ${o}`}]})),[n.join(",")]);return d.useEffect(()=>{const o=n.filter((l,s)=>typeof i[`${l}`]>"u"||!!i[`${l}`]);r?.({visible:o})},[i]),null};function rn(e,r,t=[]){const n=d.useRef(null),i=d.useRef(e),o=d.useRef(performance.now()),l=d.useRef(null);return d.useEffect(()=>{l.current=r},[r]),d.useEffect(()=>{i.current=e},[e]),d.useEffect(()=>{o.current=performance.now()},[typeof r=="number",r<=0]),d.useEffect(()=>{const s=()=>{if(l.current<=0){o.current=performance.now();return}const f=performance.now(),y=f-o.current;o.current=f,i!=null&&i.current&&i.current(y)};if(l.current>0){const f=setInterval(s,l.current);return n.current=f,()=>clearInterval(f)}},[r,e,...t]),n}function zr(e){const r=d.useRef(e);return d.useEffect(()=>{r.current=e},[e]),r}function tn(e){return[...e].reduce((r,t)=>r+Math.abs(t),0)/e.length}function pr({fps:e=60,speed:r=1,pause:t=!1,pauseThreshold:n=.001,timeoutRef:i,timeoutSteps:o=5,onFrame:l,onStep:s,onTimeout:f,frameKeys:y="name time qpos mocap_pos mocap_quat site_xpos geom_xpos sensordata"}){const{sim:x,model:u,dt:c}=K(),v=ge(j=>j.invalidate),{updateForce:w,dragging:a}=Xe(),[g,m]=Fe();d.useEffect(()=>{if(!(!x||!u))return g(w)},[x,u]);const h=zr(t),b=d.useMemo(()=>1/e/r,[e,r]),p=d.useRef(0),_=d.useRef(0),A=d.useCallback(j=>{if(!(!u||!x||!r)){if(j>1500){console.warn(`${j}ms has elapsed. If this persists, something is wrong. Skipping simulation.`),p.current=0,_.current=0;return}if(!h.current){for(p.current+=j*r;_.current<b;)x.step(),m(),_.current+=c;if(_.current,_.current%=b,_.current&&v(),tn(x.qvel||[])<n&&!a.current?(i.current-=1,i.current||f==null||f(!0)):i.current=o,l){const z=Ke(x,y);l(z,_.current)}}}},[x,u,c,b,e,r,t,l,s,h,n,i,o,a,m,v,y,f]);return rn(A,1e3*b,[A]),null}function dr({fps:e=60,speed:r=1,frameKeys:t="",onFrame:n,uplink:i,downlink:o}){const{sim:l,model:s,dt:f}=K(),y=ge(a=>a.invalidate),{updateForce:x}=Xe(),[u,c]=Fe();d.useEffect(()=>{if(!(!l||!s))return u(x)},[l,s]);const v=d.useMemo(()=>{if(!f)return 1;const a=1/e/r;return Math.max(1,Math.floor(a/f))},[f,e,r]),w=d.useCallback(({key:a,rtype:g,data:{act:m,ctrl:h,sim_steps:b,xfrc_applied:p,qfrc_applied:_,xfrc:A,xfrc_bodyId:j,qpos:z,qvel:D}})=>{if(!l||!s)return;if(z&&z.length>0&&l.qpos.set(z),D&&D.length>0&&l.qvel.set(D),m&&m.length>0&&l.act.set(m),h&&h.length>0&&l.ctrl.set(h),p&&p.length>0&&l.xfrc_applied.set(p),_&&_.length>0&&l.qfrc_applied.set(_),typeof A<"u"&&typeof j<"u"){const E=ne(l.xpos,j),M=[...A,0,0,0,0,0,0].slice(0,6);l.applyForce(...M,...E,j)}const G=b??v;for(let E=0;E<G;E++)l.step(),c();if(G===0&&(l.forward(),c(),y()),n){const E=Ke(l,t);n(E,f),i?.publish({ts:Date.now()/1e3,etype:g||"MJ_STEP_RESPONSE",value:{dt:G*f,keyFrame:E}})}},[l,s,i,v,f,y,c,t,n]);return d.useEffect(()=>{if(o)return o.subscribe("MJ_STEP",w)},[o,w]),null}function nn(e,r=[]){const[t,n]=d.useState(e);return d.useEffect(()=>n(e),r),[t,n]}const Je={FREE:0,BALL:1,SLIDE:2,HINGE:3};function Ir(e,r,t){const n=new TextDecoder("utf-8"),i=r[t],o=e.names.indexOf(0,i);return n.decode(e.names.subarray(i,o))}function an(e){const r=[];for(let t=0;t<e.njnt;t++){const n=e.jnt_type[t];if(n===Je.FREE||n===Je.BALL)continue;const i=Ir(e,e.name_jntadr,t),o=e.jnt_limited[t]!==0,l=o?e.jnt_range[t*2]:-Math.PI,s=o?e.jnt_range[t*2+1]:Math.PI;r.push({name:i,type:n,qposAdr:e.jnt_qposadr[t],hasLimits:o,lower:l,upper:s})}return r}function on(e){const r=[];for(let t=0;t<e.nu;t++){const n=Ir(e,e.name_actuatoradr,t),i=e.actuator_ctrllimited[t]!==0,o=i?e.actuator_ctrlrange[t*2]:-1,l=i?e.actuator_ctrlrange[t*2+1]:1;r.push({name:n,hasLimits:i,lower:o,upper:l})}return r}function sn(e){const r="Joint Positions (qpos)";return e.map(t=>({name:`qpos_${t.name}`,label:t.name,grouping:r,dtype:"number",labelPosition:"left",min:t.lower,max:t.upper,step:t.type===Je.SLIDE?.001:.01}))}function ln(e){const r="Controls (ctrl)";return e.map((t,n)=>({name:`ctrl_${n}_${t.name}`,label:t.name||`ctrl[${n}]`,grouping:r,dtype:"number",labelPosition:"left",min:t.lower,max:t.upper,step:.01}))}function un(e){return d.useMemo(()=>{if(!e)return{joints:[],actuators:[],qposSchemas:[],ctrlSchemas:[],groups:[]};const r=an(e),t=on(e),n=sn(r),i=ln(t),o=[];return n.length>0&&o.push({name:"Joint (qpos)",layout:"grid",gridCols:1}),i.length>0&&o.push({name:"Controls (ctrl)",layout:"grid",gridCols:1}),{joints:r,actuators:t,qposSchemas:n,ctrlSchemas:i,groups:o}},[e])}function cn(e,r={}){const{wait:t=1e3,leading:n=!1,trailing:i=!0,maxWait:o}=r,l=d.useRef(e),s=d.useRef(null),f=d.useRef(null),y=d.useRef(null),x=d.useRef(null),u=d.useRef(!1);d.useEffect(()=>{l.current=e},[e]);const c=d.useCallback(()=>{y.current!==null&&(l.current(...y.current),y.current=null,x.current=null,u.current=!1)},[]),v=d.useCallback(()=>{s.current&&(clearTimeout(s.current),s.current=null),f.current&&(clearTimeout(f.current),f.current=null),y.current=null,x.current=null,u.current=!1},[]),w=d.useCallback(()=>{s.current&&(clearTimeout(s.current),s.current=null),f.current&&(clearTimeout(f.current),f.current=null),c()},[c]),a=d.useCallback((...g)=>{const m=Date.now();y.current=g,n&&!u.current&&(u.current=!0,l.current(...g),y.current=null,x.current=m),s.current&&clearTimeout(s.current),i&&(s.current=setTimeout(()=>{s.current=null,f.current&&(clearTimeout(f.current),f.current=null),c()},t)),o!==void 0&&!f.current&&(x.current=m,f.current=setTimeout(()=>{f.current=null,s.current&&(clearTimeout(s.current),s.current=null),c()},o))},[t,n,i,o,c]);return d.useEffect(()=>()=>{v()},[v]),{run:a,cancel:v,flush:w}}function xr({nodeKey:e,onCtrlChange:r}){const{sim:t,model:n}=K(),i=ge(g=>g.invalidate),o=Nr(),l=o.ops,{actuators:s,ctrlSchemas:f,groups:y}=un(n),x=d.useMemo(()=>y.filter(g=>g.name==="Controls (ctrl)"),[y]),u=d.useMemo(()=>{if(!t||!s.length)return f;const g=Array.from(t.ctrl);return f.map((m,h)=>({...m,value:g[h]??0}))},[f,s,t]),c=d.useRef(!1),{run:v}=cn(g=>{l.update({etype:"UPDATE",ts:Date.now()/1e3,data:{nodes:[{key:e,ctrl:g}]}})},{wait:150,maxWait:500,trailing:!0}),{set:w,get:a}=Lr(e,{schemas:u,groups:x},{tags:[e],enabled:!!t&&!!n&&u.length>0,persist:!1,reactive:!1,onChange:(g,m,h,b)=>{if(!c.current&&typeof m=="number"&&g.startsWith("ctrl_")){const p=g.slice(5).split("_"),_=parseInt(p[0],10);if(!isNaN(_)&&_<s.length){const A=t?Array.from(t.ctrl):new Array(s.length).fill(0);A[_]=m,t&&(t.ctrl.set(A),i()),v(A),r?.()}}}},[u,x,t,s,v,r,i]);return d.useEffect(()=>{if(!t||!w||s.length===0)return;const g=l.getNode(e),m=g?.ctrl;if(m){c.current=!0;for(let h=0;h<s.length&&h<m.length;h++){const b=`ctrl_${h}_${s[h].name}`;a(b)!==m[h]&&w(b,m[h])}c.current=!1}},[o,e,l,s,w,a,t]),null}const mn=[0,1,2],fn=({_ref:e,_key:r="mujoco-default",position:t,rotation:n,scale:i,src:o="",assets:l=[],workDir:s="/workspace",selfProvide:f=!0,timeout:y,threshold:x=.001,fps:u=60,speed:c=1,pause:v=!1,frameKeys:w="name time qpos mocap_pos mocap_quat site_xpos geom_xpos sensordata",visible:a=mn,useDrag:g=!0,unpauseOnDrag:m=!0,dragForceScale:h=1,showDragArrow:b=!0,showDragForceText:p=!0,useLights:_=!0,useMocap:A=!0,mocapGizmoScale:j,mocapHandleSize:z,mocapMarkerScale:D,mocapHandleWireframe:G,children:E,...M})=>{const{uplink:k,downlink:R}=br(),[T,I,C]=Zt(v),P=Br(),O=Ur(),Z=ge(F=>F.invalidate),{fps:fe,speed:J,paused:ee,recording:re}=O||{paused:!1},L=d.useCallback(F=>{k?.publish({ts:Date.now()/1e3,etype:"ON_MUJOCO_LOAD",value:{keyFrame:F}})},[k]),Y=d.useCallback((F,N)=>k?.publish({ts:Date.now()/1e3,etype:"ON_MUJOCO_FRAME",value:{dt:N,keyFrame:F}}),[Z,k]);d.useEffect(()=>{const F=({ts:V,value:X})=>{var W;P&&P!=null&&P.isRecording&&P?.addKeyFrame(Jr([{key:r,tag:"MuJoCo",...X?.keyFrame}],"children",((W=X?.keyFrame)==null?void 0:W.time)||Date.now()))},N=k.subscribe("ON_MUJOCO_FRAME",F),H=k.subscribe("ON_MUJOCO_STEPPING",F);return()=>{N(),H()}},[P,k,r]);const _e=d.useCallback((F,N)=>k?.publish({ts:Date.now()/1e3,etype:"ON_MUJOCO_STEPPING",value:{dt:N,keyFrame:F},silent:!0}),[Z,k]),U=xt(a),[$,ce]=nn({visible:a},[U]),te=zr(y),de=d.useCallback(()=>{te.current=y,m&&I?.(!1)},[m,I]),ye=d.useCallback(F=>{te.current=y,C.current&&I(!1)},[C,I]),Re=d.useCallback(()=>{te.current=y,C.current&&I(!1)},[I,y,C]);return f?S.jsx(gt,{children:S.jsx(er,{src:o,assets:l,workDir:s,children:S.jsxs(ur,{enabled:g,onDragStart:de,dragForceScale:h,showArrow:b,showForceText:p,children:[S.jsxs(mr,{_key:r,position:t,rotation:n,scale:i,frameKeys:w,onLoad:L,...$,useLights:_,useMocap:A,onMocapMove:ye,mocapGizmoScale:j,mocapHandleSize:z,mocapMarkerScale:D,mocapHandleWireframe:G,...M,children:[E,S.jsx(fr,{...$,onChange:ce},`gctrl-${r}`)]},r),S.jsx(pr,{fps:u||fe,speed:c||J,pause:T,timeoutRef:te,timeoutSteps:y,frameKeys:w,onFrame:Y,onTimeout:I}),S.jsx(dr,{fps:u,speed:c,frameKeys:w,onFrame:_e,uplink:k,downlink:R}),S.jsx(xr,{nodeKey:r,onCtrlChange:Re})]})})},r):S.jsx(er,{src:o,assets:l,workDir:s,children:S.jsxs(ur,{enabled:g,onDragStart:de,children:[S.jsxs(mr,{_key:r,position:t,rotation:n,scale:i,frameKeys:w,onLoad:L,...$,useLights:_,useMocap:A,onMocapMove:ye,mocapGizmoScale:j,mocapHandleSize:z,mocapMarkerScale:D,mocapHandleWireframe:G,...M,children:[E,S.jsx(fr,{...$,onChange:ce},`gctrl-${r}`)]},r),S.jsx(pr,{fps:u||fe,speed:c||J,pause:T,timeoutRef:te,timeoutSteps:y,frameKeys:w,onFrame:Y,onTimeout:I}),S.jsx(dr,{fps:u,speed:c,frameKeys:w,onFrame:_e,uplink:k,downlink:R}),S.jsx(xr,{nodeKey:r,onCtrlChange:Re})]})})};function pn(e,r,t){return e=Math.max(r,e),e=Math.min(t,e),e}const dn=({ctrlId:e=-1,offset:r=.01,low:t=.01,high:n=1,cond:i="right-squeeze",value:o="right:thumb-tip,right:index-finger-tip",scale:l=1})=>{const{sim:s,model:f}=K()||{};ue(()=>{var y,x,u;if(!Me.leftLandmarks&&!Me.rightLandmarks)return;const[c,v]=o.split(","),[w,a]=c.split(":"),[g,m]=v.split(":"),h=(y=Me[`${w}Landmarks`])==null?void 0:y[a],b=(x=Me[`${g}Landmarks`])==null?void 0:x[m];if(!h||!b)return;const[p,_]=i.split("-");if(!((u=Me)!=null&&u[p][_]))return;const A=Or(Ye(h),Ye(b))-r,j=pn(A*l,t,n),z=[...s.ctrl];e=(z.length+e)%z.length,z[e]=j,s.ctrl.set(z)})};function xn(e,r,t){return e=Math.max(r,e),e=Math.min(t,e),e}const hn=({ctrlId:e=-1,offset:r=0,low:t=0,high:n=.2,cond:i="right-trigger",scale:o=1})=>{const{sim:l}=K()||{};return ue(()=>{if(!l||!Oe.left&&!Oe.right)return;const[s,f]=i.split("-"),y=Oe[s];if(!y)return;const x=1-y[`${f}Value`]-r,u=xn(x*o,t,n),c=[...l.ctrl];e=(c.length+e)%c.length,c[e]=u,l.ctrl.set(c)}),null},gn=(e=!1)=>{const[r,t,n]=d.useMemo(()=>{if(e)return[null,null,null];const i=new ot(-1,1,1,-1,0,1),o=new Ne,l=new vr(2,2),s=new Le(l,o),f=new st;return f.add(s),[f,o,i]},[]);return d.useCallback(({renderer:i,texture:o})=>{var l;t&&(t.map!==o&&((l=t.map)==null||l.dispose(),t.map=o,t.needsUpdate=!0),i.setRenderTarget(null),i.render(r,n))},[e])};async function _n({renderer:e,quality:r}){const t=e.getContext(),n=e.domElement.width,i=e.domElement.height,o=new Uint8Array(n*i*4);return t.readPixels(0,0,n,i,t.RGBA,t.UNSIGNED_BYTE,o),await(await e.domElement.convertToBlob({quality:r,type:"image/jpeg"})).arrayBuffer().then(l=>new Uint8Array(l))}function yn({_ref:e,_key:r,hide:t,width:n=640,height:i=480,matrix:o,fov:l=60,top:s=1,bottom:f=-1,left:y=-1,right:x=1,near:u=.1,far:c=20,renderDepth:v=!1,distanceToCamera:w=.5,ctype:a="perspective",scale:g=10,fps:m=30,downsample:h=2,quality:b=1,showCameraFrustum:p=!0,movable:_=!0,movableScale:A=1,children:j=[],...z}){var D;const G=d.useRef(null),E=d.useRef(null),M=d.useRef(null),{size:k,camera:R,scene:T}=ge(),I=window.devicePixelRatio||1,C=qr(n*I,i*I,v?{depthBuffer:!0}:{}),{sendMsg:P,downlink:O,uplink:Z}=br(),fe=d.useCallback(()=>{if(!M.current||!G.current)return;const U=G.current,$=M.current;U.matrix.copy($.matrix),U.matrix.decompose(U.position,U.quaternion,U.scale),U.rotation.setFromQuaternion(U.quaternion),P({ts:Date.now()/1e3,etype:"CAMERA_MOVE",key:r,value:{matrix:U.matrix.toArray()}})},[M.current,G.current,P]),J=Q(r?`Mujoco.Camera-${r}`:"Mujoco.Camera",{showCameraFrustum:{value:p,label:"ShowFrustum"},camType:{value:a,options:["perspective","orthographic"]}}),ee=Q(r?`Mujoco.Camera-${r}`:"Mujoco.Camera",{near:{value:u,min:.001,step:.05},far:{value:c,min:.1,step:.1},scale:{value:g,min:.1,step:.1}},[u,c]),re=Q(r?`Mujoco.Camera-${r}`:"Mujoco.Camera",J.camType==="perspective"?{fov:{value:l,min:0,max:170},aspect:{value:n/i,min:.1,max:10}}:{},[J.camType,l,n,i]),L=Q(r?`Mujoco.Camera-${r}`:"Mujoco.Camera",J.camType==="orthographic"?{top:{value:s,min:-10,step:.1},bottom:{value:f,min:-10,step:.1},left:{value:y,min:-10,step:.1},right:{value:x,min:-10,step:.1}}:{},[J.camType,s,f,y,x]),Y=d.useMemo(()=>{const U=new at({canvas:new OffscreenCanvas(n/h,i/h),antialias:!1,precision:"highp",preserveDrawingBuffer:!0,depth:!0});return U.autoClear=!1,U.setPixelRatio(I),U},[I,i,n,h]);d.useEffect(()=>{let U;J.camType==="perspective"?U=re.aspect:U=(L.right-L.left)/(L.top-L.bottom),G.current.aspect=U,G.current.updateProjectionMatrix(),Y.setSize(Math.floor(U*i/h),Math.floor(i/h),!1),Y.setPixelRatio(I),C.setSize(U*i*I,i*I)},[I,i,n,h,re.aspect,L.top,L.bottom,L.left,L.right,J.camType]),d.useLayoutEffect(()=>{if(!G.current||!o||o.length!==16)return;const U=G.current;U.matrix.fromArray(o),U.matrix.decompose(U.position,U.quaternion,U.scale),U.rotation.setFromQuaternion(U.quaternion);const $=_?M?.current:E?.current;$&&($.matrix.fromArray(o),$.matrix.decompose($.position,$.quaternion,$.scale),$.rotation.setFromQuaternion($.quaternion))},[o,(D=G.current)==null?void 0:D.uuid]);const _e=gn();return d.useEffect(()=>{if(O)return O.subscribe("MJ_RENDER",async({key:U,rtype:$,data:{quality:ce=1}})=>{if(!G.current||U!==r)return;Y.setRenderTarget(C),Y.render(T,G.current);const te={ts:Date.now()/1e3,etype:$||"MJ_RENDER_RESPONSE",key:U,value:{dpr:I,width:n,height:i}};_e({renderer:Y,texture:C.texture}),te.value.frame=await _n({renderer:Y,quality:ce}),P(te)})},[P,O,Z,h,Y,Y.domElement,C]),t?null:S.jsxs(S.Fragment,{children:[J.showCameraFrustum&&!_?S.jsx(Qe,{_ref:E,...re,...ee,showFocalPlane:!1,...z,children:j}):null,J.showCameraFrustum&&_?S.jsxs(Pr,{_ref:M,onMove:fe,matrix:o,scale:A,...z,children:[S.jsx(Qe,{_ref:E,scale:1/A,...re,...ee,showFocalPlane:!1}),j]}):null,J.camType==="perspective"?S.jsx(Dr,{ref:G,near:ee.near,far:ee.far,...re,...z}):null,J.camType==="orthographic"?S.jsx(Gr,{ref:G,near:ee.near,far:ee.far,...L,...z}):null]})}function bn(e){const r=d.useMemo(()=>new B,[]),t=Array.isArray(e)?e[0]:e.x,n=Array.isArray(e)?e[1]:e.y,i=Array.isArray(e)?e[2]:e.z;d.useMemo(()=>{Array.isArray(e)?r.set(e[0],e[1],e[2]):r.copy(e)},[r,t,n,i]);const o=d.useCallback(l=>{Array.isArray(l)?r.set(l[0],l[1],l[2]):r.copy(l)},[r]);return[r,o]}const hr=e=>new B(e.x,-e.z,e.y),wn=({_key:e,bodyId:r,enabled:t=!0,scale:n=20,forceDestination:i=[1,1,1],showForceVector:o=!1,showForceText:l=!1,showPivotControls:s=!0})=>{let f;try{f=K()}catch(R){return console.warn("AnchorActuator: Error accessing MuJoCo context:",R),null}if(!f)return console.warn("AnchorActuator: Must be used within MuJoCoProvider"),null;const{sim:y,model:x}=f,{camera:u}=ge(),[c]=Fe(),[v,w]=bn(i),[a,g]=d.useState(new B),[m,h]=d.useState(new B),[b,p]=d.useState(!1),[_,A]=d.useState(""),j=d.useRef(null),z=d.useCallback(()=>{if(!t||!y||!x||r<=0||r>=x.nbody)return;const R=ne(y.xpos,r),T=new B(...R),I=v.clone().sub(T).multiplyScalar(n),C=hr(I),P=hr(T);if(y.applyForce(C.x,C.y,C.z,0,0,0,P.x,P.y,P.z,r),o||l){const O=new B(P.x,P.z,-P.y),Z=O.clone().add(new B(C.x,C.z,-C.y).multiplyScalar(.01));if(o&&(g(O),h(Z)),l){const fe=C.x.toFixed(2),J=C.y.toFixed(2),ee=C.z.toFixed(2),re=`|F|: ${C.length().toFixed(2)} N
Fx: ${fe}
Fy: ${J}
Fz: ${ee}`;A(re),p(!0)}}},[t,y,x,r,v,n,o,l]),D=d.useMemo(()=>{const R=new xe;return R.makeTranslation(v.x,v.y,v.z),R},[v]),G=R=>{const T=new B;T.setFromMatrixPosition(R),w(T)};d.useEffect(()=>{if(!(!t||!y||!x))return c(z)},[t,y,x,z,c]);const E=d.useMemo(()=>{const R=m.clone().sub(a);return R.length()>0?R.normalize():new B(0,1,0)},[a.x,a.y,a.z,m.x,m.y,m.z]),M=d.useMemo(()=>m.distanceTo(a),[a.x,a.y,a.z,m.x,m.y,m.z]),k=d.useMemo(()=>{const R=new he;return R.setFromUnitVectors(new B(0,1,0),E),R},[E]);return ue(()=>{j.current&&b&&j.current.quaternion.copy(u.quaternion)}),S.jsxs(S.Fragment,{children:[o&&M>0&&S.jsxs("group",{position:a,quaternion:k,children:[S.jsxs("mesh",{position:[0,M/2,0],children:[S.jsx("cylinderGeometry",{args:[.005,.005,M,8]}),S.jsx("meshBasicMaterial",{color:"red",transparent:!0,opacity:.7})]}),S.jsxs("mesh",{position:[0,M,0],children:[S.jsx("coneGeometry",{args:[.02,.05,8]}),S.jsx("meshBasicMaterial",{color:"red",transparent:!0,opacity:.7})]})]}),l&&S.jsx(_r,{ref:j,position:m,fontSize:.05,color:"white",anchorX:"center",anchorY:"middle",visible:b,"material-depthTest":!1,"material-depthWrite":!1,renderOrder:999,children:_}),s&&S.jsx(yr,{matrix:D,onDrag:G,scale:.5,lineWidth:2,annotations:!0,depthTest:!1})]})},gr="0.0.98",Ue="@vuer-ai/vuer",vn="e4f6283";function Mn({className:e,packageName:r,packageFullName:t,versionText:n,linkable:i=!0,gitHash:o}){const l=t&&n?`https://www.npmjs.com/package/${t}/v/${n.replace("v","")}`:void 0;return S.jsxs("div",{className:`rounded-uk-xs rounded-r-uk-xs text-uk-sm bg-icon-withbg inline-flex items-center ${e||""}`,style:i?{cursor:"pointer"}:void 0,children:[(r||n)&&S.jsxs("div",{className:"rounded-uk-xs inline-flex items-center overflow-hidden",children:[r&&S.jsx("span",{className:"pl-sm pr-xs py-xxxs bg-brand-primary text-text-withbg text-uk-xs",style:{backgroundColor:"var(--color-brand-primary, var(--brand-primary))",color:"white",textShadow:"0 1px 2px rgba(0, 0, 0, 0.3), inset 0 -1px 0 rgba(255, 255, 255, 0.1)"},children:r}),n&&S.jsx("a",{href:i&&l?l:void 0,className:["pl-xs pr-sm py-xxxs rounded-r-uk-xs","bg-alt-primary","text-text-secondary","text-text-primary text-uk-xs",i&&"hover:text-brand-primary"].join(" "),style:{textShadow:"0 1px 1px rgba(0, 0, 0, 0.2), inset 0 -1px 0 rgba(255, 255, 255, 0.05)"},onClick:i?void 0:s=>s.preventDefault(),children:n})]}),o&&o!=="unknown"&&S.jsxs("a",{href:i?`https://github.com/vuer-ai/mujoco-ts/commit/${o}`:void 0,className:"px-md rounded-uk-ssx font-number-input text-text-tertiary text-uk-xs ml-[0px] bg-transparent py-[0px]",onClick:i?void 0:s=>s.preventDefault(),children:[S.jsx($r,{className:"mr-[2px] inline-block size-2"}),o]})]})}function Sn({className:e,package:r=!1,prefix:t=!1,linkable:n=!1,version:i=!1,hash:o=!1}){const l=Ue.split("/").pop()||Ue,s=i?t?`v${gr}`:gr:void 0;return S.jsx(Mn,{className:e,packageName:r?l:void 0,packageFullName:Ue,versionText:s,linkable:n,gitHash:o?vn:void 0})}const kn=[{component:"MuJoCo",schemas:[{name:"selfProvide",dtype:"boolean",grouping:"General",value:!0},{name:"timeout",dtype:"number",min:0,max:300,step:1,grouping:"General"},{name:"threshold",dtype:"number",min:0,max:1,step:.001,grouping:"General",value:.001},{name:"fps",dtype:"number",min:1,max:120,step:1,grouping:"Simulation",value:60},{name:"speed",dtype:"number",min:.1,max:10,step:.1,grouping:"Simulation",value:1},{name:"pause",dtype:"boolean",grouping:"Simulation",value:!1},{name:"visible",dtype:"array",arrayElementType:"number",colSpan:2,grouping:"Simulation",value:[0,1,2]},{name:"frameKeys",dtype:"string",colSpan:2,grouping:"Simulation",value:"name time qpos mocap_pos mocap_quat site_xpos geom_xpos sensordata"},{name:"useDrag",dtype:"boolean",grouping:"Drag",value:!0},{name:"unpauseOnDrag",dtype:"boolean",grouping:"Drag",value:!0},{name:"dragForceScale",dtype:"number",min:.1,max:10,step:.1,grouping:"Drag",value:1},{name:"showDragArrow",dtype:"boolean",grouping:"Drag",value:!0},{name:"showDragForceText",dtype:"boolean",grouping:"Drag",value:!0},{name:"useLights",dtype:"boolean",grouping:"Mocap",value:!0},{name:"useMocap",dtype:"boolean",grouping:"Mocap",value:!0},{name:"mocapGizmoScale",dtype:"number",min:.1,max:5,step:.1,grouping:"Mocap"},{name:"mocapHandleSize",dtype:"number",grouping:"Mocap"},{name:"mocapMarkerScale",dtype:"number",min:.1,max:5,step:.1,grouping:"Mocap"},{name:"mocapHandleWireframe",dtype:"boolean",grouping:"Mocap"},{name:"position",dtype:"vector3",step:.001,grouping:"transform"},{name:"rotation",dtype:"vector3",step:.001,grouping:"transform"},{name:"scale",dtype:"vector3",default:[1,1,1],min:-1e3,max:1e3,step:.001,grouping:"transform",value:[1,1,1]},{name:"quaternion",dtype:"quaternion",step:.001,grouping:"transform"}],description:`Represents the MuJoCo component within the Vuer application, facilitating the simulation and visualization of MuJoCo models.
This component is responsible for emitting frame update events (\`ON_MUJOCO_FRAME\`) to synchronize the simulation state across the application.

Configures the MuJoCo simulation's behavior based on the playback's interaction state.

The simulation's pause state and speed are dynamically adjusted to reflect the playback's
current actionrecording, playing back, both, or neither. This ensures the simulation
accurately represents the desired scenario, with physics appropriately enabled or disabled.`,groups:[{name:"General",gridCols:2,groupOrder:0},{name:"Simulation",gridCols:2,groupOrder:1},{name:"Drag",gridCols:2,groupOrder:2},{name:"Mocap",gridCols:2,groupOrder:3},{name:"transform",gridCols:3}]}];kn.forEach(e=>{rt.push(e)});const Nn="name time qpos qvel act ctrl mocap_pos mocap_quat site_xpos site_xmat geom_xpos geom_xmat sensordata qfrc_applied xfrc_applied",jn=(e=!1)=>{if(pe.MuJoCo){if(console.warn("MuJoCo already registered:"),!e)return;console.info("Force reload MuJoCo module.")}pe.MuJoCo=fn,pe.HandActuator=dn,pe.MotionControllerActuator=hn,pe.MjCameraView=yn,pe.AnchorActuator=wn,pe.MjBadge=Sn,console.info("vuer-mujoco registered:",pe)};tt["@vuer-ai/mujoco-ts"]=jn;export{Nn as ALL_KEYFRAME_KEYS,wn as AnchorActuator,vn as GIT_HASH,dn as HandActuator,Je as MJT_JOINT,kn as MUJOCO_SCHEMAS,Sn as MjBadge,yn as MjCameraView,hn as MotionControllerActuator,fn as MuJoCo,xr as MuJoCoDialControls,mr as MuJoCoModel,Cr as MuJoCoModuleContext,gt as MuJoCoModuleProvider,er as MuJoCoProvider,gr as PACKAGE_VERSION,Mn as PackageBadge,ft as dir2Euler,jn as entrypoint,ne as getPosition,ke as getQuaternion,Un as getRotMatrix,ve as range,Gn as setPosition,Bn as setQuaternion,q as subArray,cn as useDebounceFn,rn as useInterval,K as useMuJoCo,un as useMuJoCoModelMetadata,me as useMuJoCoModule,Zt as useStateRef,zr as useValueRef,bn as useVec3State};

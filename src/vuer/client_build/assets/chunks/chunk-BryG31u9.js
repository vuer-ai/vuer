import{bz as Ar,an as Ot,l as Q,b_ as ss,b$ as Pn,c0 as wr,b as Jt,cE as is,S as $t,D as Tr,ar as as,aU as kn,aV as Fn,aT as Er,n as rt,Q as Dt,cF as os,I as ir,O as cn,a7 as wn,a4 as Rt,cG as It,V as Be,ap as cs,P as ls,aD as Kn,aE as ln,aF as Nt,M as it,d as st,aN as us,aM as hs,aO as ds,at as fs,bw as ps,x as br,aG as ms,c2 as gs,c3 as vs,aY as _r,c4 as ys,c5 as As,c6 as ws,L as Xe,av as Un,am as Bn,c7 as Ts,aH as pt,bj as Es,bi as Mn,Y as bs,bO as xr,X as Xt,aL as _s,B as Mr,aP as xs,a_ as Ms,$ as Ss,c8 as Rs,bk as Is,a5 as Sn,N as un,aQ as Ls,aK as Cs,c9 as Os,ca as Sr,bn as Ds,al as Lt,aW as ar,aZ as Ns,cc as Ps,k as Xn,p as Rr,h as Ir,H as He,i as mt,j as Vt,R as dn,b3 as ks,e as Fs,U as Us,f as Ee,u as en,w as Lr,a0 as Vn,W as Qt,cH as Tn,cu as Bs,au as Hs,c1 as Hn,bJ as Gs,bL as zs,bK as js,bE as Ws,b1 as Gn,ct as Zs,cn as or,bH as Ks,az as Xs,q as En,b0 as Vs,s as Ys,ac as qs,g as Cr,bF as $s,y as Qs,ak as cr,bv as Js,aJ as ei}from"./chunk-CfPHAf7B.js";import{r as I}from"./chunk-Bxh3mmdk.js";function Oe(){return Oe=Object.assign?Object.assign.bind():function(l){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var t in n)({}).hasOwnProperty.call(n,t)&&(l[t]=n[t])}return l},Oe.apply(null,arguments)}const Yn=parseInt(Ar.replace(/\D+/g,""));function qa(l,e=1e-4){e=Math.max(e,Number.EPSILON);const n={},t=l.getIndex(),r=l.getAttribute("position"),i=t?t.count:r.count;let s=0;const c=Object.keys(l.attributes),a={},u={},d=[],p=["getX","getY","getZ","getW"];for(let g=0,y=c.length;g<y;g++){const b=c[g];a[b]=[];const E=l.morphAttributes[b];E&&(u[b]=new Array(E.length).fill(0).map(()=>[]))}const f=Math.log10(1/e),v=Math.pow(10,f);for(let g=0;g<i;g++){const y=t?t.getX(g):g;let b="";for(let E=0,D=c.length;E<D;E++){const C=c[E],_=l.getAttribute(C),T=_.itemSize;for(let O=0;O<T;O++)b+=`${~~(_[p[O]](y)*v)},`}if(b in n)d.push(n[b]);else{for(let E=0,D=c.length;E<D;E++){const C=c[E],_=l.getAttribute(C),T=l.morphAttributes[C],O=_.itemSize,M=a[C],L=u[C];for(let N=0;N<O;N++){const W=p[N];if(M.push(_[W](y)),T)for(let K=0,Z=T.length;K<Z;K++)L[K].push(T[K][W](y))}}n[b]=s,d.push(s),s++}}const w=l.clone();for(let g=0,y=c.length;g<y;g++){const b=c[g],E=l.getAttribute(b),D=new E.array.constructor(a[b]),C=new Ot(D,E.itemSize,E.normalized);if(w.setAttribute(b,C),b in u)for(let _=0;_<u[b].length;_++){const T=l.morphAttributes[b][_],O=new T.array.constructor(u[b][_]),M=new Ot(O,T.itemSize,T.normalized);w.morphAttributes[b][_]=M}}return w.setIndex(d),w}function lr(l,e){if(e===ss)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),l;if(e===Pn||e===wr){let n=l.getIndex();if(n===null){const s=[],c=l.getAttribute("position");if(c!==void 0){for(let a=0;a<c.count;a++)s.push(a);l.setIndex(s),n=l.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),l}const t=n.count-2,r=[];if(n)if(e===Pn)for(let s=1;s<=t;s++)r.push(n.getX(0)),r.push(n.getX(s)),r.push(n.getX(s+1));else for(let s=0;s<t;s++)s%2===0?(r.push(n.getX(s)),r.push(n.getX(s+1)),r.push(n.getX(s+2))):(r.push(n.getX(s+2)),r.push(n.getX(s+1)),r.push(n.getX(s)));r.length/3!==t&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const i=l.clone();return i.setIndex(r),i.clearGroups(),i}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),l}function $a(l,e=Math.PI/3){const n=Math.cos(e),t=(1+1e-10)*100,r=[new Q,new Q,new Q],i=new Q,s=new Q,c=new Q,a=new Q;function u(g){const y=~~(g.x*t),b=~~(g.y*t),E=~~(g.z*t);return`${y},${b},${E}`}const d=l.index?l.toNonIndexed():l,p=d.attributes.position,f={};for(let g=0,y=p.count/3;g<y;g++){const b=3*g,E=r[0].fromBufferAttribute(p,b+0),D=r[1].fromBufferAttribute(p,b+1),C=r[2].fromBufferAttribute(p,b+2);i.subVectors(C,D),s.subVectors(E,D);const _=new Q().crossVectors(i,s).normalize();for(let T=0;T<3;T++){const O=r[T],M=u(O);M in f||(f[M]=[]),f[M].push(_)}}const v=new Float32Array(p.count*3),w=new Ot(v,3,!1);for(let g=0,y=p.count/3;g<y;g++){const b=3*g,E=r[0].fromBufferAttribute(p,b+0),D=r[1].fromBufferAttribute(p,b+1),C=r[2].fromBufferAttribute(p,b+2);i.subVectors(C,D),s.subVectors(E,D),c.crossVectors(i,s).normalize();for(let _=0;_<3;_++){const T=r[_],O=u(T),M=f[O];a.set(0,0,0);for(let L=0,N=M.length;L<N;L++){const W=M[L];c.dot(W)>n&&a.add(W)}a.normalize(),w.setXYZ(b+_,a.x,a.y,a.z)}}return d.setAttribute("normal",w),d}var Ke=Uint8Array,Ct=Uint16Array,zn=Uint32Array,Or=new Ke([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Dr=new Ke([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ti=new Ke([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Nr=function(l,e){for(var n=new Ct(31),t=0;t<31;++t)n[t]=e+=1<<l[t-1];for(var r=new zn(n[30]),t=1;t<30;++t)for(var i=n[t];i<n[t+1];++i)r[i]=i-n[t]<<5|t;return[n,r]},Pr=Nr(Or,2),kr=Pr[0],ni=Pr[1];kr[28]=258,ni[258]=28;var ri=Nr(Dr,0),si=ri[0],jn=new Ct(32768);for(var ve=0;ve<32768;++ve){var Mt=(ve&43690)>>>1|(ve&21845)<<1;Mt=(Mt&52428)>>>2|(Mt&13107)<<2,Mt=(Mt&61680)>>>4|(Mt&3855)<<4,jn[ve]=((Mt&65280)>>>8|(Mt&255)<<8)>>>1}var hn=(function(l,e,n){for(var t=l.length,r=0,i=new Ct(e);r<t;++r)++i[l[r]-1];var s=new Ct(e);for(r=0;r<e;++r)s[r]=s[r-1]+i[r-1]<<1;var c;if(n){c=new Ct(1<<e);var a=15-e;for(r=0;r<t;++r)if(l[r])for(var u=r<<4|l[r],d=e-l[r],p=s[l[r]-1]++<<d,f=p|(1<<d)-1;p<=f;++p)c[jn[p]>>>a]=u}else for(c=new Ct(t),r=0;r<t;++r)l[r]&&(c[r]=jn[s[l[r]-1]++]>>>15-l[r]);return c}),pn=new Ke(288);for(var ve=0;ve<144;++ve)pn[ve]=8;for(var ve=144;ve<256;++ve)pn[ve]=9;for(var ve=256;ve<280;++ve)pn[ve]=7;for(var ve=280;ve<288;++ve)pn[ve]=8;var Fr=new Ke(32);for(var ve=0;ve<32;++ve)Fr[ve]=5;var ii=hn(pn,9,1),ai=hn(Fr,5,1),Rn=function(l){for(var e=l[0],n=1;n<l.length;++n)l[n]>e&&(e=l[n]);return e},$e=function(l,e,n){var t=e/8|0;return(l[t]|l[t+1]<<8)>>(e&7)&n},In=function(l,e){var n=e/8|0;return(l[n]|l[n+1]<<8|l[n+2]<<16)>>(e&7)},oi=function(l){return(l/8|0)+(l&7&&1)},ci=function(l,e,n){(n==null||n>l.length)&&(n=l.length);var t=new(l instanceof Ct?Ct:l instanceof zn?zn:Ke)(n-e);return t.set(l.subarray(e,n)),t},li=function(l,e,n){var t=l.length;if(!t||n&&!n.l&&t<5)return e||new Ke(0);var r=!e||n,i=!n||n.i;n||(n={}),e||(e=new Ke(t*3));var s=function(ae){var Ie=e.length;if(ae>Ie){var be=new Ke(Math.max(Ie*2,ae));be.set(e),e=be}},c=n.f||0,a=n.p||0,u=n.b||0,d=n.l,p=n.d,f=n.m,v=n.n,w=t*8;do{if(!d){n.f=c=$e(l,a,1);var g=$e(l,a+1,3);if(a+=3,g)if(g==1)d=ii,p=ai,f=9,v=5;else if(g==2){var D=$e(l,a,31)+257,C=$e(l,a+10,15)+4,_=D+$e(l,a+5,31)+1;a+=14;for(var T=new Ke(_),O=new Ke(19),M=0;M<C;++M)O[ti[M]]=$e(l,a+M*3,7);a+=C*3;for(var L=Rn(O),N=(1<<L)-1,W=hn(O,L,1),M=0;M<_;){var K=W[$e(l,a,N)];a+=K&15;var y=K>>>4;if(y<16)T[M++]=y;else{var Z=0,j=0;for(y==16?(j=3+$e(l,a,3),a+=2,Z=T[M-1]):y==17?(j=3+$e(l,a,7),a+=3):y==18&&(j=11+$e(l,a,127),a+=7);j--;)T[M++]=Z}}var ee=T.subarray(0,D),$=T.subarray(D);f=Rn(ee),v=Rn($),d=hn(ee,f,1),p=hn($,v,1)}else throw"invalid block type";else{var y=oi(a)+4,b=l[y-4]|l[y-3]<<8,E=y+b;if(E>t){if(i)throw"unexpected EOF";break}r&&s(u+b),e.set(l.subarray(y,E),u),n.b=u+=b,n.p=a=E*8;continue}if(a>w){if(i)throw"unexpected EOF";break}}r&&s(u+131072);for(var ye=(1<<f)-1,me=(1<<v)-1,Ae=a;;Ae=a){var Z=d[In(l,a)&ye],J=Z>>>4;if(a+=Z&15,a>w){if(i)throw"unexpected EOF";break}if(!Z)throw"invalid length/literal";if(J<256)e[u++]=J;else if(J==256){Ae=a,d=null;break}else{var ue=J-254;if(J>264){var M=J-257,ie=Or[M];ue=$e(l,a,(1<<ie)-1)+kr[M],a+=ie}var ce=p[In(l,a)&me],xe=ce>>>4;if(!ce)throw"invalid distance";a+=ce&15;var $=si[xe];if(xe>3){var ie=Dr[xe];$+=In(l,a)&(1<<ie)-1,a+=ie}if(a>w){if(i)throw"unexpected EOF";break}r&&s(u+131072);for(var Pe=u+ue;u<Pe;u+=4)e[u]=e[u-$],e[u+1]=e[u+1-$],e[u+2]=e[u+2-$],e[u+3]=e[u+3-$];u=Pe}}n.l=d,n.p=Ae,n.b=u,d&&(c=1,n.m=f,n.d=p,n.n=v)}while(!c);return u==e.length?e:ci(e,0,u)},ui=new Ke(0),hi=function(l){if((l[0]&15)!=8||l[0]>>>4>7||(l[0]<<8|l[1])%31)throw"invalid zlib data";if(l[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function vn(l,e){return li((hi(l),l.subarray(2,-4)),e)}var di=typeof TextDecoder<"u"&&new TextDecoder,fi=0;try{di.decode(ui,{stream:!0}),fi=1}catch{}var pi=Object.defineProperty,mi=(l,e,n)=>e in l?pi(l,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):l[e]=n,Qe=(l,e,n)=>(mi(l,typeof e!="symbol"?e+"":e,n),n);class Ln{constructor(e=Math){Qe(this,"grad3",[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]]),Qe(this,"grad4",[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]]),Qe(this,"p",[]),Qe(this,"perm",[]),Qe(this,"simplex",[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]),Qe(this,"dot",(n,t,r)=>n[0]*t+n[1]*r),Qe(this,"dot3",(n,t,r,i)=>n[0]*t+n[1]*r+n[2]*i),Qe(this,"dot4",(n,t,r,i,s)=>n[0]*t+n[1]*r+n[2]*i+n[3]*s),Qe(this,"noise",(n,t)=>{let r,i,s;const c=.5*(Math.sqrt(3)-1),a=(n+t)*c,u=Math.floor(n+a),d=Math.floor(t+a),p=(3-Math.sqrt(3))/6,f=(u+d)*p,v=u-f,w=d-f,g=n-v,y=t-w;let b=0,E=1;g>y&&(b=1,E=0);const D=g-b+p,C=y-E+p,_=g-1+2*p,T=y-1+2*p,O=u&255,M=d&255,L=this.perm[O+this.perm[M]]%12,N=this.perm[O+b+this.perm[M+E]]%12,W=this.perm[O+1+this.perm[M+1]]%12;let K=.5-g*g-y*y;K<0?r=0:(K*=K,r=K*K*this.dot(this.grad3[L],g,y));let Z=.5-D*D-C*C;Z<0?i=0:(Z*=Z,i=Z*Z*this.dot(this.grad3[N],D,C));let j=.5-_*_-T*T;return j<0?s=0:(j*=j,s=j*j*this.dot(this.grad3[W],_,T)),70*(r+i+s)}),Qe(this,"noise3d",(n,t,r)=>{let i,s,c,a;const d=(n+t+r)*.3333333333333333,p=Math.floor(n+d),f=Math.floor(t+d),v=Math.floor(r+d),w=1/6,g=(p+f+v)*w,y=p-g,b=f-g,E=v-g,D=n-y,C=t-b,_=r-E;let T,O,M,L,N,W;D>=C?C>=_?(T=1,O=0,M=0,L=1,N=1,W=0):D>=_?(T=1,O=0,M=0,L=1,N=0,W=1):(T=0,O=0,M=1,L=1,N=0,W=1):C<_?(T=0,O=0,M=1,L=0,N=1,W=1):D<_?(T=0,O=1,M=0,L=0,N=1,W=1):(T=0,O=1,M=0,L=1,N=1,W=0);const K=D-T+w,Z=C-O+w,j=_-M+w,ee=D-L+2*w,$=C-N+2*w,ye=_-W+2*w,me=D-1+3*w,Ae=C-1+3*w,J=_-1+3*w,ue=p&255,ie=f&255,ce=v&255,xe=this.perm[ue+this.perm[ie+this.perm[ce]]]%12,Pe=this.perm[ue+T+this.perm[ie+O+this.perm[ce+M]]]%12,ae=this.perm[ue+L+this.perm[ie+N+this.perm[ce+W]]]%12,Ie=this.perm[ue+1+this.perm[ie+1+this.perm[ce+1]]]%12;let be=.6-D*D-C*C-_*_;be<0?i=0:(be*=be,i=be*be*this.dot3(this.grad3[xe],D,C,_));let ke=.6-K*K-Z*Z-j*j;ke<0?s=0:(ke*=ke,s=ke*ke*this.dot3(this.grad3[Pe],K,Z,j));let Fe=.6-ee*ee-$*$-ye*ye;Fe<0?c=0:(Fe*=Fe,c=Fe*Fe*this.dot3(this.grad3[ae],ee,$,ye));let Ne=.6-me*me-Ae*Ae-J*J;return Ne<0?a=0:(Ne*=Ne,a=Ne*Ne*this.dot3(this.grad3[Ie],me,Ae,J)),32*(i+s+c+a)}),Qe(this,"noise4d",(n,t,r,i)=>{const s=this.grad4,c=this.simplex,a=this.perm,u=(Math.sqrt(5)-1)/4,d=(5-Math.sqrt(5))/20;let p,f,v,w,g;const y=(n+t+r+i)*u,b=Math.floor(n+y),E=Math.floor(t+y),D=Math.floor(r+y),C=Math.floor(i+y),_=(b+E+D+C)*d,T=b-_,O=E-_,M=D-_,L=C-_,N=n-T,W=t-O,K=r-M,Z=i-L,j=N>W?32:0,ee=N>K?16:0,$=W>K?8:0,ye=N>Z?4:0,me=W>Z?2:0,Ae=K>Z?1:0,J=j+ee+$+ye+me+Ae;let ue,ie,ce,xe,Pe,ae,Ie,be,ke,Fe,Ne,vt;ue=c[J][0]>=3?1:0,ie=c[J][1]>=3?1:0,ce=c[J][2]>=3?1:0,xe=c[J][3]>=3?1:0,Pe=c[J][0]>=2?1:0,ae=c[J][1]>=2?1:0,Ie=c[J][2]>=2?1:0,be=c[J][3]>=2?1:0,ke=c[J][0]>=1?1:0,Fe=c[J][1]>=1?1:0,Ne=c[J][2]>=1?1:0,vt=c[J][3]>=1?1:0;const at=N-ue+d,ot=W-ie+d,yt=K-ce+d,Pt=Z-xe+d,At=N-Pe+2*d,wt=W-ae+2*d,Tt=K-Ie+2*d,kt=Z-be+2*d,Ft=N-ke+3*d,Et=W-Fe+3*d,Je=K-Ne+3*d,Ve=Z-vt+3*d,ct=N-1+4*d,Ut=W-1+4*d,bt=K-1+4*d,et=Z-1+4*d,Ge=b&255,lt=E&255,tt=D&255,ut=C&255,ht=a[Ge+a[lt+a[tt+a[ut]]]]%32,Me=a[Ge+ue+a[lt+ie+a[tt+ce+a[ut+xe]]]]%32,_t=a[Ge+Pe+a[lt+ae+a[tt+Ie+a[ut+be]]]]%32,A=a[Ge+ke+a[lt+Fe+a[tt+Ne+a[ut+vt]]]]%32,k=a[Ge+1+a[lt+1+a[tt+1+a[ut+1]]]]%32;let X=.6-N*N-W*W-K*K-Z*Z;X<0?p=0:(X*=X,p=X*X*this.dot4(s[ht],N,W,K,Z));let ne=.6-at*at-ot*ot-yt*yt-Pt*Pt;ne<0?f=0:(ne*=ne,f=ne*ne*this.dot4(s[Me],at,ot,yt,Pt));let F=.6-At*At-wt*wt-Tt*Tt-kt*kt;F<0?v=0:(F*=F,v=F*F*this.dot4(s[_t],At,wt,Tt,kt));let _e=.6-Ft*Ft-Et*Et-Je*Je-Ve*Ve;_e<0?w=0:(_e*=_e,w=_e*_e*this.dot4(s[A],Ft,Et,Je,Ve));let Le=.6-ct*ct-Ut*Ut-bt*bt-et*et;return Le<0?g=0:(Le*=Le,g=Le*Le*this.dot4(s[k],ct,Ut,bt,et)),27*(p+f+v+w+g)});for(let n=0;n<256;n++)this.p[n]=Math.floor(e.random()*256);for(let n=0;n<512;n++)this.perm[n]=this.p[n&255]}}const gi=l=>l&&l.isCubeTexture;class vi extends Jt{constructor(e,n){var t,r;const i=gi(e),c=((r=i?(t=e.image[0])==null?void 0:t.width:e.image.width)!=null?r:1024)/4,a=Math.floor(Math.log2(c)),u=Math.pow(2,a),d=3*Math.max(u,112),p=4*u,f=[i?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/d}`,`#define CUBEUV_TEXEL_HEIGHT ${1/p}`,`#define CUBEUV_MAX_MIP ${a}.0`],v=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,w=f.join(`
`)+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${Yn>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,g={map:{value:e},height:{value:n?.height||15},radius:{value:n?.radius||100}},y=new is(1,16),b=new $t({uniforms:g,fragmentShader:w,vertexShader:v,side:Tr});super(y,b)}set radius(e){this.material.uniforms.radius.value=e}get radius(){return this.material.uniforms.radius.value}set height(e){this.material.uniforms.height.value=e}get height(){return this.material.uniforms.height.value}}function Ur(l,e,n={}){const t=new Q,r=new Dt,i=new Q,s=new rt,c=new rt,a=new rt;n.preserveMatrix=n.preserveMatrix!==void 0?n.preserveMatrix:!0,n.preservePosition=n.preservePosition!==void 0?n.preservePosition:!0,n.preserveHipPosition=n.preserveHipPosition!==void 0?n.preserveHipPosition:!1,n.useTargetMatrix=n.useTargetMatrix!==void 0?n.useTargetMatrix:!1,n.hip=n.hip!==void 0?n.hip:"hip",n.names=n.names||{};const u=e.isObject3D?e.skeleton.bones:bn(e),d=l.isObject3D?l.skeleton.bones:bn(l);let p,f,v,w,g;if(l.isObject3D?l.skeleton.pose():(n.useTargetMatrix=!0,n.preserveMatrix=!1),n.preservePosition){g=[];for(let y=0;y<d.length;y++)g.push(d[y].position.clone())}if(n.preserveMatrix){l.updateMatrixWorld(),l.matrixWorld.identity();for(let y=0;y<l.children.length;++y)l.children[y].updateMatrixWorld(!0)}if(n.offsets){p=[];for(let y=0;y<d.length;++y)f=d[y],v=n.names[f.name]||f.name,n.offsets[v]&&(f.matrix.multiply(n.offsets[v]),f.matrix.decompose(f.position,f.quaternion,f.scale),f.updateMatrixWorld()),p.push(f.matrixWorld.clone())}for(let y=0;y<d.length;++y){if(f=d[y],v=n.names[f.name]||f.name,w=Br(v,u),a.copy(f.matrixWorld),w){if(w.updateMatrixWorld(),n.useTargetMatrix?c.copy(w.matrixWorld):(c.copy(l.matrixWorld).invert(),c.multiply(w.matrixWorld)),i.setFromMatrixScale(c),c.scale(i.set(1/i.x,1/i.y,1/i.z)),a.makeRotationFromQuaternion(r.setFromRotationMatrix(c)),l.isObject3D){const b=d.indexOf(f),E=p?p[b]:s.copy(l.skeleton.boneInverses[b]).invert();a.multiply(E)}a.copyPosition(c)}f.parent&&f.parent.isBone?(f.matrix.copy(f.parent.matrixWorld).invert(),f.matrix.multiply(a)):f.matrix.copy(a),n.preserveHipPosition&&v===n.hip&&f.matrix.setPosition(t.set(0,f.position.y,0)),f.matrix.decompose(f.position,f.quaternion,f.scale),f.updateMatrixWorld()}if(n.preservePosition)for(let y=0;y<d.length;++y)f=d[y],v=n.names[f.name]||f.name,v!==n.hip&&f.position.copy(g[y]);n.preserveMatrix&&l.updateMatrixWorld(!0)}function yi(l,e,n,t={}){t.useFirstFramePosition=t.useFirstFramePosition!==void 0?t.useFirstFramePosition:!1,t.fps=t.fps!==void 0?t.fps:30,t.names=t.names||[],e.isObject3D||(e=wi(e));const r=Math.round(n.duration*(t.fps/1e3)*1e3),i=1/t.fps,s=[],c=new as(e),a=bn(l.skeleton),u=[];let d,p,f,v,w;c.clipAction(n).play(),c.update(0),e.updateMatrixWorld();for(let g=0;g<r;++g){const y=g*i;Ur(l,e,t);for(let b=0;b<a.length;++b)w=t.names[a[b].name]||a[b].name,f=Br(w,e.skeleton),f&&(p=a[b],v=u[b]=u[b]||{bone:p},t.hip===w&&(v.pos||(v.pos={times:new Float32Array(r),values:new Float32Array(r*3)}),t.useFirstFramePosition&&(g===0&&(d=p.position.clone()),p.position.sub(d)),v.pos.times[g]=y,p.position.toArray(v.pos.values,g*3)),v.quat||(v.quat={times:new Float32Array(r),values:new Float32Array(r*4)}),v.quat.times[g]=y,p.quaternion.toArray(v.quat.values,g*4));c.update(i),e.updateMatrixWorld()}for(let g=0;g<u.length;++g)v=u[g],v&&(v.pos&&s.push(new kn(".bones["+v.bone.name+"].position",v.pos.times,v.pos.values)),s.push(new Fn(".bones["+v.bone.name+"].quaternion",v.quat.times,v.quat.values)));return c.uncacheAction(n),new Er(n.name,-1,s)}function Ai(l){const e=new Map,n=new Map,t=l.clone();return Hr(l,t,function(r,i){e.set(i,r),n.set(r,i)}),t.traverse(function(r){if(!r.isSkinnedMesh)return;const i=r,s=e.get(r),c=s.skeleton.bones;i.skeleton=s.skeleton.clone(),i.bindMatrix.copy(s.bindMatrix),i.skeleton.bones=c.map(function(a){return n.get(a)}),i.bind(i.skeleton,i.bindMatrix)}),t}function Br(l,e){for(let n=0,t=bn(e);n<t.length;n++)if(l===t[n].name)return t[n]}function bn(l){return Array.isArray(l)?l:l.bones}function wi(l){const e=new os(l.bones[0]);return e.skeleton=l,e}function Hr(l,e,n){n(l,e);for(let t=0;t<l.children.length;t++)Hr(l.children[t],e.children[t],n)}const Ti={retarget:Ur,retargetClip:yi,clone:Ai};var Ei=Object.defineProperty,bi=(l,e,n)=>e in l?Ei(l,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):l[e]=n,_i=(l,e,n)=>(bi(l,e+"",n),n);class xi{constructor(){_i(this,"_listeners")}addEventListener(e,n){this._listeners===void 0&&(this._listeners={});const t=this._listeners;t[e]===void 0&&(t[e]=[]),t[e].indexOf(n)===-1&&t[e].push(n)}hasEventListener(e,n){if(this._listeners===void 0)return!1;const t=this._listeners;return t[e]!==void 0&&t[e].indexOf(n)!==-1}removeEventListener(e,n){if(this._listeners===void 0)return;const r=this._listeners[e];if(r!==void 0){const i=r.indexOf(n);i!==-1&&r.splice(i,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const t=this._listeners[e.type];if(t!==void 0){e.target=this;const r=t.slice(0);for(let i=0,s=r.length;i<s;i++)r[i].call(this,e);e.target=null}}}var Mi=Object.defineProperty,Si=(l,e,n)=>e in l?Mi(l,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):l[e]=n,q=(l,e,n)=>(Si(l,typeof e!="symbol"?e+"":e,n),n);const yn=new cs,ur=new ls,Ri=Math.cos(70*(Math.PI/180)),hr=(l,e)=>(l%e+e)%e;let Gr=class extends xi{constructor(e,n){super(),q(this,"object"),q(this,"domElement"),q(this,"enabled",!0),q(this,"target",new Q),q(this,"minDistance",0),q(this,"maxDistance",1/0),q(this,"minZoom",0),q(this,"maxZoom",1/0),q(this,"minPolarAngle",0),q(this,"maxPolarAngle",Math.PI),q(this,"minAzimuthAngle",-1/0),q(this,"maxAzimuthAngle",1/0),q(this,"enableDamping",!1),q(this,"dampingFactor",.05),q(this,"enableZoom",!0),q(this,"zoomSpeed",1),q(this,"enableRotate",!0),q(this,"rotateSpeed",1),q(this,"enablePan",!0),q(this,"panSpeed",1),q(this,"screenSpacePanning",!0),q(this,"keyPanSpeed",7),q(this,"zoomToCursor",!1),q(this,"autoRotate",!1),q(this,"autoRotateSpeed",2),q(this,"reverseOrbit",!1),q(this,"reverseHorizontalOrbit",!1),q(this,"reverseVerticalOrbit",!1),q(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),q(this,"mouseButtons",{LEFT:Rt.ROTATE,MIDDLE:Rt.DOLLY,RIGHT:Rt.PAN}),q(this,"touches",{ONE:It.ROTATE,TWO:It.DOLLY_PAN}),q(this,"target0"),q(this,"position0"),q(this,"zoom0"),q(this,"_domElementKeyEvents",null),q(this,"getPolarAngle"),q(this,"getAzimuthalAngle"),q(this,"setPolarAngle"),q(this,"setAzimuthalAngle"),q(this,"getDistance"),q(this,"getZoomScale"),q(this,"listenToKeyEvents"),q(this,"stopListenToKeyEvents"),q(this,"saveState"),q(this,"reset"),q(this,"update"),q(this,"connect"),q(this,"dispose"),q(this,"dollyIn"),q(this,"dollyOut"),q(this,"getScale"),q(this,"setScale"),this.object=e,this.domElement=n,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>d.phi,this.getAzimuthalAngle=()=>d.theta,this.setPolarAngle=A=>{let k=hr(A,2*Math.PI),X=d.phi;X<0&&(X+=2*Math.PI),k<0&&(k+=2*Math.PI);let ne=Math.abs(k-X);2*Math.PI-ne<ne&&(k<X?k+=2*Math.PI:X+=2*Math.PI),p.phi=k-X,t.update()},this.setAzimuthalAngle=A=>{let k=hr(A,2*Math.PI),X=d.theta;X<0&&(X+=2*Math.PI),k<0&&(k+=2*Math.PI);let ne=Math.abs(k-X);2*Math.PI-ne<ne&&(k<X?k+=2*Math.PI:X+=2*Math.PI),p.theta=k-X,t.update()},this.getDistance=()=>t.object.position.distanceTo(t.target),this.listenToKeyEvents=A=>{A.addEventListener("keydown",et),this._domElementKeyEvents=A},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",et),this._domElementKeyEvents=null},this.saveState=()=>{t.target0.copy(t.target),t.position0.copy(t.object.position),t.zoom0=t.object.zoom},this.reset=()=>{t.target.copy(t.target0),t.object.position.copy(t.position0),t.object.zoom=t.zoom0,t.object.updateProjectionMatrix(),t.dispatchEvent(r),t.update(),a=c.NONE},this.update=(()=>{const A=new Q,k=new Q(0,1,0),X=new Dt().setFromUnitVectors(e.up,k),ne=X.clone().invert(),F=new Q,_e=new Dt,Le=2*Math.PI;return function(){const mn=t.object.position;X.setFromUnitVectors(e.up,k),ne.copy(X).invert(),A.copy(mn).sub(t.target),A.applyQuaternion(X),d.setFromVector3(A),t.autoRotate&&a===c.NONE&&j(K()),t.enableDamping?(d.theta+=p.theta*t.dampingFactor,d.phi+=p.phi*t.dampingFactor):(d.theta+=p.theta,d.phi+=p.phi);let Ye=t.minAzimuthAngle,qe=t.maxAzimuthAngle;isFinite(Ye)&&isFinite(qe)&&(Ye<-Math.PI?Ye+=Le:Ye>Math.PI&&(Ye-=Le),qe<-Math.PI?qe+=Le:qe>Math.PI&&(qe-=Le),Ye<=qe?d.theta=Math.max(Ye,Math.min(qe,d.theta)):d.theta=d.theta>(Ye+qe)/2?Math.max(Ye,d.theta):Math.min(qe,d.theta)),d.phi=Math.max(t.minPolarAngle,Math.min(t.maxPolarAngle,d.phi)),d.makeSafe(),t.enableDamping===!0?t.target.addScaledVector(v,t.dampingFactor):t.target.add(v),t.zoomToCursor&&L||t.object.isOrthographicCamera?d.radius=ce(d.radius):d.radius=ce(d.radius*f),A.setFromSpherical(d),A.applyQuaternion(ne),mn.copy(t.target).add(A),t.object.matrixAutoUpdate||t.object.updateMatrix(),t.object.lookAt(t.target),t.enableDamping===!0?(p.theta*=1-t.dampingFactor,p.phi*=1-t.dampingFactor,v.multiplyScalar(1-t.dampingFactor)):(p.set(0,0,0),v.set(0,0,0));let Bt=!1;if(t.zoomToCursor&&L){let Ht=null;if(t.object instanceof wn&&t.object.isPerspectiveCamera){const Gt=A.length();Ht=ce(Gt*f);const Zt=Gt-Ht;t.object.position.addScaledVector(O,Zt),t.object.updateMatrixWorld()}else if(t.object.isOrthographicCamera){const Gt=new Q(M.x,M.y,0);Gt.unproject(t.object),t.object.zoom=Math.max(t.minZoom,Math.min(t.maxZoom,t.object.zoom/f)),t.object.updateProjectionMatrix(),Bt=!0;const Zt=new Q(M.x,M.y,0);Zt.unproject(t.object),t.object.position.sub(Zt).add(Gt),t.object.updateMatrixWorld(),Ht=A.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),t.zoomToCursor=!1;Ht!==null&&(t.screenSpacePanning?t.target.set(0,0,-1).transformDirection(t.object.matrix).multiplyScalar(Ht).add(t.object.position):(yn.origin.copy(t.object.position),yn.direction.set(0,0,-1).transformDirection(t.object.matrix),Math.abs(t.object.up.dot(yn.direction))<Ri?e.lookAt(t.target):(ur.setFromNormalAndCoplanarPoint(t.object.up,t.target),yn.intersectPlane(ur,t.target))))}else t.object instanceof cn&&t.object.isOrthographicCamera&&(Bt=f!==1,Bt&&(t.object.zoom=Math.max(t.minZoom,Math.min(t.maxZoom,t.object.zoom/f)),t.object.updateProjectionMatrix()));return f=1,L=!1,Bt||F.distanceToSquared(t.object.position)>u||8*(1-_e.dot(t.object.quaternion))>u?(t.dispatchEvent(r),F.copy(t.object.position),_e.copy(t.object.quaternion),Bt=!1,!0):!1}})(),this.connect=A=>{t.domElement=A,t.domElement.style.touchAction="none",t.domElement.addEventListener("contextmenu",tt),t.domElement.addEventListener("pointerdown",Et),t.domElement.addEventListener("pointercancel",Ve),t.domElement.addEventListener("wheel",bt)},this.dispose=()=>{var A,k,X,ne,F,_e;t.domElement&&(t.domElement.style.touchAction="auto"),(A=t.domElement)==null||A.removeEventListener("contextmenu",tt),(k=t.domElement)==null||k.removeEventListener("pointerdown",Et),(X=t.domElement)==null||X.removeEventListener("pointercancel",Ve),(ne=t.domElement)==null||ne.removeEventListener("wheel",bt),(F=t.domElement)==null||F.ownerDocument.removeEventListener("pointermove",Je),(_e=t.domElement)==null||_e.ownerDocument.removeEventListener("pointerup",Ve),t._domElementKeyEvents!==null&&t._domElementKeyEvents.removeEventListener("keydown",et)};const t=this,r={type:"change"},i={type:"start"},s={type:"end"},c={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let a=c.NONE;const u=1e-6,d=new ir,p=new ir;let f=1;const v=new Q,w=new Be,g=new Be,y=new Be,b=new Be,E=new Be,D=new Be,C=new Be,_=new Be,T=new Be,O=new Q,M=new Be;let L=!1;const N=[],W={};function K(){return 2*Math.PI/60/60*t.autoRotateSpeed}function Z(){return Math.pow(.95,t.zoomSpeed)}function j(A){t.reverseOrbit||t.reverseHorizontalOrbit?p.theta+=A:p.theta-=A}function ee(A){t.reverseOrbit||t.reverseVerticalOrbit?p.phi+=A:p.phi-=A}const $=(()=>{const A=new Q;return function(X,ne){A.setFromMatrixColumn(ne,0),A.multiplyScalar(-X),v.add(A)}})(),ye=(()=>{const A=new Q;return function(X,ne){t.screenSpacePanning===!0?A.setFromMatrixColumn(ne,1):(A.setFromMatrixColumn(ne,0),A.crossVectors(t.object.up,A)),A.multiplyScalar(X),v.add(A)}})(),me=(()=>{const A=new Q;return function(X,ne){const F=t.domElement;if(F&&t.object instanceof wn&&t.object.isPerspectiveCamera){const _e=t.object.position;A.copy(_e).sub(t.target);let Le=A.length();Le*=Math.tan(t.object.fov/2*Math.PI/180),$(2*X*Le/F.clientHeight,t.object.matrix),ye(2*ne*Le/F.clientHeight,t.object.matrix)}else F&&t.object instanceof cn&&t.object.isOrthographicCamera?($(X*(t.object.right-t.object.left)/t.object.zoom/F.clientWidth,t.object.matrix),ye(ne*(t.object.top-t.object.bottom)/t.object.zoom/F.clientHeight,t.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),t.enablePan=!1)}})();function Ae(A){t.object instanceof wn&&t.object.isPerspectiveCamera||t.object instanceof cn&&t.object.isOrthographicCamera?f=A:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),t.enableZoom=!1)}function J(A){Ae(f/A)}function ue(A){Ae(f*A)}function ie(A){if(!t.zoomToCursor||!t.domElement)return;L=!0;const k=t.domElement.getBoundingClientRect(),X=A.clientX-k.left,ne=A.clientY-k.top,F=k.width,_e=k.height;M.x=X/F*2-1,M.y=-(ne/_e)*2+1,O.set(M.x,M.y,1).unproject(t.object).sub(t.object.position).normalize()}function ce(A){return Math.max(t.minDistance,Math.min(t.maxDistance,A))}function xe(A){w.set(A.clientX,A.clientY)}function Pe(A){ie(A),C.set(A.clientX,A.clientY)}function ae(A){b.set(A.clientX,A.clientY)}function Ie(A){g.set(A.clientX,A.clientY),y.subVectors(g,w).multiplyScalar(t.rotateSpeed);const k=t.domElement;k&&(j(2*Math.PI*y.x/k.clientHeight),ee(2*Math.PI*y.y/k.clientHeight)),w.copy(g),t.update()}function be(A){_.set(A.clientX,A.clientY),T.subVectors(_,C),T.y>0?J(Z()):T.y<0&&ue(Z()),C.copy(_),t.update()}function ke(A){E.set(A.clientX,A.clientY),D.subVectors(E,b).multiplyScalar(t.panSpeed),me(D.x,D.y),b.copy(E),t.update()}function Fe(A){ie(A),A.deltaY<0?ue(Z()):A.deltaY>0&&J(Z()),t.update()}function Ne(A){let k=!1;switch(A.code){case t.keys.UP:me(0,t.keyPanSpeed),k=!0;break;case t.keys.BOTTOM:me(0,-t.keyPanSpeed),k=!0;break;case t.keys.LEFT:me(t.keyPanSpeed,0),k=!0;break;case t.keys.RIGHT:me(-t.keyPanSpeed,0),k=!0;break}k&&(A.preventDefault(),t.update())}function vt(){if(N.length==1)w.set(N[0].pageX,N[0].pageY);else{const A=.5*(N[0].pageX+N[1].pageX),k=.5*(N[0].pageY+N[1].pageY);w.set(A,k)}}function at(){if(N.length==1)b.set(N[0].pageX,N[0].pageY);else{const A=.5*(N[0].pageX+N[1].pageX),k=.5*(N[0].pageY+N[1].pageY);b.set(A,k)}}function ot(){const A=N[0].pageX-N[1].pageX,k=N[0].pageY-N[1].pageY,X=Math.sqrt(A*A+k*k);C.set(0,X)}function yt(){t.enableZoom&&ot(),t.enablePan&&at()}function Pt(){t.enableZoom&&ot(),t.enableRotate&&vt()}function At(A){if(N.length==1)g.set(A.pageX,A.pageY);else{const X=_t(A),ne=.5*(A.pageX+X.x),F=.5*(A.pageY+X.y);g.set(ne,F)}y.subVectors(g,w).multiplyScalar(t.rotateSpeed);const k=t.domElement;k&&(j(2*Math.PI*y.x/k.clientHeight),ee(2*Math.PI*y.y/k.clientHeight)),w.copy(g)}function wt(A){if(N.length==1)E.set(A.pageX,A.pageY);else{const k=_t(A),X=.5*(A.pageX+k.x),ne=.5*(A.pageY+k.y);E.set(X,ne)}D.subVectors(E,b).multiplyScalar(t.panSpeed),me(D.x,D.y),b.copy(E)}function Tt(A){const k=_t(A),X=A.pageX-k.x,ne=A.pageY-k.y,F=Math.sqrt(X*X+ne*ne);_.set(0,F),T.set(0,Math.pow(_.y/C.y,t.zoomSpeed)),J(T.y),C.copy(_)}function kt(A){t.enableZoom&&Tt(A),t.enablePan&&wt(A)}function Ft(A){t.enableZoom&&Tt(A),t.enableRotate&&At(A)}function Et(A){var k,X;t.enabled!==!1&&(N.length===0&&((k=t.domElement)==null||k.ownerDocument.addEventListener("pointermove",Je),(X=t.domElement)==null||X.ownerDocument.addEventListener("pointerup",Ve)),ut(A),A.pointerType==="touch"?Ge(A):ct(A))}function Je(A){t.enabled!==!1&&(A.pointerType==="touch"?lt(A):Ut(A))}function Ve(A){var k,X,ne;ht(A),N.length===0&&((k=t.domElement)==null||k.releasePointerCapture(A.pointerId),(X=t.domElement)==null||X.ownerDocument.removeEventListener("pointermove",Je),(ne=t.domElement)==null||ne.ownerDocument.removeEventListener("pointerup",Ve)),t.dispatchEvent(s),a=c.NONE}function ct(A){let k;switch(A.button){case 0:k=t.mouseButtons.LEFT;break;case 1:k=t.mouseButtons.MIDDLE;break;case 2:k=t.mouseButtons.RIGHT;break;default:k=-1}switch(k){case Rt.DOLLY:if(t.enableZoom===!1)return;Pe(A),a=c.DOLLY;break;case Rt.ROTATE:if(A.ctrlKey||A.metaKey||A.shiftKey){if(t.enablePan===!1)return;ae(A),a=c.PAN}else{if(t.enableRotate===!1)return;xe(A),a=c.ROTATE}break;case Rt.PAN:if(A.ctrlKey||A.metaKey||A.shiftKey){if(t.enableRotate===!1)return;xe(A),a=c.ROTATE}else{if(t.enablePan===!1)return;ae(A),a=c.PAN}break;default:a=c.NONE}a!==c.NONE&&t.dispatchEvent(i)}function Ut(A){if(t.enabled!==!1)switch(a){case c.ROTATE:if(t.enableRotate===!1)return;Ie(A);break;case c.DOLLY:if(t.enableZoom===!1)return;be(A);break;case c.PAN:if(t.enablePan===!1)return;ke(A);break}}function bt(A){t.enabled===!1||t.enableZoom===!1||a!==c.NONE&&a!==c.ROTATE||(A.preventDefault(),t.dispatchEvent(i),Fe(A),t.dispatchEvent(s))}function et(A){t.enabled===!1||t.enablePan===!1||Ne(A)}function Ge(A){switch(Me(A),N.length){case 1:switch(t.touches.ONE){case It.ROTATE:if(t.enableRotate===!1)return;vt(),a=c.TOUCH_ROTATE;break;case It.PAN:if(t.enablePan===!1)return;at(),a=c.TOUCH_PAN;break;default:a=c.NONE}break;case 2:switch(t.touches.TWO){case It.DOLLY_PAN:if(t.enableZoom===!1&&t.enablePan===!1)return;yt(),a=c.TOUCH_DOLLY_PAN;break;case It.DOLLY_ROTATE:if(t.enableZoom===!1&&t.enableRotate===!1)return;Pt(),a=c.TOUCH_DOLLY_ROTATE;break;default:a=c.NONE}break;default:a=c.NONE}a!==c.NONE&&t.dispatchEvent(i)}function lt(A){switch(Me(A),a){case c.TOUCH_ROTATE:if(t.enableRotate===!1)return;At(A),t.update();break;case c.TOUCH_PAN:if(t.enablePan===!1)return;wt(A),t.update();break;case c.TOUCH_DOLLY_PAN:if(t.enableZoom===!1&&t.enablePan===!1)return;kt(A),t.update();break;case c.TOUCH_DOLLY_ROTATE:if(t.enableZoom===!1&&t.enableRotate===!1)return;Ft(A),t.update();break;default:a=c.NONE}}function tt(A){t.enabled!==!1&&A.preventDefault()}function ut(A){N.push(A)}function ht(A){delete W[A.pointerId];for(let k=0;k<N.length;k++)if(N[k].pointerId==A.pointerId){N.splice(k,1);return}}function Me(A){let k=W[A.pointerId];k===void 0&&(k=new Be,W[A.pointerId]=k),k.set(A.pageX,A.pageY)}function _t(A){const k=A.pointerId===N[0].pointerId?N[1]:N[0];return W[k.pointerId]}this.dollyIn=(A=Z())=>{ue(A),t.update()},this.dollyOut=(A=Z())=>{J(A),t.update()},this.getScale=()=>f,this.setScale=A=>{Ae(A),t.update()},this.getZoomScale=()=>Z(),n!==void 0&&this.connect(n),this.update()}};class Ja extends Gr{constructor(e,n){super(e,n),this.screenSpacePanning=!1,this.mouseButtons.LEFT=Rt.PAN,this.mouseButtons.RIGHT=Rt.ROTATE,this.touches.ONE=It.PAN,this.touches.TWO=It.DOLLY_ROTATE}}function _n(l){if(typeof TextDecoder<"u")return new TextDecoder().decode(l);let e="";for(let n=0,t=l.length;n<t;n++)e+=String.fromCharCode(l[n]);try{return decodeURIComponent(escape(e))}catch{return e}}const Wt="srgb",gt="srgb-linear",dr=3001,Ii=3e3;class eo extends Kn{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(n){return new Ni(n)}),this.register(function(n){return new Pi(n)}),this.register(function(n){return new Wi(n)}),this.register(function(n){return new Zi(n)}),this.register(function(n){return new Ki(n)}),this.register(function(n){return new Fi(n)}),this.register(function(n){return new Ui(n)}),this.register(function(n){return new Bi(n)}),this.register(function(n){return new Hi(n)}),this.register(function(n){return new Di(n)}),this.register(function(n){return new Gi(n)}),this.register(function(n){return new ki(n)}),this.register(function(n){return new ji(n)}),this.register(function(n){return new zi(n)}),this.register(function(n){return new Ci(n)}),this.register(function(n){return new Xi(n)}),this.register(function(n){return new Vi(n)})}load(e,n,t,r){const i=this;let s;if(this.resourcePath!=="")s=this.resourcePath;else if(this.path!==""){const u=ln.extractUrlBase(e);s=ln.resolveURL(u,this.path)}else s=ln.extractUrlBase(e);this.manager.itemStart(e);const c=function(u){r?r(u):console.error(u),i.manager.itemError(e),i.manager.itemEnd(e)},a=new Nt(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(u){try{i.parse(u,s,function(d){n(d),i.manager.itemEnd(e)},c)}catch(d){c(d)}},t,c)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,n,t,r){let i;const s={},c={};if(typeof e=="string")i=JSON.parse(e);else if(e instanceof ArrayBuffer)if(_n(new Uint8Array(e.slice(0,4)))===zr){try{s[se.KHR_BINARY_GLTF]=new Yi(e)}catch(d){r&&r(d);return}i=JSON.parse(s[se.KHR_BINARY_GLTF].content)}else i=JSON.parse(_n(new Uint8Array(e)));else i=e;if(i.asset===void 0||i.asset.version[0]<2){r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const a=new ca(i,{path:n||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});a.fileLoader.setRequestHeader(this.requestHeader);for(let u=0;u<this.pluginCallbacks.length;u++){const d=this.pluginCallbacks[u](a);d.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),c[d.name]=d,s[d.name]=!0}if(i.extensionsUsed)for(let u=0;u<i.extensionsUsed.length;++u){const d=i.extensionsUsed[u],p=i.extensionsRequired||[];switch(d){case se.KHR_MATERIALS_UNLIT:s[d]=new Oi;break;case se.KHR_DRACO_MESH_COMPRESSION:s[d]=new qi(i,this.dracoLoader);break;case se.KHR_TEXTURE_TRANSFORM:s[d]=new $i;break;case se.KHR_MESH_QUANTIZATION:s[d]=new Qi;break;default:p.indexOf(d)>=0&&c[d]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}a.setExtensions(s),a.setPlugins(c),a.parse(t,r)}parseAsync(e,n){const t=this;return new Promise(function(r,i){t.parse(e,n,r,i)})}}function Li(){let l={};return{get:function(e){return l[e]},add:function(e,n){l[e]=n},remove:function(e){delete l[e]},removeAll:function(){l={}}}}const se={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Ci{constructor(e){this.parser=e,this.name=se.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,n=this.parser.json.nodes||[];for(let t=0,r=n.length;t<r;t++){const i=n[t];i.extensions&&i.extensions[this.name]&&i.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){const n=this.parser,t="light:"+e;let r=n.cache.get(t);if(r)return r;const i=n.json,a=((i.extensions&&i.extensions[this.name]||{}).lights||[])[e];let u;const d=new st(16777215);a.color!==void 0&&d.setRGB(a.color[0],a.color[1],a.color[2],gt);const p=a.range!==void 0?a.range:0;switch(a.type){case"directional":u=new ds(d),u.target.position.set(0,0,-1),u.add(u.target);break;case"point":u=new hs(d),u.distance=p;break;case"spot":u=new us(d),u.distance=p,a.spot=a.spot||{},a.spot.innerConeAngle=a.spot.innerConeAngle!==void 0?a.spot.innerConeAngle:0,a.spot.outerConeAngle=a.spot.outerConeAngle!==void 0?a.spot.outerConeAngle:Math.PI/4,u.angle=a.spot.outerConeAngle,u.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,u.target.position.set(0,0,-1),u.add(u.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return u.position.set(0,0,0),u.decay=2,ft(u,a),a.intensity!==void 0&&(u.intensity=a.intensity),u.name=n.createUniqueName(a.name||"light_"+e),r=Promise.resolve(u),n.cache.add(t,r),r}getDependency(e,n){if(e==="light")return this._loadLight(n)}createNodeAttachment(e){const n=this,t=this.parser,i=t.json.nodes[e],c=(i.extensions&&i.extensions[this.name]||{}).light;return c===void 0?null:this._loadLight(c).then(function(a){return t._getNodeRef(n.cache,c,a)})}}class Oi{constructor(){this.name=se.KHR_MATERIALS_UNLIT}getMaterialType(){return Xt}extendParams(e,n,t){const r=[];e.color=new st(1,1,1),e.opacity=1;const i=n.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){const s=i.baseColorFactor;e.color.setRGB(s[0],s[1],s[2],gt),e.opacity=s[3]}i.baseColorTexture!==void 0&&r.push(t.assignTexture(e,"map",i.baseColorTexture,Wt))}return Promise.all(r)}}class Di{constructor(e){this.parser=e,this.name=se.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,n){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=r.extensions[this.name].emissiveStrength;return i!==void 0&&(n.emissiveIntensity=i),Promise.resolve()}}class Ni{constructor(e){this.parser=e,this.name=se.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:it}extendMaterialParams(e,n){const t=this.parser,r=t.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];if(s.clearcoatFactor!==void 0&&(n.clearcoat=s.clearcoatFactor),s.clearcoatTexture!==void 0&&i.push(t.assignTexture(n,"clearcoatMap",s.clearcoatTexture)),s.clearcoatRoughnessFactor!==void 0&&(n.clearcoatRoughness=s.clearcoatRoughnessFactor),s.clearcoatRoughnessTexture!==void 0&&i.push(t.assignTexture(n,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),s.clearcoatNormalTexture!==void 0&&(i.push(t.assignTexture(n,"clearcoatNormalMap",s.clearcoatNormalTexture)),s.clearcoatNormalTexture.scale!==void 0)){const c=s.clearcoatNormalTexture.scale;n.clearcoatNormalScale=new Be(c,c)}return Promise.all(i)}}class Pi{constructor(e){this.parser=e,this.name=se.KHR_MATERIALS_DISPERSION}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:it}extendMaterialParams(e,n){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=r.extensions[this.name];return n.dispersion=i.dispersion!==void 0?i.dispersion:0,Promise.resolve()}}class ki{constructor(e){this.parser=e,this.name=se.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:it}extendMaterialParams(e,n){const t=this.parser,r=t.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];return s.iridescenceFactor!==void 0&&(n.iridescence=s.iridescenceFactor),s.iridescenceTexture!==void 0&&i.push(t.assignTexture(n,"iridescenceMap",s.iridescenceTexture)),s.iridescenceIor!==void 0&&(n.iridescenceIOR=s.iridescenceIor),n.iridescenceThicknessRange===void 0&&(n.iridescenceThicknessRange=[100,400]),s.iridescenceThicknessMinimum!==void 0&&(n.iridescenceThicknessRange[0]=s.iridescenceThicknessMinimum),s.iridescenceThicknessMaximum!==void 0&&(n.iridescenceThicknessRange[1]=s.iridescenceThicknessMaximum),s.iridescenceThicknessTexture!==void 0&&i.push(t.assignTexture(n,"iridescenceThicknessMap",s.iridescenceThicknessTexture)),Promise.all(i)}}class Fi{constructor(e){this.parser=e,this.name=se.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:it}extendMaterialParams(e,n){const t=this.parser,r=t.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[];n.sheenColor=new st(0,0,0),n.sheenRoughness=0,n.sheen=1;const s=r.extensions[this.name];if(s.sheenColorFactor!==void 0){const c=s.sheenColorFactor;n.sheenColor.setRGB(c[0],c[1],c[2],gt)}return s.sheenRoughnessFactor!==void 0&&(n.sheenRoughness=s.sheenRoughnessFactor),s.sheenColorTexture!==void 0&&i.push(t.assignTexture(n,"sheenColorMap",s.sheenColorTexture,Wt)),s.sheenRoughnessTexture!==void 0&&i.push(t.assignTexture(n,"sheenRoughnessMap",s.sheenRoughnessTexture)),Promise.all(i)}}class Ui{constructor(e){this.parser=e,this.name=se.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:it}extendMaterialParams(e,n){const t=this.parser,r=t.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];return s.transmissionFactor!==void 0&&(n.transmission=s.transmissionFactor),s.transmissionTexture!==void 0&&i.push(t.assignTexture(n,"transmissionMap",s.transmissionTexture)),Promise.all(i)}}class Bi{constructor(e){this.parser=e,this.name=se.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:it}extendMaterialParams(e,n){const t=this.parser,r=t.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];n.thickness=s.thicknessFactor!==void 0?s.thicknessFactor:0,s.thicknessTexture!==void 0&&i.push(t.assignTexture(n,"thicknessMap",s.thicknessTexture)),n.attenuationDistance=s.attenuationDistance||1/0;const c=s.attenuationColor||[1,1,1];return n.attenuationColor=new st().setRGB(c[0],c[1],c[2],gt),Promise.all(i)}}class Hi{constructor(e){this.parser=e,this.name=se.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:it}extendMaterialParams(e,n){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=r.extensions[this.name];return n.ior=i.ior!==void 0?i.ior:1.5,Promise.resolve()}}class Gi{constructor(e){this.parser=e,this.name=se.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:it}extendMaterialParams(e,n){const t=this.parser,r=t.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];n.specularIntensity=s.specularFactor!==void 0?s.specularFactor:1,s.specularTexture!==void 0&&i.push(t.assignTexture(n,"specularIntensityMap",s.specularTexture));const c=s.specularColorFactor||[1,1,1];return n.specularColor=new st().setRGB(c[0],c[1],c[2],gt),s.specularColorTexture!==void 0&&i.push(t.assignTexture(n,"specularColorMap",s.specularColorTexture,Wt)),Promise.all(i)}}class zi{constructor(e){this.parser=e,this.name=se.EXT_MATERIALS_BUMP}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:it}extendMaterialParams(e,n){const t=this.parser,r=t.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];return n.bumpScale=s.bumpFactor!==void 0?s.bumpFactor:1,s.bumpTexture!==void 0&&i.push(t.assignTexture(n,"bumpMap",s.bumpTexture)),Promise.all(i)}}class ji{constructor(e){this.parser=e,this.name=se.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:it}extendMaterialParams(e,n){const t=this.parser,r=t.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];return s.anisotropyStrength!==void 0&&(n.anisotropy=s.anisotropyStrength),s.anisotropyRotation!==void 0&&(n.anisotropyRotation=s.anisotropyRotation),s.anisotropyTexture!==void 0&&i.push(t.assignTexture(n,"anisotropyMap",s.anisotropyTexture)),Promise.all(i)}}class Wi{constructor(e){this.parser=e,this.name=se.KHR_TEXTURE_BASISU}loadTexture(e){const n=this.parser,t=n.json,r=t.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const i=r.extensions[this.name],s=n.options.ktx2Loader;if(!s){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return n.loadTextureImage(e,i.source,s)}}class Zi{constructor(e){this.parser=e,this.name=se.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const n=this.name,t=this.parser,r=t.json,i=r.textures[e];if(!i.extensions||!i.extensions[n])return null;const s=i.extensions[n],c=r.images[s.source];let a=t.textureLoader;if(c.uri){const u=t.options.manager.getHandler(c.uri);u!==null&&(a=u)}return this.detectSupport().then(function(u){if(u)return t.loadTextureImage(e,s.source,a);if(r.extensionsRequired&&r.extensionsRequired.indexOf(n)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return t.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const n=new Image;n.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",n.onload=n.onerror=function(){e(n.height===1)}})),this.isSupported}}class Ki{constructor(e){this.parser=e,this.name=se.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const n=this.name,t=this.parser,r=t.json,i=r.textures[e];if(!i.extensions||!i.extensions[n])return null;const s=i.extensions[n],c=r.images[s.source];let a=t.textureLoader;if(c.uri){const u=t.options.manager.getHandler(c.uri);u!==null&&(a=u)}return this.detectSupport().then(function(u){if(u)return t.loadTextureImage(e,s.source,a);if(r.extensionsRequired&&r.extensionsRequired.indexOf(n)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return t.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const n=new Image;n.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",n.onload=n.onerror=function(){e(n.height===1)}})),this.isSupported}}class Xi{constructor(e){this.name=se.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const n=this.parser.json,t=n.bufferViews[e];if(t.extensions&&t.extensions[this.name]){const r=t.extensions[this.name],i=this.parser.getDependency("buffer",r.buffer),s=this.parser.options.meshoptDecoder;if(!s||!s.supported){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then(function(c){const a=r.byteOffset||0,u=r.byteLength||0,d=r.count,p=r.byteStride,f=new Uint8Array(c,a,u);return s.decodeGltfBufferAsync?s.decodeGltfBufferAsync(d,p,f,r.mode,r.filter).then(function(v){return v.buffer}):s.ready.then(function(){const v=new ArrayBuffer(d*p);return s.decodeGltfBuffer(new Uint8Array(v),d,p,f,r.mode,r.filter),v})})}else return null}}class Vi{constructor(e){this.name=se.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const n=this.parser.json,t=n.nodes[e];if(!t.extensions||!t.extensions[this.name]||t.mesh===void 0)return null;const r=n.meshes[t.mesh];for(const u of r.primitives)if(u.mode!==Ze.TRIANGLES&&u.mode!==Ze.TRIANGLE_STRIP&&u.mode!==Ze.TRIANGLE_FAN&&u.mode!==void 0)return null;const s=t.extensions[this.name].attributes,c=[],a={};for(const u in s)c.push(this.parser.getDependency("accessor",s[u]).then(d=>(a[u]=d,a[u])));return c.length<1?null:(c.push(this.parser.createNodeMesh(e)),Promise.all(c).then(u=>{const d=u.pop(),p=d.isGroup?d.children:[d],f=u[0].count,v=[];for(const w of p){const g=new rt,y=new Q,b=new Dt,E=new Q(1,1,1),D=new fs(w.geometry,w.material,f);for(let C=0;C<f;C++)a.TRANSLATION&&y.fromBufferAttribute(a.TRANSLATION,C),a.ROTATION&&b.fromBufferAttribute(a.ROTATION,C),a.SCALE&&E.fromBufferAttribute(a.SCALE,C),D.setMatrixAt(C,g.compose(y,b,E));for(const C in a)if(C==="_COLOR_0"){const _=a[C];D.instanceColor=new ps(_.array,_.itemSize,_.normalized)}else C!=="TRANSLATION"&&C!=="ROTATION"&&C!=="SCALE"&&w.geometry.setAttribute(C,a[C]);br.prototype.copy.call(D,w),this.parser.assignFinalMaterial(D),v.push(D)}return d.isGroup?(d.clear(),d.add(...v),d):v[0]}))}}const zr="glTF",sn=12,fr={JSON:1313821514,BIN:5130562};class Yi{constructor(e){this.name=se.KHR_BINARY_GLTF,this.content=null,this.body=null;const n=new DataView(e,0,sn);if(this.header={magic:_n(new Uint8Array(e.slice(0,4))),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==zr)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const t=this.header.length-sn,r=new DataView(e,sn);let i=0;for(;i<t;){const s=r.getUint32(i,!0);i+=4;const c=r.getUint32(i,!0);if(i+=4,c===fr.JSON){const a=new Uint8Array(e,sn+i,s);this.content=_n(a)}else if(c===fr.BIN){const a=sn+i;this.body=e.slice(a,a+s)}i+=s}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class qi{constructor(e,n){if(!n)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=se.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=n,this.dracoLoader.preload()}decodePrimitive(e,n){const t=this.json,r=this.dracoLoader,i=e.extensions[this.name].bufferView,s=e.extensions[this.name].attributes,c={},a={},u={};for(const d in s){const p=Wn[d]||d.toLowerCase();c[p]=s[d]}for(const d in e.attributes){const p=Wn[d]||d.toLowerCase();if(s[d]!==void 0){const f=t.accessors[e.attributes[d]],v=Yt[f.componentType];u[p]=v.name,a[p]=f.normalized===!0}}return n.getDependency("bufferView",i).then(function(d){return new Promise(function(p,f){r.decodeDracoFile(d,function(v){for(const w in v.attributes){const g=v.attributes[w],y=a[w];y!==void 0&&(g.normalized=y)}p(v)},c,u,gt,f)})})}}class $i{constructor(){this.name=se.KHR_TEXTURE_TRANSFORM}extendTexture(e,n){return(n.texCoord===void 0||n.texCoord===e.channel)&&n.offset===void 0&&n.rotation===void 0&&n.scale===void 0||(e=e.clone(),n.texCoord!==void 0&&(e.channel=n.texCoord),n.offset!==void 0&&e.offset.fromArray(n.offset),n.rotation!==void 0&&(e.rotation=n.rotation),n.scale!==void 0&&e.repeat.fromArray(n.scale),e.needsUpdate=!0),e}}class Qi{constructor(){this.name=se.KHR_MESH_QUANTIZATION}}class jr extends Ps{constructor(e,n,t,r){super(e,n,t,r)}copySampleValue_(e){const n=this.resultBuffer,t=this.sampleValues,r=this.valueSize,i=e*r*3+r;for(let s=0;s!==r;s++)n[s]=t[i+s];return n}interpolate_(e,n,t,r){const i=this.resultBuffer,s=this.sampleValues,c=this.valueSize,a=c*2,u=c*3,d=r-n,p=(t-n)/d,f=p*p,v=f*p,w=e*u,g=w-u,y=-2*v+3*f,b=v-f,E=1-y,D=b-f+p;for(let C=0;C!==c;C++){const _=s[g+C+c],T=s[g+C+a]*d,O=s[w+C+c],M=s[w+C]*d;i[C]=E*_+D*T+y*O+b*M}return i}}const Ji=new Dt;class ea extends jr{interpolate_(e,n,t,r){const i=super.interpolate_(e,n,t,r);return Ji.fromArray(i).normalize().toArray(i),i}}const Ze={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Yt={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},pr={9728:Un,9729:Xe,9984:ws,9985:As,9986:ys,9987:_r},mr={33071:pt,33648:Ts,10497:Bn},Cn={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Wn={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...Yn>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},St={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},ta={CUBICSPLINE:void 0,LINEAR:Sr,STEP:Os},On={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function na(l){return l.DefaultMaterial===void 0&&(l.DefaultMaterial=new xr({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Ns})),l.DefaultMaterial}function jt(l,e,n){for(const t in n.extensions)l[t]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[t]=n.extensions[t])}function ft(l,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(l.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function ra(l,e,n){let t=!1,r=!1,i=!1;for(let u=0,d=e.length;u<d;u++){const p=e[u];if(p.POSITION!==void 0&&(t=!0),p.NORMAL!==void 0&&(r=!0),p.COLOR_0!==void 0&&(i=!0),t&&r&&i)break}if(!t&&!r&&!i)return Promise.resolve(l);const s=[],c=[],a=[];for(let u=0,d=e.length;u<d;u++){const p=e[u];if(t){const f=p.POSITION!==void 0?n.getDependency("accessor",p.POSITION):l.attributes.position;s.push(f)}if(r){const f=p.NORMAL!==void 0?n.getDependency("accessor",p.NORMAL):l.attributes.normal;c.push(f)}if(i){const f=p.COLOR_0!==void 0?n.getDependency("accessor",p.COLOR_0):l.attributes.color;a.push(f)}}return Promise.all([Promise.all(s),Promise.all(c),Promise.all(a)]).then(function(u){const d=u[0],p=u[1],f=u[2];return t&&(l.morphAttributes.position=d),r&&(l.morphAttributes.normal=p),i&&(l.morphAttributes.color=f),l.morphTargetsRelative=!0,l})}function sa(l,e){if(l.updateMorphTargets(),e.weights!==void 0)for(let n=0,t=e.weights.length;n<t;n++)l.morphTargetInfluences[n]=e.weights[n];if(e.extras&&Array.isArray(e.extras.targetNames)){const n=e.extras.targetNames;if(l.morphTargetInfluences.length===n.length){l.morphTargetDictionary={};for(let t=0,r=n.length;t<r;t++)l.morphTargetDictionary[n[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function ia(l){let e;const n=l.extensions&&l.extensions[se.KHR_DRACO_MESH_COMPRESSION];if(n?e="draco:"+n.bufferView+":"+n.indices+":"+Dn(n.attributes):e=l.indices+":"+Dn(l.attributes)+":"+l.mode,l.targets!==void 0)for(let t=0,r=l.targets.length;t<r;t++)e+=":"+Dn(l.targets[t]);return e}function Dn(l){let e="";const n=Object.keys(l).sort();for(let t=0,r=n.length;t<r;t++)e+=n[t]+":"+l[n[t]]+";";return e}function Zn(l){switch(l){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function aa(l){return l.search(/\.jpe?g($|\?)/i)>0||l.search(/^data\:image\/jpeg/)===0?"image/jpeg":l.search(/\.webp($|\?)/i)>0||l.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const oa=new rt;class ca{constructor(e={},n={}){this.json=e,this.extensions={},this.plugins={},this.options=n,this.cache=new Li,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let t=!1,r=!1,i=-1;typeof navigator<"u"&&typeof navigator.userAgent<"u"&&(t=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,r=navigator.userAgent.indexOf("Firefox")>-1,i=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||t||r&&i<98?this.textureLoader=new ms(this.options.manager):this.textureLoader=new gs(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Nt(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,n){const t=this,r=this.json,i=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(s){return s._markDefs&&s._markDefs()}),Promise.all(this._invokeAll(function(s){return s.beforeRoot&&s.beforeRoot()})).then(function(){return Promise.all([t.getDependencies("scene"),t.getDependencies("animation"),t.getDependencies("camera")])}).then(function(s){const c={scene:s[0][r.scene||0],scenes:s[0],animations:s[1],cameras:s[2],asset:r.asset,parser:t,userData:{}};return jt(i,c,r),ft(c,r),Promise.all(t._invokeAll(function(a){return a.afterRoot&&a.afterRoot(c)})).then(function(){for(const a of c.scenes)a.updateMatrixWorld();e(c)})}).catch(n)}_markDefs(){const e=this.json.nodes||[],n=this.json.skins||[],t=this.json.meshes||[];for(let r=0,i=n.length;r<i;r++){const s=n[r].joints;for(let c=0,a=s.length;c<a;c++)e[s[c]].isBone=!0}for(let r=0,i=e.length;r<i;r++){const s=e[r];s.mesh!==void 0&&(this._addNodeRef(this.meshCache,s.mesh),s.skin!==void 0&&(t[s.mesh].isSkinnedMesh=!0)),s.camera!==void 0&&this._addNodeRef(this.cameraCache,s.camera)}}_addNodeRef(e,n){n!==void 0&&(e.refs[n]===void 0&&(e.refs[n]=e.uses[n]=0),e.refs[n]++)}_getNodeRef(e,n,t){if(e.refs[n]<=1)return t;const r=t.clone(),i=(s,c)=>{const a=this.associations.get(s);a!=null&&this.associations.set(c,a);for(const[u,d]of s.children.entries())i(d,c.children[u])};return i(t,r),r.name+="_instance_"+e.uses[n]++,r}_invokeOne(e){const n=Object.values(this.plugins);n.push(this);for(let t=0;t<n.length;t++){const r=e(n[t]);if(r)return r}return null}_invokeAll(e){const n=Object.values(this.plugins);n.unshift(this);const t=[];for(let r=0;r<n.length;r++){const i=e(n[r]);i&&t.push(i)}return t}getDependency(e,n){const t=e+":"+n;let r=this.cache.get(t);if(!r){switch(e){case"scene":r=this.loadScene(n);break;case"node":r=this._invokeOne(function(i){return i.loadNode&&i.loadNode(n)});break;case"mesh":r=this._invokeOne(function(i){return i.loadMesh&&i.loadMesh(n)});break;case"accessor":r=this.loadAccessor(n);break;case"bufferView":r=this._invokeOne(function(i){return i.loadBufferView&&i.loadBufferView(n)});break;case"buffer":r=this.loadBuffer(n);break;case"material":r=this._invokeOne(function(i){return i.loadMaterial&&i.loadMaterial(n)});break;case"texture":r=this._invokeOne(function(i){return i.loadTexture&&i.loadTexture(n)});break;case"skin":r=this.loadSkin(n);break;case"animation":r=this._invokeOne(function(i){return i.loadAnimation&&i.loadAnimation(n)});break;case"camera":r=this.loadCamera(n);break;default:if(r=this._invokeOne(function(i){return i!=this&&i.getDependency&&i.getDependency(e,n)}),!r)throw new Error("Unknown type: "+e);break}this.cache.add(t,r)}return r}getDependencies(e){let n=this.cache.get(e);if(!n){const t=this,r=this.json[e+(e==="mesh"?"es":"s")]||[];n=Promise.all(r.map(function(i,s){return t.getDependency(e,s)})),this.cache.add(e,n)}return n}loadBuffer(e){const n=this.json.buffers[e],t=this.fileLoader;if(n.type&&n.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+n.type+" buffer type is not supported.");if(n.uri===void 0&&e===0)return Promise.resolve(this.extensions[se.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(i,s){t.load(ln.resolveURL(n.uri,r.path),i,void 0,function(){s(new Error('THREE.GLTFLoader: Failed to load buffer "'+n.uri+'".'))})})}loadBufferView(e){const n=this.json.bufferViews[e];return this.getDependency("buffer",n.buffer).then(function(t){const r=n.byteLength||0,i=n.byteOffset||0;return t.slice(i,i+r)})}loadAccessor(e){const n=this,t=this.json,r=this.json.accessors[e];if(r.bufferView===void 0&&r.sparse===void 0){const s=Cn[r.type],c=Yt[r.componentType],a=r.normalized===!0,u=new c(r.count*s);return Promise.resolve(new Ot(u,s,a))}const i=[];return r.bufferView!==void 0?i.push(this.getDependency("bufferView",r.bufferView)):i.push(null),r.sparse!==void 0&&(i.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(i).then(function(s){const c=s[0],a=Cn[r.type],u=Yt[r.componentType],d=u.BYTES_PER_ELEMENT,p=d*a,f=r.byteOffset||0,v=r.bufferView!==void 0?t.bufferViews[r.bufferView].byteStride:void 0,w=r.normalized===!0;let g,y;if(v&&v!==p){const b=Math.floor(f/v),E="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+b+":"+r.count;let D=n.cache.get(E);D||(g=new u(c,b*v,r.count*v/d),D=new vs(g,v/d),n.cache.add(E,D)),y=new Ds(D,a,f%v/d,w)}else c===null?g=new u(r.count*a):g=new u(c,f,r.count*a),y=new Ot(g,a,w);if(r.sparse!==void 0){const b=Cn.SCALAR,E=Yt[r.sparse.indices.componentType],D=r.sparse.indices.byteOffset||0,C=r.sparse.values.byteOffset||0,_=new E(s[1],D,r.sparse.count*b),T=new u(s[2],C,r.sparse.count*a);c!==null&&(y=new Ot(y.array.slice(),y.itemSize,y.normalized));for(let O=0,M=_.length;O<M;O++){const L=_[O];if(y.setX(L,T[O*a]),a>=2&&y.setY(L,T[O*a+1]),a>=3&&y.setZ(L,T[O*a+2]),a>=4&&y.setW(L,T[O*a+3]),a>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return y})}loadTexture(e){const n=this.json,t=this.options,i=n.textures[e].source,s=n.images[i];let c=this.textureLoader;if(s.uri){const a=t.manager.getHandler(s.uri);a!==null&&(c=a)}return this.loadTextureImage(e,i,c)}loadTextureImage(e,n,t){const r=this,i=this.json,s=i.textures[e],c=i.images[n],a=(c.uri||c.bufferView)+":"+s.sampler;if(this.textureCache[a])return this.textureCache[a];const u=this.loadImageSource(n,t).then(function(d){d.flipY=!1,d.name=s.name||c.name||"",d.name===""&&typeof c.uri=="string"&&c.uri.startsWith("data:image/")===!1&&(d.name=c.uri);const f=(i.samplers||{})[s.sampler]||{};return d.magFilter=pr[f.magFilter]||Xe,d.minFilter=pr[f.minFilter]||_r,d.wrapS=mr[f.wrapS]||Bn,d.wrapT=mr[f.wrapT]||Bn,r.associations.set(d,{textures:e}),d}).catch(function(){return null});return this.textureCache[a]=u,u}loadImageSource(e,n){const t=this,r=this.json,i=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(p=>p.clone());const s=r.images[e],c=self.URL||self.webkitURL;let a=s.uri||"",u=!1;if(s.bufferView!==void 0)a=t.getDependency("bufferView",s.bufferView).then(function(p){u=!0;const f=new Blob([p],{type:s.mimeType});return a=c.createObjectURL(f),a});else if(s.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const d=Promise.resolve(a).then(function(p){return new Promise(function(f,v){let w=f;n.isImageBitmapLoader===!0&&(w=function(g){const y=new Lt(g);y.needsUpdate=!0,f(y)}),n.load(ln.resolveURL(p,i.path),w,void 0,v)})}).then(function(p){return u===!0&&c.revokeObjectURL(a),ft(p,s),p.userData.mimeType=s.mimeType||aa(s.uri),p}).catch(function(p){throw console.error("THREE.GLTFLoader: Couldn't load texture",a),p});return this.sourceCache[e]=d,d}assignTexture(e,n,t,r){const i=this;return this.getDependency("texture",t.index).then(function(s){if(!s)return null;if(t.texCoord!==void 0&&t.texCoord>0&&(s=s.clone(),s.channel=t.texCoord),i.extensions[se.KHR_TEXTURE_TRANSFORM]){const c=t.extensions!==void 0?t.extensions[se.KHR_TEXTURE_TRANSFORM]:void 0;if(c){const a=i.associations.get(s);s=i.extensions[se.KHR_TEXTURE_TRANSFORM].extendTexture(s,c),i.associations.set(s,a)}}return r!==void 0&&(typeof r=="number"&&(r=r===dr?Wt:gt),"colorSpace"in s?s.colorSpace=r:s.encoding=r===Wt?dr:Ii),e[n]=s,s})}assignFinalMaterial(e){const n=e.geometry;let t=e.material;const r=n.attributes.tangent===void 0,i=n.attributes.color!==void 0,s=n.attributes.normal===void 0;if(e.isPoints){const c="PointsMaterial:"+t.uuid;let a=this.cache.get(c);a||(a=new Es,Mn.prototype.copy.call(a,t),a.color.copy(t.color),a.map=t.map,a.sizeAttenuation=!1,this.cache.add(c,a)),t=a}else if(e.isLine){const c="LineBasicMaterial:"+t.uuid;let a=this.cache.get(c);a||(a=new bs,Mn.prototype.copy.call(a,t),a.color.copy(t.color),a.map=t.map,this.cache.add(c,a)),t=a}if(r||i||s){let c="ClonedMaterial:"+t.uuid+":";r&&(c+="derivative-tangents:"),i&&(c+="vertex-colors:"),s&&(c+="flat-shading:");let a=this.cache.get(c);a||(a=t.clone(),i&&(a.vertexColors=!0),s&&(a.flatShading=!0),r&&(a.normalScale&&(a.normalScale.y*=-1),a.clearcoatNormalScale&&(a.clearcoatNormalScale.y*=-1)),this.cache.add(c,a),this.associations.set(a,this.associations.get(t))),t=a}e.material=t}getMaterialType(){return xr}loadMaterial(e){const n=this,t=this.json,r=this.extensions,i=t.materials[e];let s;const c={},a=i.extensions||{},u=[];if(a[se.KHR_MATERIALS_UNLIT]){const p=r[se.KHR_MATERIALS_UNLIT];s=p.getMaterialType(),u.push(p.extendParams(c,i,n))}else{const p=i.pbrMetallicRoughness||{};if(c.color=new st(1,1,1),c.opacity=1,Array.isArray(p.baseColorFactor)){const f=p.baseColorFactor;c.color.setRGB(f[0],f[1],f[2],gt),c.opacity=f[3]}p.baseColorTexture!==void 0&&u.push(n.assignTexture(c,"map",p.baseColorTexture,Wt)),c.metalness=p.metallicFactor!==void 0?p.metallicFactor:1,c.roughness=p.roughnessFactor!==void 0?p.roughnessFactor:1,p.metallicRoughnessTexture!==void 0&&(u.push(n.assignTexture(c,"metalnessMap",p.metallicRoughnessTexture)),u.push(n.assignTexture(c,"roughnessMap",p.metallicRoughnessTexture))),s=this._invokeOne(function(f){return f.getMaterialType&&f.getMaterialType(e)}),u.push(Promise.all(this._invokeAll(function(f){return f.extendMaterialParams&&f.extendMaterialParams(e,c)})))}i.doubleSided===!0&&(c.side=Tr);const d=i.alphaMode||On.OPAQUE;if(d===On.BLEND?(c.transparent=!0,c.depthWrite=!1):(c.transparent=!1,d===On.MASK&&(c.alphaTest=i.alphaCutoff!==void 0?i.alphaCutoff:.5)),i.normalTexture!==void 0&&s!==Xt&&(u.push(n.assignTexture(c,"normalMap",i.normalTexture)),c.normalScale=new Be(1,1),i.normalTexture.scale!==void 0)){const p=i.normalTexture.scale;c.normalScale.set(p,p)}if(i.occlusionTexture!==void 0&&s!==Xt&&(u.push(n.assignTexture(c,"aoMap",i.occlusionTexture)),i.occlusionTexture.strength!==void 0&&(c.aoMapIntensity=i.occlusionTexture.strength)),i.emissiveFactor!==void 0&&s!==Xt){const p=i.emissiveFactor;c.emissive=new st().setRGB(p[0],p[1],p[2],gt)}return i.emissiveTexture!==void 0&&s!==Xt&&u.push(n.assignTexture(c,"emissiveMap",i.emissiveTexture,Wt)),Promise.all(u).then(function(){const p=new s(c);return i.name&&(p.name=i.name),ft(p,i),n.associations.set(p,{materials:e}),i.extensions&&jt(r,p,i),p})}createUniqueName(e){const n=_s.sanitizeNodeName(e||"");return n in this.nodeNamesUsed?n+"_"+ ++this.nodeNamesUsed[n]:(this.nodeNamesUsed[n]=0,n)}loadGeometries(e){const n=this,t=this.extensions,r=this.primitiveCache;function i(c){return t[se.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(c,n).then(function(a){return gr(a,c,n)})}const s=[];for(let c=0,a=e.length;c<a;c++){const u=e[c],d=ia(u),p=r[d];if(p)s.push(p.promise);else{let f;u.extensions&&u.extensions[se.KHR_DRACO_MESH_COMPRESSION]?f=i(u):f=gr(new Mr,u,n),r[d]={primitive:u,promise:f},s.push(f)}}return Promise.all(s)}loadMesh(e){const n=this,t=this.json,r=this.extensions,i=t.meshes[e],s=i.primitives,c=[];for(let a=0,u=s.length;a<u;a++){const d=s[a].material===void 0?na(this.cache):this.getDependency("material",s[a].material);c.push(d)}return c.push(n.loadGeometries(s)),Promise.all(c).then(function(a){const u=a.slice(0,a.length-1),d=a[a.length-1],p=[];for(let v=0,w=d.length;v<w;v++){const g=d[v],y=s[v];let b;const E=u[v];if(y.mode===Ze.TRIANGLES||y.mode===Ze.TRIANGLE_STRIP||y.mode===Ze.TRIANGLE_FAN||y.mode===void 0)b=i.isSkinnedMesh===!0?new xs(g,E):new Jt(g,E),b.isSkinnedMesh===!0&&b.normalizeSkinWeights(),y.mode===Ze.TRIANGLE_STRIP?b.geometry=lr(b.geometry,wr):y.mode===Ze.TRIANGLE_FAN&&(b.geometry=lr(b.geometry,Pn));else if(y.mode===Ze.LINES)b=new Ms(g,E);else if(y.mode===Ze.LINE_STRIP)b=new Ss(g,E);else if(y.mode===Ze.LINE_LOOP)b=new Rs(g,E);else if(y.mode===Ze.POINTS)b=new Is(g,E);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+y.mode);Object.keys(b.geometry.morphAttributes).length>0&&sa(b,i),b.name=n.createUniqueName(i.name||"mesh_"+e),ft(b,i),y.extensions&&jt(r,b,y),n.assignFinalMaterial(b),p.push(b)}for(let v=0,w=p.length;v<w;v++)n.associations.set(p[v],{meshes:e,primitives:v});if(p.length===1)return i.extensions&&jt(r,p[0],i),p[0];const f=new Sn;i.extensions&&jt(r,f,i),n.associations.set(f,{meshes:e});for(let v=0,w=p.length;v<w;v++)f.add(p[v]);return f})}loadCamera(e){let n;const t=this.json.cameras[e],r=t[t.type];if(!r){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return t.type==="perspective"?n=new wn(un.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):t.type==="orthographic"&&(n=new cn(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),t.name&&(n.name=this.createUniqueName(t.name)),ft(n,t),Promise.resolve(n)}loadSkin(e){const n=this.json.skins[e],t=[];for(let r=0,i=n.joints.length;r<i;r++)t.push(this._loadNodeShallow(n.joints[r]));return n.inverseBindMatrices!==void 0?t.push(this.getDependency("accessor",n.inverseBindMatrices)):t.push(null),Promise.all(t).then(function(r){const i=r.pop(),s=r,c=[],a=[];for(let u=0,d=s.length;u<d;u++){const p=s[u];if(p){c.push(p);const f=new rt;i!==null&&f.fromArray(i.array,u*16),a.push(f)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',n.joints[u])}return new Ls(c,a)})}loadAnimation(e){const n=this.json,t=this,r=n.animations[e],i=r.name?r.name:"animation_"+e,s=[],c=[],a=[],u=[],d=[];for(let p=0,f=r.channels.length;p<f;p++){const v=r.channels[p],w=r.samplers[v.sampler],g=v.target,y=g.node,b=r.parameters!==void 0?r.parameters[w.input]:w.input,E=r.parameters!==void 0?r.parameters[w.output]:w.output;g.node!==void 0&&(s.push(this.getDependency("node",y)),c.push(this.getDependency("accessor",b)),a.push(this.getDependency("accessor",E)),u.push(w),d.push(g))}return Promise.all([Promise.all(s),Promise.all(c),Promise.all(a),Promise.all(u),Promise.all(d)]).then(function(p){const f=p[0],v=p[1],w=p[2],g=p[3],y=p[4],b=[];for(let E=0,D=f.length;E<D;E++){const C=f[E],_=v[E],T=w[E],O=g[E],M=y[E];if(C===void 0)continue;C.updateMatrix&&C.updateMatrix();const L=t._createAnimationTracks(C,_,T,O,M);if(L)for(let N=0;N<L.length;N++)b.push(L[N])}return new Er(i,void 0,b)})}createNodeMesh(e){const n=this.json,t=this,r=n.nodes[e];return r.mesh===void 0?null:t.getDependency("mesh",r.mesh).then(function(i){const s=t._getNodeRef(t.meshCache,r.mesh,i);return r.weights!==void 0&&s.traverse(function(c){if(c.isMesh)for(let a=0,u=r.weights.length;a<u;a++)c.morphTargetInfluences[a]=r.weights[a]}),s})}loadNode(e){const n=this.json,t=this,r=n.nodes[e],i=t._loadNodeShallow(e),s=[],c=r.children||[];for(let u=0,d=c.length;u<d;u++)s.push(t.getDependency("node",c[u]));const a=r.skin===void 0?Promise.resolve(null):t.getDependency("skin",r.skin);return Promise.all([i,Promise.all(s),a]).then(function(u){const d=u[0],p=u[1],f=u[2];f!==null&&d.traverse(function(v){v.isSkinnedMesh&&v.bind(f,oa)});for(let v=0,w=p.length;v<w;v++)d.add(p[v]);return d})}_loadNodeShallow(e){const n=this.json,t=this.extensions,r=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const i=n.nodes[e],s=i.name?r.createUniqueName(i.name):"",c=[],a=r._invokeOne(function(u){return u.createNodeMesh&&u.createNodeMesh(e)});return a&&c.push(a),i.camera!==void 0&&c.push(r.getDependency("camera",i.camera).then(function(u){return r._getNodeRef(r.cameraCache,i.camera,u)})),r._invokeAll(function(u){return u.createNodeAttachment&&u.createNodeAttachment(e)}).forEach(function(u){c.push(u)}),this.nodeCache[e]=Promise.all(c).then(function(u){let d;if(i.isBone===!0?d=new Cs:u.length>1?d=new Sn:u.length===1?d=u[0]:d=new br,d!==u[0])for(let p=0,f=u.length;p<f;p++)d.add(u[p]);if(i.name&&(d.userData.name=i.name,d.name=s),ft(d,i),i.extensions&&jt(t,d,i),i.matrix!==void 0){const p=new rt;p.fromArray(i.matrix),d.applyMatrix4(p)}else i.translation!==void 0&&d.position.fromArray(i.translation),i.rotation!==void 0&&d.quaternion.fromArray(i.rotation),i.scale!==void 0&&d.scale.fromArray(i.scale);return r.associations.has(d)||r.associations.set(d,{}),r.associations.get(d).nodes=e,d}),this.nodeCache[e]}loadScene(e){const n=this.extensions,t=this.json.scenes[e],r=this,i=new Sn;t.name&&(i.name=r.createUniqueName(t.name)),ft(i,t),t.extensions&&jt(n,i,t);const s=t.nodes||[],c=[];for(let a=0,u=s.length;a<u;a++)c.push(r.getDependency("node",s[a]));return Promise.all(c).then(function(a){for(let d=0,p=a.length;d<p;d++)i.add(a[d]);const u=d=>{const p=new Map;for(const[f,v]of r.associations)(f instanceof Mn||f instanceof Lt)&&p.set(f,v);return d.traverse(f=>{const v=r.associations.get(f);v!=null&&p.set(f,v)}),p};return r.associations=u(i),i})}_createAnimationTracks(e,n,t,r,i){const s=[],c=e.name?e.name:e.uuid,a=[];St[i.path]===St.weights?e.traverse(function(f){f.morphTargetInfluences&&a.push(f.name?f.name:f.uuid)}):a.push(c);let u;switch(St[i.path]){case St.weights:u=ar;break;case St.rotation:u=Fn;break;case St.position:case St.scale:u=kn;break;default:switch(t.itemSize){case 1:u=ar;break;case 2:case 3:default:u=kn;break}break}const d=r.interpolation!==void 0?ta[r.interpolation]:Sr,p=this._getArrayFromAccessor(t);for(let f=0,v=a.length;f<v;f++){const w=new u(a[f]+"."+St[i.path],n.array,p,d);r.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(w),s.push(w)}return s}_getArrayFromAccessor(e){let n=e.array;if(e.normalized){const t=Zn(n.constructor),r=new Float32Array(n.length);for(let i=0,s=n.length;i<s;i++)r[i]=n[i]*t;n=r}return n}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(t){const r=this instanceof Fn?ea:jr;return new r(this.times,this.values,this.getValueSize()/3,t)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function la(l,e,n){const t=e.attributes,r=new Xn;if(t.POSITION!==void 0){const c=n.json.accessors[t.POSITION],a=c.min,u=c.max;if(a!==void 0&&u!==void 0){if(r.set(new Q(a[0],a[1],a[2]),new Q(u[0],u[1],u[2])),c.normalized){const d=Zn(Yt[c.componentType]);r.min.multiplyScalar(d),r.max.multiplyScalar(d)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const i=e.targets;if(i!==void 0){const c=new Q,a=new Q;for(let u=0,d=i.length;u<d;u++){const p=i[u];if(p.POSITION!==void 0){const f=n.json.accessors[p.POSITION],v=f.min,w=f.max;if(v!==void 0&&w!==void 0){if(a.setX(Math.max(Math.abs(v[0]),Math.abs(w[0]))),a.setY(Math.max(Math.abs(v[1]),Math.abs(w[1]))),a.setZ(Math.max(Math.abs(v[2]),Math.abs(w[2]))),f.normalized){const g=Zn(Yt[f.componentType]);a.multiplyScalar(g)}c.max(a)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(c)}l.boundingBox=r;const s=new Rr;r.getCenter(s.center),s.radius=r.min.distanceTo(r.max)/2,l.boundingSphere=s}function gr(l,e,n){const t=e.attributes,r=[];function i(s,c){return n.getDependency("accessor",s).then(function(a){l.setAttribute(c,a)})}for(const s in t){const c=Wn[s]||s.toLowerCase();c in l.attributes||r.push(i(t[s],c))}if(e.indices!==void 0&&!l.index){const s=n.getDependency("accessor",e.indices).then(function(c){l.setIndex(c)});r.push(s)}return ft(l,e),la(l,e,n),Promise.all(r).then(function(){return e.targets!==void 0?ra(l,e.targets,n):l})}const ua={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`
      varying vec2 vUv;

      void main() {

        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

      }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;
    uniform float h;

    varying vec2 vUv;

    void main() {

    	vec4 sum = vec4( 0.0 );

    	sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

    	gl_FragColor = sum;

    }
  `},ha={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`
    varying vec2 vUv;

    void main() {

      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }
  `,fragmentShader:`

  uniform sampler2D tDiffuse;
  uniform float v;

  varying vec2 vUv;

  void main() {

    vec4 sum = vec4( 0.0 );

    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

    gl_FragColor = sum;

  }
  `};class da extends Ir{constructor(e){super(e),this.type=He}parse(e){const s=function(M,L){switch(M){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(L||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(L||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(L||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(L||""))}},p=function(M,L,N){L=L||1024;let K=M.pos,Z=-1,j=0,ee="",$=String.fromCharCode.apply(null,new Uint16Array(M.subarray(K,K+128)));for(;0>(Z=$.indexOf(`
`))&&j<L&&K<M.byteLength;)ee+=$,j+=$.length,K+=128,$+=String.fromCharCode.apply(null,new Uint16Array(M.subarray(K,K+128)));return-1<Z?(M.pos+=j+Z+1,ee+$.slice(0,Z)):!1},f=function(M){const L=/^#\?(\S+)/,N=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,W=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,K=/^\s*FORMAT=(\S+)\s*$/,Z=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,j={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let ee,$;for((M.pos>=M.byteLength||!(ee=p(M)))&&s(1,"no header found"),($=ee.match(L))||s(3,"bad initial token"),j.valid|=1,j.programtype=$[1],j.string+=ee+`
`;ee=p(M),ee!==!1;){if(j.string+=ee+`
`,ee.charAt(0)==="#"){j.comments+=ee+`
`;continue}if(($=ee.match(N))&&(j.gamma=parseFloat($[1])),($=ee.match(W))&&(j.exposure=parseFloat($[1])),($=ee.match(K))&&(j.valid|=2,j.format=$[1]),($=ee.match(Z))&&(j.valid|=4,j.height=parseInt($[1],10),j.width=parseInt($[2],10)),j.valid&2&&j.valid&4)break}return j.valid&2||s(3,"missing format specifier"),j.valid&4||s(3,"missing image size specifier"),j},v=function(M,L,N){const W=L;if(W<8||W>32767||M[0]!==2||M[1]!==2||M[2]&128)return new Uint8Array(M);W!==(M[2]<<8|M[3])&&s(3,"wrong scanline width");const K=new Uint8Array(4*L*N);K.length||s(4,"unable to allocate buffer space");let Z=0,j=0;const ee=4*W,$=new Uint8Array(4),ye=new Uint8Array(ee);let me=N;for(;me>0&&j<M.byteLength;){j+4>M.byteLength&&s(1),$[0]=M[j++],$[1]=M[j++],$[2]=M[j++],$[3]=M[j++],($[0]!=2||$[1]!=2||($[2]<<8|$[3])!=W)&&s(3,"bad rgbe scanline format");let Ae=0,J;for(;Ae<ee&&j<M.byteLength;){J=M[j++];const ie=J>128;if(ie&&(J-=128),(J===0||Ae+J>ee)&&s(3,"bad scanline data"),ie){const ce=M[j++];for(let xe=0;xe<J;xe++)ye[Ae++]=ce}else ye.set(M.subarray(j,j+J),Ae),Ae+=J,j+=J}const ue=W;for(let ie=0;ie<ue;ie++){let ce=0;K[Z]=ye[ie+ce],ce+=W,K[Z+1]=ye[ie+ce],ce+=W,K[Z+2]=ye[ie+ce],ce+=W,K[Z+3]=ye[ie+ce],Z+=4}me--}return K},w=function(M,L,N,W){const K=M[L+3],Z=Math.pow(2,K-128)/255;N[W+0]=M[L+0]*Z,N[W+1]=M[L+1]*Z,N[W+2]=M[L+2]*Z,N[W+3]=1},g=function(M,L,N,W){const K=M[L+3],Z=Math.pow(2,K-128)/255;N[W+0]=Vt.toHalfFloat(Math.min(M[L+0]*Z,65504)),N[W+1]=Vt.toHalfFloat(Math.min(M[L+1]*Z,65504)),N[W+2]=Vt.toHalfFloat(Math.min(M[L+2]*Z,65504)),N[W+3]=Vt.toHalfFloat(1)},y=new Uint8Array(e);y.pos=0;const b=f(y),E=b.width,D=b.height,C=v(y.subarray(y.pos),E,D);let _,T,O;switch(this.type){case mt:O=C.length/4;const M=new Float32Array(O*4);for(let N=0;N<O;N++)w(C,N*4,M,N*4);_=M,T=mt;break;case He:O=C.length/4;const L=new Uint16Array(O*4);for(let N=0;N<O;N++)g(C,N*4,L,N*4);_=L,T=He;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:E,height:D,data:_,header:b.string,gamma:b.gamma,exposure:b.exposure,type:T}}setDataType(e){return this.type=e,this}load(e,n,t,r){function i(s,c){switch(s.type){case mt:case He:"colorSpace"in s?s.colorSpace="srgb-linear":s.encoding=3e3,s.minFilter=Xe,s.magFilter=Xe,s.generateMipmaps=!1,s.flipY=!0;break}n&&n(s,c)}return super.load(e,i,t,r)}}const an=Yn>=152;class fa extends Ir{constructor(e){super(e),this.type=He}parse(e){const L=Math.pow(2.7182818,2.2);function N(o,h){for(var m=0,x=0;x<65536;++x)(x==0||o[x>>3]&1<<(x&7))&&(h[m++]=x);for(var S=m-1;m<65536;)h[m++]=0;return S}function W(o){for(var h=0;h<16384;h++)o[h]={},o[h].len=0,o[h].lit=0,o[h].p=null}const K={l:0,c:0,lc:0};function Z(o,h,m,x,S){for(;m<o;)h=h<<8|_t(x,S),m+=8;m-=o,K.l=h>>m&(1<<o)-1,K.c=h,K.lc=m}const j=new Array(59);function ee(o){for(var h=0;h<=58;++h)j[h]=0;for(var h=0;h<65537;++h)j[o[h]]+=1;for(var m=0,h=58;h>0;--h){var x=m+j[h]>>1;j[h]=m,m=x}for(var h=0;h<65537;++h){var S=o[h];S>0&&(o[h]=S|j[S]++<<6)}}function $(o,h,m,x,S,R,U){for(var P=m,G=0,H=0;S<=R;S++){if(P.value-m.value>x)return!1;Z(6,G,H,o,P);var z=K.l;if(G=K.c,H=K.lc,U[S]=z,z==63){if(P.value-m.value>x)throw"Something wrong with hufUnpackEncTable";Z(8,G,H,o,P);var B=K.l+6;if(G=K.c,H=K.lc,S+B>R+1)throw"Something wrong with hufUnpackEncTable";for(;B--;)U[S++]=0;S--}else if(z>=59){var B=z-59+2;if(S+B>R+1)throw"Something wrong with hufUnpackEncTable";for(;B--;)U[S++]=0;S--}}ee(U)}function ye(o){return o&63}function me(o){return o>>6}function Ae(o,h,m,x){for(;h<=m;h++){var S=me(o[h]),R=ye(o[h]);if(S>>R)throw"Invalid table entry";if(R>14){var U=x[S>>R-14];if(U.len)throw"Invalid table entry";if(U.lit++,U.p){var P=U.p;U.p=new Array(U.lit);for(var G=0;G<U.lit-1;++G)U.p[G]=P[G]}else U.p=new Array(1);U.p[U.lit-1]=h}else if(R)for(var H=0,G=1<<14-R;G>0;G--){var U=x[(S<<14-R)+H];if(U.len||U.p)throw"Invalid table entry";U.len=R,U.lit=h,H++}}return!0}const J={c:0,lc:0};function ue(o,h,m,x){o=o<<8|_t(m,x),h+=8,J.c=o,J.lc=h}const ie={c:0,lc:0};function ce(o,h,m,x,S,R,U,P,G,H){if(o==h){x<8&&(ue(m,x,S,U),m=J.c,x=J.lc),x-=8;var z=m>>x,z=new Uint8Array([z])[0];if(G.value+z>H)return!1;for(var B=P[G.value-1];z-- >0;)P[G.value++]=B}else if(G.value<H)P[G.value++]=o;else return!1;ie.c=m,ie.lc=x}function xe(o){return o&65535}function Pe(o){var h=xe(o);return h>32767?h-65536:h}const ae={a:0,b:0};function Ie(o,h){var m=Pe(o),x=Pe(h),S=x,R=m+(S&1)+(S>>1),U=R,P=R-S;ae.a=U,ae.b=P}function be(o,h){var m=xe(o),x=xe(h),S=m-(x>>1)&65535,R=x+S-32768&65535;ae.a=R,ae.b=S}function ke(o,h,m,x,S,R,U){for(var P=U<16384,G=m>S?S:m,H=1,z;H<=G;)H<<=1;for(H>>=1,z=H,H>>=1;H>=1;){for(var B=0,Te=B+R*(S-z),V=R*H,Y=R*z,te=x*H,re=x*z,he,fe,Se,De;B<=Te;B+=Y){for(var pe=B,nt=B+x*(m-z);pe<=nt;pe+=re){var ge=pe+te,Re=pe+V,dt=Re+te;P?(Ie(o[pe+h],o[Re+h]),he=ae.a,Se=ae.b,Ie(o[ge+h],o[dt+h]),fe=ae.a,De=ae.b,Ie(he,fe),o[pe+h]=ae.a,o[ge+h]=ae.b,Ie(Se,De),o[Re+h]=ae.a,o[dt+h]=ae.b):(be(o[pe+h],o[Re+h]),he=ae.a,Se=ae.b,be(o[ge+h],o[dt+h]),fe=ae.a,De=ae.b,be(he,fe),o[pe+h]=ae.a,o[ge+h]=ae.b,be(Se,De),o[Re+h]=ae.a,o[dt+h]=ae.b)}if(m&H){var Re=pe+V;P?Ie(o[pe+h],o[Re+h]):be(o[pe+h],o[Re+h]),he=ae.a,o[Re+h]=ae.b,o[pe+h]=he}}if(S&H)for(var pe=B,nt=B+x*(m-z);pe<=nt;pe+=re){var ge=pe+te;P?Ie(o[pe+h],o[ge+h]):be(o[pe+h],o[ge+h]),he=ae.a,o[ge+h]=ae.b,o[pe+h]=he}z=H,H>>=1}return B}function Fe(o,h,m,x,S,R,U,P,G,H){for(var z=0,B=0,Te=P,V=Math.trunc(S.value+(R+7)/8);S.value<V;)for(ue(z,B,m,S),z=J.c,B=J.lc;B>=14;){var Y=z>>B-14&16383,te=h[Y];if(te.len)B-=te.len,ce(te.lit,U,z,B,m,x,S,G,H,Te),z=ie.c,B=ie.lc;else{if(!te.p)throw"hufDecode issues";var re;for(re=0;re<te.lit;re++){for(var he=ye(o[te.p[re]]);B<he&&S.value<V;)ue(z,B,m,S),z=J.c,B=J.lc;if(B>=he&&me(o[te.p[re]])==(z>>B-he&(1<<he)-1)){B-=he,ce(te.p[re],U,z,B,m,x,S,G,H,Te),z=ie.c,B=ie.lc;break}}if(re==te.lit)throw"hufDecode issues"}}var fe=8-R&7;for(z>>=fe,B-=fe;B>0;){var te=h[z<<14-B&16383];if(te.len)B-=te.len,ce(te.lit,U,z,B,m,x,S,G,H,Te),z=ie.c,B=ie.lc;else throw"hufDecode issues"}return!0}function Ne(o,h,m,x,S,R){var U={value:0},P=m.value,G=Me(h,m),H=Me(h,m);m.value+=4;var z=Me(h,m);if(m.value+=4,G<0||G>=65537||H<0||H>=65537)throw"Something wrong with HUF_ENCSIZE";var B=new Array(65537),Te=new Array(16384);W(Te);var V=x-(m.value-P);if($(o,h,m,V,G,H,B),z>8*(x-(m.value-P)))throw"Something wrong with hufUncompress";Ae(B,G,H,Te),Fe(B,Te,o,h,m,z,H,R,S,U)}function vt(o,h,m){for(var x=0;x<m;++x)h[x]=o[h[x]]}function at(o){for(var h=1;h<o.length;h++){var m=o[h-1]+o[h]-128;o[h]=m}}function ot(o,h){for(var m=0,x=Math.floor((o.length+1)/2),S=0,R=o.length-1;!(S>R||(h[S++]=o[m++],S>R));)h[S++]=o[x++]}function yt(o){for(var h=o.byteLength,m=new Array,x=0,S=new DataView(o);h>0;){var R=S.getInt8(x++);if(R<0){var U=-R;h-=U+1;for(var P=0;P<U;P++)m.push(S.getUint8(x++))}else{var U=R;h-=2;for(var G=S.getUint8(x++),P=0;P<U+1;P++)m.push(G)}}return m}function Pt(o,h,m,x,S,R){var ge=new DataView(R.buffer),U=m[o.idx[0]].width,P=m[o.idx[0]].height,G=3,H=Math.floor(U/8),z=Math.ceil(U/8),B=Math.ceil(P/8),Te=U-(z-1)*8,V=P-(B-1)*8,Y={value:0},te=new Array(G),re=new Array(G),he=new Array(G),fe=new Array(G),Se=new Array(G);for(let de=0;de<G;++de)Se[de]=h[o.idx[de]],te[de]=de<1?0:te[de-1]+z*B,re[de]=new Float32Array(64),he[de]=new Uint16Array(64),fe[de]=new Uint16Array(z*64);for(let de=0;de<B;++de){var De=8;de==B-1&&(De=V);var pe=8;for(let we=0;we<z;++we){we==z-1&&(pe=Te);for(let le=0;le<G;++le)he[le].fill(0),he[le][0]=S[te[le]++],At(Y,x,he[le]),wt(he[le],re[le]),Tt(re[le]);kt(re);for(let le=0;le<G;++le)Ft(re[le],fe[le],we*64)}let Ce=0;for(let we=0;we<G;++we){const le=m[o.idx[we]].type;for(let je=8*de;je<8*de+De;++je){Ce=Se[we][je];for(let zt=0;zt<H;++zt){const Ue=zt*64+(je&7)*8;ge.setUint16(Ce+0*le,fe[we][Ue+0],!0),ge.setUint16(Ce+2*le,fe[we][Ue+1],!0),ge.setUint16(Ce+4*le,fe[we][Ue+2],!0),ge.setUint16(Ce+6*le,fe[we][Ue+3],!0),ge.setUint16(Ce+8*le,fe[we][Ue+4],!0),ge.setUint16(Ce+10*le,fe[we][Ue+5],!0),ge.setUint16(Ce+12*le,fe[we][Ue+6],!0),ge.setUint16(Ce+14*le,fe[we][Ue+7],!0),Ce+=16*le}}if(H!=z)for(let je=8*de;je<8*de+De;++je){const zt=Se[we][je]+8*H*2*le,Ue=H*64+(je&7)*8;for(let xt=0;xt<pe;++xt)ge.setUint16(zt+xt*2*le,fe[we][Ue+xt],!0)}}}for(var nt=new Uint16Array(U),ge=new DataView(R.buffer),Re=0;Re<G;++Re){m[o.idx[Re]].decoded=!0;var dt=m[o.idx[Re]].type;if(m[Re].type==2)for(var rn=0;rn<P;++rn){const de=Se[Re][rn];for(var ze=0;ze<U;++ze)nt[ze]=ge.getUint16(de+ze*2*dt,!0);for(var ze=0;ze<U;++ze)ge.setFloat32(de+ze*2*dt,F(nt[ze]),!0)}}}function At(o,h,m){for(var x,S=1;S<64;)x=h[o.value],x==65280?S=64:x>>8==255?S+=x&255:(m[S]=x,S++),o.value++}function wt(o,h){h[0]=F(o[0]),h[1]=F(o[1]),h[2]=F(o[5]),h[3]=F(o[6]),h[4]=F(o[14]),h[5]=F(o[15]),h[6]=F(o[27]),h[7]=F(o[28]),h[8]=F(o[2]),h[9]=F(o[4]),h[10]=F(o[7]),h[11]=F(o[13]),h[12]=F(o[16]),h[13]=F(o[26]),h[14]=F(o[29]),h[15]=F(o[42]),h[16]=F(o[3]),h[17]=F(o[8]),h[18]=F(o[12]),h[19]=F(o[17]),h[20]=F(o[25]),h[21]=F(o[30]),h[22]=F(o[41]),h[23]=F(o[43]),h[24]=F(o[9]),h[25]=F(o[11]),h[26]=F(o[18]),h[27]=F(o[24]),h[28]=F(o[31]),h[29]=F(o[40]),h[30]=F(o[44]),h[31]=F(o[53]),h[32]=F(o[10]),h[33]=F(o[19]),h[34]=F(o[23]),h[35]=F(o[32]),h[36]=F(o[39]),h[37]=F(o[45]),h[38]=F(o[52]),h[39]=F(o[54]),h[40]=F(o[20]),h[41]=F(o[22]),h[42]=F(o[33]),h[43]=F(o[38]),h[44]=F(o[46]),h[45]=F(o[51]),h[46]=F(o[55]),h[47]=F(o[60]),h[48]=F(o[21]),h[49]=F(o[34]),h[50]=F(o[37]),h[51]=F(o[47]),h[52]=F(o[50]),h[53]=F(o[56]),h[54]=F(o[59]),h[55]=F(o[61]),h[56]=F(o[35]),h[57]=F(o[36]),h[58]=F(o[48]),h[59]=F(o[49]),h[60]=F(o[57]),h[61]=F(o[58]),h[62]=F(o[62]),h[63]=F(o[63])}function Tt(o){const h=.5*Math.cos(.7853975),m=.5*Math.cos(3.14159/16),x=.5*Math.cos(3.14159/8),S=.5*Math.cos(3*3.14159/16),R=.5*Math.cos(5*3.14159/16),U=.5*Math.cos(3*3.14159/8),P=.5*Math.cos(7*3.14159/16);for(var G=new Array(4),H=new Array(4),z=new Array(4),B=new Array(4),Te=0;Te<8;++Te){var V=Te*8;G[0]=x*o[V+2],G[1]=U*o[V+2],G[2]=x*o[V+6],G[3]=U*o[V+6],H[0]=m*o[V+1]+S*o[V+3]+R*o[V+5]+P*o[V+7],H[1]=S*o[V+1]-P*o[V+3]-m*o[V+5]-R*o[V+7],H[2]=R*o[V+1]-m*o[V+3]+P*o[V+5]+S*o[V+7],H[3]=P*o[V+1]-R*o[V+3]+S*o[V+5]-m*o[V+7],z[0]=h*(o[V+0]+o[V+4]),z[3]=h*(o[V+0]-o[V+4]),z[1]=G[0]+G[3],z[2]=G[1]-G[2],B[0]=z[0]+z[1],B[1]=z[3]+z[2],B[2]=z[3]-z[2],B[3]=z[0]-z[1],o[V+0]=B[0]+H[0],o[V+1]=B[1]+H[1],o[V+2]=B[2]+H[2],o[V+3]=B[3]+H[3],o[V+4]=B[3]-H[3],o[V+5]=B[2]-H[2],o[V+6]=B[1]-H[1],o[V+7]=B[0]-H[0]}for(var Y=0;Y<8;++Y)G[0]=x*o[16+Y],G[1]=U*o[16+Y],G[2]=x*o[48+Y],G[3]=U*o[48+Y],H[0]=m*o[8+Y]+S*o[24+Y]+R*o[40+Y]+P*o[56+Y],H[1]=S*o[8+Y]-P*o[24+Y]-m*o[40+Y]-R*o[56+Y],H[2]=R*o[8+Y]-m*o[24+Y]+P*o[40+Y]+S*o[56+Y],H[3]=P*o[8+Y]-R*o[24+Y]+S*o[40+Y]-m*o[56+Y],z[0]=h*(o[Y]+o[32+Y]),z[3]=h*(o[Y]-o[32+Y]),z[1]=G[0]+G[3],z[2]=G[1]-G[2],B[0]=z[0]+z[1],B[1]=z[3]+z[2],B[2]=z[3]-z[2],B[3]=z[0]-z[1],o[0+Y]=B[0]+H[0],o[8+Y]=B[1]+H[1],o[16+Y]=B[2]+H[2],o[24+Y]=B[3]+H[3],o[32+Y]=B[3]-H[3],o[40+Y]=B[2]-H[2],o[48+Y]=B[1]-H[1],o[56+Y]=B[0]-H[0]}function kt(o){for(var h=0;h<64;++h){var m=o[0][h],x=o[1][h],S=o[2][h];o[0][h]=m+1.5747*S,o[1][h]=m-.1873*x-.4682*S,o[2][h]=m+1.8556*x}}function Ft(o,h,m){for(var x=0;x<64;++x)h[m+x]=Vt.toHalfFloat(Et(o[x]))}function Et(o){return o<=1?Math.sign(o)*Math.pow(Math.abs(o),2.2):Math.sign(o)*Math.pow(L,Math.abs(o)-1)}function Je(o){return new DataView(o.array.buffer,o.offset.value,o.size)}function Ve(o){var h=o.viewer.buffer.slice(o.offset.value,o.offset.value+o.size),m=new Uint8Array(yt(h)),x=new Uint8Array(m.length);return at(m),ot(m,x),new DataView(x.buffer)}function ct(o){var h=o.array.slice(o.offset.value,o.offset.value+o.size),m=vn(h),x=new Uint8Array(m.length);return at(m),ot(m,x),new DataView(x.buffer)}function Ut(o){for(var h=o.viewer,m={value:o.offset.value},x=new Uint16Array(o.width*o.scanlineBlockSize*(o.channels*o.type)),S=new Uint8Array(8192),R=0,U=new Array(o.channels),P=0;P<o.channels;P++)U[P]={},U[P].start=R,U[P].end=U[P].start,U[P].nx=o.width,U[P].ny=o.lines,U[P].size=o.type,R+=U[P].nx*U[P].ny*U[P].size;var G=_e(h,m),H=_e(h,m);if(H>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(G<=H)for(var P=0;P<H-G+1;P++)S[P+G]=A(h,m);var z=new Uint16Array(65536),B=N(S,z),Te=Me(h,m);Ne(o.array,h,m,Te,x,R);for(var P=0;P<o.channels;++P)for(var V=U[P],Y=0;Y<U[P].size;++Y)ke(x,V.start+Y,V.nx,V.size,V.ny,V.nx*V.size,B);vt(z,x,R);for(var te=0,re=new Uint8Array(x.buffer.byteLength),he=0;he<o.lines;he++)for(var fe=0;fe<o.channels;fe++){var V=U[fe],Se=V.nx*V.size,De=new Uint8Array(x.buffer,V.end*2,Se*2);re.set(De,te),te+=Se*2,V.end+=Se}return new DataView(re.buffer)}function bt(o){var h=o.array.slice(o.offset.value,o.offset.value+o.size),m=vn(h);const x=o.lines*o.channels*o.width,S=o.type==1?new Uint16Array(x):new Uint32Array(x);let R=0,U=0;const P=new Array(4);for(let G=0;G<o.lines;G++)for(let H=0;H<o.channels;H++){let z=0;switch(o.type){case 1:P[0]=R,P[1]=P[0]+o.width,R=P[1]+o.width;for(let B=0;B<o.width;++B){const Te=m[P[0]++]<<8|m[P[1]++];z+=Te,S[U]=z,U++}break;case 2:P[0]=R,P[1]=P[0]+o.width,P[2]=P[1]+o.width,R=P[2]+o.width;for(let B=0;B<o.width;++B){const Te=m[P[0]++]<<24|m[P[1]++]<<16|m[P[2]++]<<8;z+=Te,S[U]=z,U++}break}}return new DataView(S.buffer)}function et(o){var h=o.viewer,m={value:o.offset.value},x=new Uint8Array(o.width*o.lines*(o.channels*o.type*2)),S={version:k(h,m),unknownUncompressedSize:k(h,m),unknownCompressedSize:k(h,m),acCompressedSize:k(h,m),dcCompressedSize:k(h,m),rleCompressedSize:k(h,m),rleUncompressedSize:k(h,m),rleRawSize:k(h,m),totalAcUncompressedCount:k(h,m),totalDcUncompressedCount:k(h,m),acCompression:k(h,m)};if(S.version<2)throw"EXRLoader.parse: "+nn.compression+" version "+S.version+" is unsupported";for(var R=new Array,U=_e(h,m)-2;U>0;){var P=Ge(h.buffer,m),G=A(h,m),H=G>>2&3,z=(G>>4)-1,B=new Int8Array([z])[0],Te=A(h,m);R.push({name:P,index:B,type:Te,compression:H}),U-=P.length+3}for(var V=nn.channels,Y=new Array(o.channels),te=0;te<o.channels;++te){var re=Y[te]={},he=V[te];re.name=he.name,re.compression=0,re.decoded=!1,re.type=he.pixelType,re.pLinear=he.pLinear,re.width=o.width,re.height=o.lines}for(var fe={idx:new Array(3)},Se=0;Se<o.channels;++Se)for(var re=Y[Se],te=0;te<R.length;++te){var De=R[te];re.name==De.name&&(re.compression=De.compression,De.index>=0&&(fe.idx[De.index]=Se),re.offset=Se)}if(S.acCompressedSize>0)switch(S.acCompression){case 0:var ge=new Uint16Array(S.totalAcUncompressedCount);Ne(o.array,h,m,S.acCompressedSize,ge,S.totalAcUncompressedCount);break;case 1:var pe=o.array.slice(m.value,m.value+S.totalAcUncompressedCount),nt=vn(pe),ge=new Uint16Array(nt.buffer);m.value+=S.totalAcUncompressedCount;break}if(S.dcCompressedSize>0){var Re={array:o.array,offset:m,size:S.dcCompressedSize},dt=new Uint16Array(ct(Re).buffer);m.value+=S.dcCompressedSize}if(S.rleRawSize>0){var pe=o.array.slice(m.value,m.value+S.rleCompressedSize),nt=vn(pe),rn=yt(nt.buffer);m.value+=S.rleCompressedSize}for(var ze=0,de=new Array(Y.length),te=0;te<de.length;++te)de[te]=new Array;for(var Ce=0;Ce<o.lines;++Ce)for(var we=0;we<Y.length;++we)de[we].push(ze),ze+=Y[we].width*o.type*2;Pt(fe,de,Y,ge,dt,x);for(var te=0;te<Y.length;++te){var re=Y[te];if(!re.decoded)switch(re.compression){case 2:for(var le=0,je=0,Ce=0;Ce<o.lines;++Ce){for(var zt=de[te][le],Ue=0;Ue<re.width;++Ue){for(var xt=0;xt<2*re.type;++xt)x[zt++]=rn[je+xt*re.width*re.height];je++}le++}break;case 1:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(x.buffer)}function Ge(o,h){for(var m=new Uint8Array(o),x=0;m[h.value+x]!=0;)x+=1;var S=new TextDecoder().decode(m.slice(h.value,h.value+x));return h.value=h.value+x+1,S}function lt(o,h,m){var x=new TextDecoder().decode(new Uint8Array(o).slice(h.value,h.value+m));return h.value=h.value+m,x}function tt(o,h){var m=ht(o,h),x=Me(o,h);return[m,x]}function ut(o,h){var m=Me(o,h),x=Me(o,h);return[m,x]}function ht(o,h){var m=o.getInt32(h.value,!0);return h.value=h.value+4,m}function Me(o,h){var m=o.getUint32(h.value,!0);return h.value=h.value+4,m}function _t(o,h){var m=o[h.value];return h.value=h.value+1,m}function A(o,h){var m=o.getUint8(h.value);return h.value=h.value+1,m}const k=function(o,h){let m;return"getBigInt64"in DataView.prototype?m=Number(o.getBigInt64(h.value,!0)):m=o.getUint32(h.value+4,!0)+Number(o.getUint32(h.value,!0)<<32),h.value+=8,m};function X(o,h){var m=o.getFloat32(h.value,!0);return h.value+=4,m}function ne(o,h){return Vt.toHalfFloat(X(o,h))}function F(o){var h=(o&31744)>>10,m=o&1023;return(o>>15?-1:1)*(h?h===31?m?NaN:1/0:Math.pow(2,h-15)*(1+m/1024):6103515625e-14*(m/1024))}function _e(o,h){var m=o.getUint16(h.value,!0);return h.value+=2,m}function Le(o,h){return F(_e(o,h))}function rr(o,h,m,x){for(var S=m.value,R=[];m.value<S+x-1;){var U=Ge(h,m),P=ht(o,m),G=A(o,m);m.value+=3;var H=ht(o,m),z=ht(o,m);R.push({name:U,pixelType:P,pLinear:G,xSampling:H,ySampling:z})}return m.value+=1,R}function mn(o,h){var m=X(o,h),x=X(o,h),S=X(o,h),R=X(o,h),U=X(o,h),P=X(o,h),G=X(o,h),H=X(o,h);return{redX:m,redY:x,greenX:S,greenY:R,blueX:U,blueY:P,whiteX:G,whiteY:H}}function Ye(o,h){var m=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],x=A(o,h);return m[x]}function qe(o,h){var m=Me(o,h),x=Me(o,h),S=Me(o,h),R=Me(o,h);return{xMin:m,yMin:x,xMax:S,yMax:R}}function Bt(o,h){var m=["INCREASING_Y"],x=A(o,h);return m[x]}function Ht(o,h){var m=X(o,h),x=X(o,h);return[m,x]}function Gt(o,h){var m=X(o,h),x=X(o,h),S=X(o,h);return[m,x,S]}function Zt(o,h,m,x,S){if(x==="string"||x==="stringvector"||x==="iccProfile")return lt(h,m,S);if(x==="chlist")return rr(o,h,m,S);if(x==="chromaticities")return mn(o,m);if(x==="compression")return Ye(o,m);if(x==="box2i")return qe(o,m);if(x==="lineOrder")return Bt(o,m);if(x==="float")return X(o,m);if(x==="v2f")return Ht(o,m);if(x==="v3f")return Gt(o,m);if(x==="int")return ht(o,m);if(x==="rational")return tt(o,m);if(x==="timecode")return ut(o,m);if(x==="preview")return m.value+=S,"skipped";m.value+=S}function es(o,h,m){const x={};if(o.getUint32(0,!0)!=20000630)throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";x.version=o.getUint8(4);const S=o.getUint8(5);x.spec={singleTile:!!(S&2),longName:!!(S&4),deepFormat:!!(S&8),multiPart:!!(S&16)},m.value=8;for(var R=!0;R;){var U=Ge(h,m);if(U==0)R=!1;else{var P=Ge(h,m),G=Me(o,m),H=Zt(o,h,m,P,G);H===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${P}'.`):x[U]=H}}if((S&-5)!=0)throw console.error("EXRHeader:",x),"THREE.EXRLoader: provided file is currently unsupported.";return x}function ts(o,h,m,x,S){const R={size:0,viewer:h,array:m,offset:x,width:o.dataWindow.xMax-o.dataWindow.xMin+1,height:o.dataWindow.yMax-o.dataWindow.yMin+1,channels:o.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:o.channels[0].pixelType,uncompress:null,getter:null,format:null,[an?"colorSpace":"encoding"]:null};switch(o.compression){case"NO_COMPRESSION":R.lines=1,R.uncompress=Je;break;case"RLE_COMPRESSION":R.lines=1,R.uncompress=Ve;break;case"ZIPS_COMPRESSION":R.lines=1,R.uncompress=ct;break;case"ZIP_COMPRESSION":R.lines=16,R.uncompress=ct;break;case"PIZ_COMPRESSION":R.lines=32,R.uncompress=Ut;break;case"PXR24_COMPRESSION":R.lines=16,R.uncompress=bt;break;case"DWAA_COMPRESSION":R.lines=32,R.uncompress=et;break;case"DWAB_COMPRESSION":R.lines=256,R.uncompress=et;break;default:throw"EXRLoader.parse: "+o.compression+" is unsupported"}if(R.scanlineBlockSize=R.lines,R.type==1)switch(S){case mt:R.getter=Le,R.inputSize=2;break;case He:R.getter=_e,R.inputSize=2;break}else if(R.type==2)switch(S){case mt:R.getter=X,R.inputSize=4;break;case He:R.getter=ne,R.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+R.type+" for "+o.compression+".";R.blockCount=(o.dataWindow.yMax+1)/R.scanlineBlockSize;for(var U=0;U<R.blockCount;U++)k(h,x);R.outputChannels=R.channels==3?4:R.channels;const P=R.width*R.height*R.outputChannels;switch(S){case mt:R.byteArray=new Float32Array(P),R.channels<R.outputChannels&&R.byteArray.fill(1,0,P);break;case He:R.byteArray=new Uint16Array(P),R.channels<R.outputChannels&&R.byteArray.fill(15360,0,P);break;default:console.error("THREE.EXRLoader: unsupported type: ",S);break}return R.bytesPerLine=R.width*R.inputSize*R.channels,R.outputChannels==4?R.format=dn:R.format=ks,an?R.colorSpace="srgb-linear":R.encoding=3e3,R}const gn=new DataView(e),ns=new Uint8Array(e),tn={value:0},nn=es(gn,e,tn),oe=ts(nn,gn,ns,tn,this.type),sr={value:0},rs={R:0,G:1,B:2,A:3,Y:0};for(let o=0;o<oe.height/oe.scanlineBlockSize;o++){const h=Me(gn,tn);oe.size=Me(gn,tn),oe.lines=h+oe.scanlineBlockSize>oe.height?oe.height-h:oe.scanlineBlockSize;const x=oe.size<oe.lines*oe.bytesPerLine?oe.uncompress(oe):Je(oe);tn.value+=oe.size;for(let S=0;S<oe.scanlineBlockSize;S++){const R=S+o*oe.scanlineBlockSize;if(R>=oe.height)break;for(let U=0;U<oe.channels;U++){const P=rs[nn.channels[U].name];for(let G=0;G<oe.width;G++){sr.value=(S*(oe.channels*oe.width)+U*oe.width+G)*oe.inputSize;const H=(oe.height-1-R)*(oe.width*oe.outputChannels)+G*oe.outputChannels+P;oe.byteArray[H]=oe.getter(x,sr)}}}}return{header:nn,width:oe.width,height:oe.height,data:oe.byteArray,format:oe.format,[an?"colorSpace":"encoding"]:oe[an?"colorSpace":"encoding"],type:this.type}}setDataType(e){return this.type=e,this}load(e,n,t,r){function i(s,c){an?s.colorSpace=c.colorSpace:s.encoding=c.encoding,s.minFilter=Xe,s.magFilter=Xe,s.generateMipmaps=!1,s.flipY=!1,n&&n(s,c)}return super.load(e,i,t,r)}}const Nn=new WeakMap;class to extends Kn{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,n,t,r){const i=new Nt(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,s=>{const c={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(s,c).then(n).catch(r)},t,r)}decodeDracoFile(e,n,t,r){const i={attributeIDs:t||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!t};this.decodeGeometry(e,i).then(n)}decodeGeometry(e,n){for(const a in n.attributeTypes){const u=n.attributeTypes[a];u.BYTES_PER_ELEMENT!==void 0&&(n.attributeTypes[a]=u.name)}const t=JSON.stringify(n);if(Nn.has(e)){const a=Nn.get(e);if(a.key===t)return a.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let r;const i=this.workerNextTaskID++,s=e.byteLength,c=this._getWorker(i,s).then(a=>(r=a,new Promise((u,d)=>{r._callbacks[i]={resolve:u,reject:d},r.postMessage({type:"decode",id:i,taskConfig:n,buffer:e},[e])}))).then(a=>this._createGeometry(a.geometry));return c.catch(()=>!0).then(()=>{r&&i&&this._releaseTask(r,i)}),Nn.set(e,{key:t,promise:c}),c}_createGeometry(e){const n=new Mr;e.index&&n.setIndex(new Ot(e.index.array,1));for(let t=0;t<e.attributes.length;t++){const r=e.attributes[t],i=r.name,s=r.array,c=r.itemSize;n.setAttribute(i,new Ot(s,c))}return n}_loadLibrary(e,n){const t=new Nt(this.manager);return t.setPath(this.decoderPath),t.setResponseType(n),t.setWithCredentials(this.withCredentials),new Promise((r,i)=>{t.load(e,r,void 0,i)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",n=[];return e?n.push(this._loadLibrary("draco_decoder.js","text")):(n.push(this._loadLibrary("draco_wasm_wrapper.js","text")),n.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(n).then(t=>{const r=t[0];e||(this.decoderConfig.wasmBinary=t[1]);const i=pa.toString(),s=["/* draco decoder */",r,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([s]))}),this.decoderPending}_getWorker(e,n){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const r=new Worker(this.workerSourceURL);r._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:this.decoderConfig}),r.onmessage=function(i){const s=i.data;switch(s.type){case"decode":r._callbacks[s.id].resolve(s);break;case"error":r._callbacks[s.id].reject(s);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+s.type+'"')}},this.workerPool.push(r)}else this.workerPool.sort(function(r,i){return r._taskLoad>i._taskLoad?-1:1});const t=this.workerPool[this.workerPool.length-1];return t._taskCosts[e]=n,t._taskLoad+=n,t})}_releaseTask(e,n){e._taskLoad-=e._taskCosts[n],delete e._callbacks[n],delete e._taskCosts[n]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function pa(){let l,e;onmessage=function(s){const c=s.data;switch(c.type){case"init":l=c.decoderConfig,e=new Promise(function(d){l.onModuleLoaded=function(p){d({draco:p})},DracoDecoderModule(l)});break;case"decode":const a=c.buffer,u=c.taskConfig;e.then(d=>{const p=d.draco,f=new p.Decoder,v=new p.DecoderBuffer;v.Init(new Int8Array(a),a.byteLength);try{const w=n(p,f,v,u),g=w.attributes.map(y=>y.array.buffer);w.index&&g.push(w.index.array.buffer),self.postMessage({type:"decode",id:c.id,geometry:w},g)}catch(w){console.error(w),self.postMessage({type:"error",id:c.id,error:w.message})}finally{p.destroy(v),p.destroy(f)}});break}};function n(s,c,a,u){const d=u.attributeIDs,p=u.attributeTypes;let f,v;const w=c.GetEncodedGeometryType(a);if(w===s.TRIANGULAR_MESH)f=new s.Mesh,v=c.DecodeBufferToMesh(a,f);else if(w===s.POINT_CLOUD)f=new s.PointCloud,v=c.DecodeBufferToPointCloud(a,f);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!v.ok()||f.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+v.error_msg());const g={index:null,attributes:[]};for(const y in d){const b=self[p[y]];let E,D;if(u.useUniqueIDs)D=d[y],E=c.GetAttributeByUniqueId(f,D);else{if(D=c.GetAttributeId(f,s[d[y]]),D===-1)continue;E=c.GetAttribute(f,D)}g.attributes.push(r(s,c,f,y,b,E))}return w===s.TRIANGULAR_MESH&&(g.index=t(s,c,f)),s.destroy(f),g}function t(s,c,a){const d=a.num_faces()*3,p=d*4,f=s._malloc(p);c.GetTrianglesUInt32Array(a,p,f);const v=new Uint32Array(s.HEAPF32.buffer,f,d).slice();return s._free(f),{array:v,itemSize:1}}function r(s,c,a,u,d,p){const f=p.num_components(),w=a.num_points()*f,g=w*d.BYTES_PER_ELEMENT,y=i(s,d),b=s._malloc(g);c.GetAttributeDataArrayForAllPoints(a,p,y,g,b);const E=new d(s.HEAPF32.buffer,b,w).slice();return s._free(b),{name:u,array:E,itemSize:f}}function i(s,c){switch(c){case Float32Array:return s.DT_FLOAT32;case Int8Array:return s.DT_INT8;case Int16Array:return s.DT_INT16;case Int32Array:return s.DT_INT32;case Uint8Array:return s.DT_UINT8;case Uint16Array:return s.DT_UINT16;case Uint32Array:return s.DT_UINT32}}}function Wr(l,e,n,t){var r;return r=class extends $t{constructor(i){super({vertexShader:e,fragmentShader:n,...i});for(const s in l)this.uniforms[s]=new Fs(l[s]),Object.defineProperty(this,s,{get(){return this.uniforms[s].value},set(c){this.uniforms[s].value=c}});this.uniforms=Us.clone(this.uniforms),t?.(this)}},r.key=un.generateUUID(),r}const ma=()=>parseInt(Ar.replace(/\D+/g,"")),Zr=ma();function ga(l,{keys:e=["near","far","color","distance","decay","penumbra","angle","intensity","skeleton","visible","castShadow","receiveShadow","morphTargetDictionary","morphTargetInfluences","name","geometry","material","position","rotation","scale","up","userData","bindMode","bindMatrix","bindMatrixInverse","skeleton"],deep:n,inject:t,castShadow:r,receiveShadow:i}){let s={};for(const c of e)s[c]=l[c];return n&&(s.geometry&&n!=="materialsOnly"&&(s.geometry=s.geometry.clone()),s.material&&n!=="geometriesOnly"&&(s.material=s.material.clone())),t&&(typeof t=="function"?s={...s,children:t(l)}:I.isValidElement(t)?s={...s,children:t}:s={...s,...t}),l instanceof Jt&&(r&&(s.castShadow=!0),i&&(s.receiveShadow=!0)),s}const vr=I.forwardRef(({isChild:l=!1,object:e,children:n,deep:t,castShadow:r,receiveShadow:i,inject:s,keys:c,...a},u)=>{const d={keys:c,deep:t,inject:s,castShadow:r,receiveShadow:i};if(e=I.useMemo(()=>{if(l===!1&&!Array.isArray(e)){let w=!1;if(e.traverse(g=>{g.isSkinnedMesh&&(w=!0)}),w)return Ti.clone(e)}return e},[e,l]),Array.isArray(e))return I.createElement("group",Oe({},a,{ref:u}),e.map(w=>I.createElement(vr,Oe({key:w.uuid,object:w},d))),n);const{children:p,...f}=ga(e,d),v=e.type[0].toLowerCase()+e.type.slice(1);return I.createElement(v,Oe({},f,a,{ref:u}),e.children.map(w=>w.type==="Bone"?I.createElement("primitive",Oe({key:w.uuid,object:w},d)):I.createElement(vr,Oe({key:w.uuid,object:w},d,{isChild:!0}))),n,p)}),no=I.forwardRef(({makeDefault:l,camera:e,regress:n,domElement:t,enableDamping:r=!0,keyEvents:i=!1,onChange:s,onStart:c,onEnd:a,...u},d)=>{const p=Ee(T=>T.invalidate),f=Ee(T=>T.camera),v=Ee(T=>T.gl),w=Ee(T=>T.events),g=Ee(T=>T.setEvents),y=Ee(T=>T.set),b=Ee(T=>T.get),E=Ee(T=>T.performance),D=e||f,C=t||w.connected||v.domElement,_=I.useMemo(()=>new Gr(D),[D]);return en(()=>{_.enabled&&_.update()},-1),I.useEffect(()=>(i&&_.connect(i===!0?C:i),_.connect(C),()=>void _.dispose()),[i,C,n,_,p]),I.useEffect(()=>{const T=L=>{p(),n&&E.regress(),s&&s(L)},O=L=>{c&&c(L)},M=L=>{a&&a(L)};return _.addEventListener("change",T),_.addEventListener("start",O),_.addEventListener("end",M),()=>{_.removeEventListener("start",O),_.removeEventListener("end",M),_.removeEventListener("change",T)}},[s,c,a,_,p,g]),I.useEffect(()=>{if(l){const T=b().controls;return y({controls:_}),()=>y({controls:T})}},[l,_]),I.createElement("primitive",Oe({ref:d,object:_,enableDamping:r},u))}),va=I.forwardRef(function({children:e,object:n,disable:t,disableX:r,disableY:i,disableZ:s,left:c,right:a,top:u,bottom:d,front:p,back:f,onCentered:v,precise:w=!0,cacheKey:g=0,...y},b){const E=I.useRef(null),D=I.useRef(null),C=I.useRef(null),[_]=I.useState(()=>new Xn),[T]=I.useState(()=>new Q),[O]=I.useState(()=>new Rr);return I.useLayoutEffect(()=>{D.current.matrixWorld.identity(),_.setFromObject(n??C.current,w);const M=_.max.x-_.min.x,L=_.max.y-_.min.y,N=_.max.z-_.min.z;_.getCenter(T),_.getBoundingSphere(O);const W=u?L/2:d?-L/2:0,K=c?-M/2:a?M/2:0,Z=p?N/2:f?-N/2:0;D.current.position.set(t||r?0:-T.x+K,t||i?0:-T.y+W,t||s?0:-T.z+Z),v?.({parent:E.current.parent,container:E.current,width:M,height:L,depth:N,boundingBox:_,boundingSphere:O,center:T,verticalAlignment:W,horizontalAlignment:K,depthAlignment:Z})},[g,v,u,c,p,t,r,i,s,n,w,a,d,f,_,T,O]),I.useImperativeHandle(b,()=>E.current,[]),I.createElement("group",Oe({ref:E},y),I.createElement("group",{ref:D},I.createElement("group",{ref:C},e)))}),ya=Wr({},"void main() { }","void main() { gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0); discard;  }");var We=(function(l){return l[l.NONE=0]="NONE",l[l.START=1]="START",l[l.ACTIVE=2]="ACTIVE",l})(We||{});const Kt=l=>l&&l.isOrthographicCamera,Aa=l=>l&&l.isBox3,wa=l=>1-Math.exp(-5*l)+.007*l,Kr=I.createContext(null);function Ta({children:l,maxDuration:e=1,margin:n=1.2,observe:t,fit:r,clip:i,interpolateFunc:s=wa,onFit:c}){const a=I.useRef(null),{camera:u,size:d,invalidate:p}=Ee(),f=Ee(_=>_.controls),v=I.useRef(c);v.current=c;const w=I.useRef({camPos:new Q,camRot:new Dt,camZoom:1}),g=I.useRef({camPos:void 0,camRot:void 0,camZoom:void 0,camUp:void 0,target:void 0}),y=I.useRef(We.NONE),b=I.useRef(0),[E]=I.useState(()=>new Xn),D=I.useMemo(()=>{function _(){const T=E.getSize(new Q),O=E.getCenter(new Q),M=Math.max(T.x,T.y,T.z),L=Kt(u)?M*4:M/(2*Math.atan(Math.PI*u.fov/360)),N=Kt(u)?M*4:L/u.aspect,W=n*Math.max(L,N);return{box:E,size:T,center:O,distance:W}}return{getSize:_,refresh(T){if(Aa(T))E.copy(T);else{const O=T||a.current;if(!O)return this;O.updateWorldMatrix(!0,!0),E.setFromObject(O)}if(E.isEmpty()){const O=u.position.length()||10;E.setFromCenterAndSize(new Q,new Q(O,O,O))}return w.current.camPos.copy(u.position),w.current.camRot.copy(u.quaternion),Kt(u)&&(w.current.camZoom=u.zoom),g.current.camPos=void 0,g.current.camRot=void 0,g.current.camZoom=void 0,g.current.camUp=void 0,g.current.target=void 0,this},reset(){const{center:T,distance:O}=_(),M=u.position.clone().sub(T).normalize();g.current.camPos=T.clone().addScaledVector(M,O),g.current.target=T.clone();const L=new rt().lookAt(g.current.camPos,g.current.target,u.up);return g.current.camRot=new Dt().setFromRotationMatrix(L),y.current=We.START,b.current=0,this},moveTo(T){return g.current.camPos=Array.isArray(T)?new Q(...T):T.clone(),y.current=We.START,b.current=0,this},lookAt({target:T,up:O}){g.current.target=Array.isArray(T)?new Q(...T):T.clone(),O?g.current.camUp=Array.isArray(O)?new Q(...O):O.clone():g.current.camUp=u.up.clone();const M=new rt().lookAt(g.current.camPos||u.position,g.current.target,g.current.camUp);return g.current.camRot=new Dt().setFromRotationMatrix(M),y.current=We.START,b.current=0,this},to({position:T,target:O}){return this.moveTo(T).lookAt({target:O})},fit(){if(!Kt(u))return this.reset();let T=0,O=0;const M=[new Q(E.min.x,E.min.y,E.min.z),new Q(E.min.x,E.max.y,E.min.z),new Q(E.min.x,E.min.y,E.max.z),new Q(E.min.x,E.max.y,E.max.z),new Q(E.max.x,E.max.y,E.max.z),new Q(E.max.x,E.max.y,E.min.z),new Q(E.max.x,E.min.y,E.max.z),new Q(E.max.x,E.min.y,E.min.z)],L=g.current.camPos||u.position,N=g.current.target||f?.target,W=g.current.camUp||u.up,K=N?new rt().lookAt(L,N,W).setPosition(L).invert():u.matrixWorldInverse;for(const ee of M)ee.applyMatrix4(K),T=Math.max(T,Math.abs(ee.y)),O=Math.max(O,Math.abs(ee.x));T*=2,O*=2;const Z=(u.top-u.bottom)/T,j=(u.right-u.left)/O;return g.current.camZoom=Math.min(Z,j)/n,y.current=We.START,b.current=0,v.current&&v.current(this.getSize()),this},clip(){const{distance:T}=_();return u.near=T/100,u.far=T*100,u.updateProjectionMatrix(),f&&(f.maxDistance=T*10,f.update()),p(),this}}},[E,u,f,n,p]);I.useLayoutEffect(()=>{if(f){const _=()=>{if(f&&g.current.target&&y.current!==We.NONE){const T=new Q().setFromMatrixColumn(u.matrix,2),O=w.current.camPos.distanceTo(f.target),M=(g.current.camPos||w.current.camPos).distanceTo(g.current.target),L=(1-b.current)*O+b.current*M;f.target.copy(u.position).addScaledVector(T,-L),f.update()}y.current=We.NONE};return f.addEventListener("start",_),()=>f.removeEventListener("start",_)}},[f]);const C=I.useRef(0);return I.useLayoutEffect(()=>{(t||C.current++===0)&&(D.refresh(),r&&D.reset().fit(),i&&D.clip())},[d,i,r,t,u,f]),en((_,T)=>{if(y.current===We.START)y.current=We.ACTIVE,p();else if(y.current===We.ACTIVE){if(b.current+=T/e,b.current>=1)g.current.camPos&&u.position.copy(g.current.camPos),g.current.camRot&&u.quaternion.copy(g.current.camRot),g.current.camUp&&u.up.copy(g.current.camUp),g.current.camZoom&&Kt(u)&&(u.zoom=g.current.camZoom),u.updateMatrixWorld(),u.updateProjectionMatrix(),f&&g.current.target&&(f.target.copy(g.current.target),f.update()),y.current=We.NONE;else{const O=s(b.current);g.current.camPos&&u.position.lerpVectors(w.current.camPos,g.current.camPos,O),g.current.camRot&&u.quaternion.slerpQuaternions(w.current.camRot,g.current.camRot,O),g.current.camUp&&u.up.set(0,1,0).applyQuaternion(u.quaternion),g.current.camZoom&&Kt(u)&&(u.zoom=(1-O)*w.current.camZoom+O*g.current.camZoom),u.updateMatrixWorld(),u.updateProjectionMatrix()}p()}}),I.createElement("group",{ref:a},I.createElement(Kr.Provider,{value:D},l))}function Ea(){return I.useContext(Kr)}const ro=I.forwardRef(({intensity:l=1,decay:e,decayRate:n=.65,maxYaw:t=.1,maxPitch:r=.1,maxRoll:i=.1,yawFrequency:s=.1,pitchFrequency:c=.1,rollFrequency:a=.1},u)=>{const d=Ee(E=>E.camera),p=Ee(E=>E.controls),f=I.useRef(l),v=I.useRef(d.rotation.clone()),[w]=I.useState(()=>new Ln),[g]=I.useState(()=>new Ln),[y]=I.useState(()=>new Ln),b=()=>{(f.current<0||f.current>1)&&(f.current=f.current<0?0:1)};return I.useImperativeHandle(u,()=>({getIntensity:()=>f.current,setIntensity:E=>{f.current=E,b()}}),[]),I.useEffect(()=>{if(p){const E=()=>void(v.current=d.rotation.clone());return p.addEventListener("change",E),E(),()=>void p.removeEventListener("change",E)}},[d,p]),en((E,D)=>{const C=Math.pow(f.current,2),_=t*C*w.noise(E.clock.elapsedTime*s,1),T=r*C*g.noise(E.clock.elapsedTime*c,1),O=i*C*y.noise(E.clock.elapsedTime*a,1);d.rotation.set(v.current.x+T,v.current.y+_,v.current.z+O),e&&f.current>0&&(f.current-=n*D,b())}),null}),Xr=(l,e,n)=>{let t;switch(l){case Gn:t=new Uint8ClampedArray(e*n*4);break;case He:t=new Uint16Array(e*n*4);break;case Ws:t=new Uint32Array(e*n*4);break;case js:t=new Int8Array(e*n*4);break;case zs:t=new Int16Array(e*n*4);break;case Gs:t=new Int32Array(e*n*4);break;case mt:t=new Float32Array(e*n*4);break;default:throw new Error("Unsupported data type")}return t};let An;const ba=(l,e,n,t)=>{if(An!==void 0)return An;const r=new Qt(1,1,t);e.setRenderTarget(r);const i=new Jt(new Vn,new Xt({color:16777215}));e.render(i,n),e.setRenderTarget(null);const s=Xr(l,r.width,r.height);return e.readRenderTargetPixels(r,0,0,r.width,r.height,s),r.dispose(),i.geometry.dispose(),i.material.dispose(),An=s[0]!==0,An};class qn{constructor(e){var n,t,r,i,s,c,a,u,d,p,f,v,w,g,y,b;this._rendererIsDisposable=!1,this._supportsReadPixels=!0,this.render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(D){throw this._renderer.setRenderTarget(null),D}this._renderer.setRenderTarget(null)},this._width=e.width,this._height=e.height,this._type=e.type,this._colorSpace=e.colorSpace;const E={format:dn,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:((n=e.renderTargetOptions)===null||n===void 0?void 0:n.anisotropy)!==void 0?(t=e.renderTargetOptions)===null||t===void 0?void 0:t.anisotropy:1,generateMipmaps:((r=e.renderTargetOptions)===null||r===void 0?void 0:r.generateMipmaps)!==void 0?(i=e.renderTargetOptions)===null||i===void 0?void 0:i.generateMipmaps:!1,magFilter:((s=e.renderTargetOptions)===null||s===void 0?void 0:s.magFilter)!==void 0?(c=e.renderTargetOptions)===null||c===void 0?void 0:c.magFilter:Xe,minFilter:((a=e.renderTargetOptions)===null||a===void 0?void 0:a.minFilter)!==void 0?(u=e.renderTargetOptions)===null||u===void 0?void 0:u.minFilter:Xe,samples:((d=e.renderTargetOptions)===null||d===void 0?void 0:d.samples)!==void 0?(p=e.renderTargetOptions)===null||p===void 0?void 0:p.samples:void 0,wrapS:((f=e.renderTargetOptions)===null||f===void 0?void 0:f.wrapS)!==void 0?(v=e.renderTargetOptions)===null||v===void 0?void 0:v.wrapS:pt,wrapT:((w=e.renderTargetOptions)===null||w===void 0?void 0:w.wrapT)!==void 0?(g=e.renderTargetOptions)===null||g===void 0?void 0:g.wrapT:pt};if(this._material=e.material,e.renderer?this._renderer=e.renderer:(this._renderer=qn.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new Lr,this._camera=new cn,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!ba(this._type,this._renderer,this._camera,E)){let D;switch(this._type){case He:D=this._renderer.extensions.has("EXT_color_buffer_float")?mt:void 0;break}D!==void 0?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${mt}`),this._type=D):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new Jt(new Vn,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new Qt(this.width,this.height,E),this._renderTarget.texture.mapping=((y=e.renderTargetOptions)===null||y===void 0?void 0:y.mapping)!==void 0?(b=e.renderTargetOptions)===null||b===void 0?void 0:b.mapping:Tn}static instantiateRenderer(){const e=new Bs;return e.setSize(128,128),e}toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const e=Xr(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,e),e}toDataTexture(e){const n=new Hs(this.toArray(),this.width,this.height,dn,this._type,e?.mapping||Tn,e?.wrapS||pt,e?.wrapT||pt,e?.magFilter||Xe,e?.minFilter||Xe,e?.anisotropy||1,Hn);return n.generateMipmaps=e?.generateMipmaps!==void 0?e?.generateMipmaps:!1,n}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(e){this.disposeOnDemandRenderer(),e&&this.renderTarget.dispose(),this.material instanceof $t&&Object.values(this.material.uniforms).forEach(n=>{n.value instanceof Lt&&n.value.dispose()}),Object.values(this.material).forEach(n=>{n instanceof Lt&&n.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(e){this._width=e,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(e){this._height=e,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(e){this._renderTarget=e,this._width=e.width,this._height=e.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}const _a=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,xa=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class Ma extends $t{constructor({gamma:e,offsetHdr:n,offsetSdr:t,gainMapMin:r,gainMapMax:i,maxDisplayBoost:s,hdrCapacityMin:c,hdrCapacityMax:a,sdr:u,gainMap:d}){super({name:"GainMapDecoderMaterial",vertexShader:_a,fragmentShader:xa,uniforms:{sdr:{value:u},gainMap:{value:d},gamma:{value:new Q(1/e[0],1/e[1],1/e[2])},offsetHdr:{value:new Q().fromArray(n)},offsetSdr:{value:new Q().fromArray(t)},gainMapMin:{value:new Q().fromArray(r)},gainMapMax:{value:new Q().fromArray(i)},weightFactor:{value:(Math.log2(s)-c)/(a-c)}},blending:Xs,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=s,this._hdrCapacityMin=c,this._hdrCapacityMax=a,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(e){this.uniforms.sdr.value=e}get gainMap(){return this.uniforms.gainMap.value}set gainMap(e){this.uniforms.gainMap.value=e}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(e){this.uniforms.offsetHdr.value.fromArray(e)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(e){this.uniforms.offsetSdr.value.fromArray(e)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(e){this.uniforms.gainMapMin.value.fromArray(e)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(e){this.uniforms.gainMapMax.value.fromArray(e)}get gamma(){const e=this.uniforms.gamma.value;return[1/e.x,1/e.y,1/e.z]}set gamma(e){const n=this.uniforms.gamma.value;n.x=1/e[0],n.y=1/e[1],n.z=1/e[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(e){this._hdrCapacityMin=e,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(e){this._hdrCapacityMax=e,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(e){this._maxDisplayBoost=Math.max(1,Math.min(65504,e)),this.calculateWeight()}calculateWeight(){const e=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,e))}}class Vr extends Error{}class Yr extends Error{}const on=(l,e,n)=>{const t=new RegExp(`${e}="([^"]*)"`,"i").exec(l);if(t)return t[1];const r=new RegExp(`<${e}[^>]*>([\\s\\S]*?)</${e}>`,"i").exec(l);if(r){const i=r[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return i&&i.length===3?i.map(s=>s.replace(/<\/?rdf:li>/g,"")):r[1].trim()}if(n!==void 0)return n;throw new Error(`Can't find ${e} in gainmap metadata`)},Sa=l=>{let e;typeof TextDecoder<"u"?e=new TextDecoder().decode(l):e=l.toString();let n=e.indexOf("<x:xmpmeta");for(;n!==-1;){const t=e.indexOf("x:xmpmeta>",n),r=e.slice(n,t+10);try{const i=on(r,"hdrgm:GainMapMin","0"),s=on(r,"hdrgm:GainMapMax"),c=on(r,"hdrgm:Gamma","1"),a=on(r,"hdrgm:OffsetSDR","0.015625"),u=on(r,"hdrgm:OffsetHDR","0.015625"),d=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(r),p=d?d[1]:"0",f=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(r);if(!f)throw new Error("Incomplete gainmap metadata");const v=f[1];return{gainMapMin:Array.isArray(i)?i.map(w=>parseFloat(w)):[parseFloat(i),parseFloat(i),parseFloat(i)],gainMapMax:Array.isArray(s)?s.map(w=>parseFloat(w)):[parseFloat(s),parseFloat(s),parseFloat(s)],gamma:Array.isArray(c)?c.map(w=>parseFloat(w)):[parseFloat(c),parseFloat(c),parseFloat(c)],offsetSdr:Array.isArray(a)?a.map(w=>parseFloat(w)):[parseFloat(a),parseFloat(a),parseFloat(a)],offsetHdr:Array.isArray(u)?u.map(w=>parseFloat(w)):[parseFloat(u),parseFloat(u),parseFloat(u)],hdrCapacityMin:parseFloat(p),hdrCapacityMax:parseFloat(v)}}catch{}n=e.indexOf("<x:xmpmeta",t)}};class Ra{constructor(e){this.options={debug:e&&e.debug!==void 0?e.debug:!1,extractFII:e&&e.extractFII!==void 0?e.extractFII:!0,extractNonFII:e&&e.extractNonFII!==void 0?e.extractNonFII:!0}}extract(e){return new Promise((n,t)=>{const r=this.options.debug,i=new DataView(e.buffer);if(i.getUint16(0)!==65496){t(new Error("Not a valid jpeg"));return}const s=i.byteLength;let c=2,a=0,u;for(;c<s;){if(++a>250){t(new Error(`Found no marker after ${a} loops `));return}if(i.getUint8(c)!==255){t(new Error(`Not a valid marker at offset 0x${c.toString(16)}, found: 0x${i.getUint8(c).toString(16)}`));return}if(u=i.getUint8(c+1),r&&console.log(`Marker: ${u.toString(16)}`),u===226){r&&console.log("Found APP2 marker (0xffe2)");const d=c+4;if(i.getUint32(d)===1297106432){const p=d+4;let f;if(i.getUint16(p)===18761)f=!1;else if(i.getUint16(p)===19789)f=!0;else{t(new Error("No valid endianness marker found in TIFF header"));return}if(i.getUint16(p+2,!f)!==42){t(new Error("Not valid TIFF data! (no 0x002A marker)"));return}const v=i.getUint32(p+4,!f);if(v<8){t(new Error("Not valid TIFF data! (First offset less than 8)"));return}const w=p+v,g=i.getUint16(w,!f),y=w+2;let b=0;for(let _=y;_<y+12*g;_+=12)i.getUint16(_,!f)===45057&&(b=i.getUint32(_+8,!f));const D=w+2+g*12+4,C=[];for(let _=D;_<D+b*16;_+=16){const T={MPType:i.getUint32(_,!f),size:i.getUint32(_+4,!f),dataOffset:i.getUint32(_+8,!f),dependantImages:i.getUint32(_+12,!f),start:-1,end:-1,isFII:!1};T.dataOffset?(T.start=p+T.dataOffset,T.isFII=!1):(T.start=0,T.isFII=!0),T.end=T.start+T.size,C.push(T)}if(this.options.extractNonFII&&C.length){const _=new Blob([i]),T=[];for(const O of C){if(O.isFII&&!this.options.extractFII)continue;const M=_.slice(O.start,O.end+1,"image/jpeg");T.push(M)}n(T)}}}c+=2+i.getUint16(c+2)}})}}const Ia=async l=>{const e=Sa(l);if(!e)throw new Yr("Gain map XMP metadata not found");const t=await new Ra({extractFII:!0,extractNonFII:!0}).extract(l);if(t.length!==2)throw new Vr("Gain map recovery image not found");return{sdr:new Uint8Array(await t[0].arrayBuffer()),gainMap:new Uint8Array(await t[1].arrayBuffer()),metadata:e}},yr=l=>new Promise((e,n)=>{const t=document.createElement("img");t.onload=()=>{e(t)},t.onerror=r=>{n(r)},t.src=URL.createObjectURL(l)});class qr extends Kn{constructor(e,n){super(n),e&&(this._renderer=e),this._internalLoadingManager=new Zs}setRenderer(e){return this._renderer=e,this}setRenderTargetOptions(e){return this._renderTargetOptions=e,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: An existing WebGL Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");const e=new Ma({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new Lt,sdr:new Lt});return new qn({width:16,height:16,type:He,colorSpace:Hn,material:e,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async render(e,n,t,r){const i=r?new Blob([r],{type:"image/jpeg"}):void 0,s=new Blob([t],{type:"image/jpeg"});let c,a,u=!1;if(typeof createImageBitmap>"u"){const f=await Promise.all([i?yr(i):Promise.resolve(void 0),yr(s)]);a=f[0],c=f[1],u=!0}else{const f=await Promise.all([i?createImageBitmap(i,{imageOrientation:"flipY"}):Promise.resolve(void 0),createImageBitmap(s,{imageOrientation:"flipY"})]);a=f[0],c=f[1]}const d=new Lt(a||new ImageData(2,2),Tn,pt,pt,Xe,or,dn,Gn,1,Hn);d.flipY=u,d.needsUpdate=!0;const p=new Lt(c,Tn,pt,pt,Xe,or,dn,Gn,1,Ks);p.flipY=u,p.needsUpdate=!0,e.width=c.width,e.height=c.height,e.material.gainMap=d,e.material.sdr=p,e.material.gainMapMin=n.gainMapMin,e.material.gainMapMax=n.gainMapMax,e.material.offsetHdr=n.offsetHdr,e.material.offsetSdr=n.offsetSdr,e.material.gamma=n.gamma,e.material.hdrCapacityMin=n.hdrCapacityMin,e.material.hdrCapacityMax=n.hdrCapacityMax,e.material.maxDisplayBoost=Math.pow(2,n.hdrCapacityMax),e.material.needsUpdate=!0,e.render()}}class La extends qr{load([e,n,t],r,i,s){const c=this.prepareQuadRenderer();let a,u,d;const p=async()=>{if(a&&u&&d){try{await this.render(c,d,a,u)}catch(L){this.manager.itemError(e),this.manager.itemError(n),this.manager.itemError(t),typeof s=="function"&&s(L),c.disposeOnDemandRenderer();return}typeof r=="function"&&r(c),this.manager.itemEnd(e),this.manager.itemEnd(n),this.manager.itemEnd(t),c.disposeOnDemandRenderer()}};let f=!0,v=0,w=0,g=!0,y=0,b=0,E=!0,D=0,C=0;const _=()=>{if(typeof i=="function"){const L=v+y+D,N=w+b+C,W=f&&g&&E;i(new ProgressEvent("progress",{lengthComputable:W,loaded:N,total:L}))}};this.manager.itemStart(e),this.manager.itemStart(n),this.manager.itemStart(t);const T=new Nt(this._internalLoadingManager);T.setResponseType("arraybuffer"),T.setRequestHeader(this.requestHeader),T.setPath(this.path),T.setWithCredentials(this.withCredentials),T.load(e,async L=>{if(typeof L=="string")throw new Error("Invalid sdr buffer");a=L,await p()},L=>{f=L.lengthComputable,w=L.loaded,v=L.total,_()},L=>{this.manager.itemError(e),typeof s=="function"&&s(L)});const O=new Nt(this._internalLoadingManager);O.setResponseType("arraybuffer"),O.setRequestHeader(this.requestHeader),O.setPath(this.path),O.setWithCredentials(this.withCredentials),O.load(n,async L=>{if(typeof L=="string")throw new Error("Invalid gainmap buffer");u=L,await p()},L=>{g=L.lengthComputable,b=L.loaded,y=L.total,_()},L=>{this.manager.itemError(n),typeof s=="function"&&s(L)});const M=new Nt(this._internalLoadingManager);return M.setRequestHeader(this.requestHeader),M.setPath(this.path),M.setWithCredentials(this.withCredentials),M.load(t,async L=>{if(typeof L!="string")throw new Error("Invalid metadata string");d=JSON.parse(L),await p()},L=>{E=L.lengthComputable,C=L.loaded,D=L.total,_()},L=>{this.manager.itemError(t),typeof s=="function"&&s(L)}),c}}class Ca extends qr{load(e,n,t,r){const i=this.prepareQuadRenderer(),s=new Nt(this._internalLoadingManager);return s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setPath(this.path),s.setWithCredentials(this.withCredentials),this.manager.itemStart(e),s.load(e,async c=>{if(typeof c=="string")throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const a=new Uint8Array(c);let u,d,p;try{const f=await Ia(a);u=f.sdr,d=f.gainMap,p=f.metadata}catch(f){if(f instanceof Yr||f instanceof Vr)console.warn(`Failure to reconstruct an HDR image from ${e}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),p={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},u=a;else throw f}try{await this.render(i,p,u,d)}catch(f){this.manager.itemError(e),typeof r=="function"&&r(f),i.disposeOnDemandRenderer();return}typeof n=="function"&&n(i),this.manager.itemEnd(e),i.disposeOnDemandRenderer()},t,c=>{this.manager.itemError(e),typeof r=="function"&&r(c)}),i}}const fn={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},$r="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",qt=l=>Array.isArray(l),$n=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function xn({files:l=$n,path:e="",preset:n=void 0,colorSpace:t=void 0,extensions:r}={}){n&&(Qn(n),l=fn[n],e=$r);const i=qt(l),{extension:s,isCubemap:c}=Jn(l),a=er(s);if(!a)throw new Error("useEnvironment: Unrecognized file extension: "+l);const u=Ee(v=>v.gl);I.useLayoutEffect(()=>{if(s!=="webp"&&s!=="jpg"&&s!=="jpeg")return;function v(){En.clear(a,i?[l]:l)}u.domElement.addEventListener("webglcontextlost",v,{once:!0})},[l,u.domElement]);const d=En(a,i?[l]:l,v=>{(s==="webp"||s==="jpg"||s==="jpeg")&&v.setRenderer(u),v.setPath==null||v.setPath(e),r&&r(v)});let p=i?d[0]:d;if(s==="jpg"||s==="jpeg"||s==="webp"){var f;p=(f=p.renderTarget)==null?void 0:f.texture}return p.mapping=c?Vs:Ys,p.colorSpace=t??(c?"srgb":"srgb-linear"),p}const Oa={files:$n,path:"",preset:void 0,extensions:void 0};xn.preload=l=>{const e={...Oa,...l};let{files:n,path:t=""}=e;const{preset:r,extensions:i}=e;r&&(Qn(r),n=fn[r],t=$r);const{extension:s}=Jn(n);if(s==="webp"||s==="jpg"||s==="jpeg")throw new Error("useEnvironment: Preloading gainmaps is not supported");const c=er(s);if(!c)throw new Error("useEnvironment: Unrecognized file extension: "+n);En.preload(c,qt(n)?[n]:n,a=>{a.setPath==null||a.setPath(t),i&&i(a)})};const Da={files:$n,preset:void 0};xn.clear=l=>{const e={...Da,...l};let{files:n}=e;const{preset:t}=e;t&&(Qn(t),n=fn[t]);const{extension:r}=Jn(n),i=er(r);if(!i)throw new Error("useEnvironment: Unrecognized file extension: "+n);En.clear(i,qt(n)?[n]:n)};function Qn(l){if(!(l in fn))throw new Error("Preset must be one of: "+Object.keys(fn).join(", "))}function Jn(l){var e;const n=qt(l)&&l.length===6,t=qt(l)&&l.length===3&&l.some(s=>s.endsWith("json")),r=qt(l)?l[0]:l;return{extension:n?"cube":t?"webp":r.startsWith("data:application/exr")?"exr":r.startsWith("data:application/hdr")?"hdr":r.startsWith("data:image/jpeg")?"jpg":(e=r.split(".").pop())==null||(e=e.split("?"))==null||(e=e.shift())==null?void 0:e.toLowerCase(),isCubemap:n,isGainmap:t}}function er(l){return l==="cube"?qs:l==="hdr"?da:l==="exr"?fa:l==="jpg"||l==="jpeg"?Ca:l==="webp"?La:null}const Na=l=>l.current&&l.current.isScene,Pa=l=>Na(l)?l.current:l;function tr(l,e,n,t,r={}){var i,s,c,a;r={backgroundBlurriness:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...r};const u=Pa(e||n),d=u.background,p=u.environment,f={backgroundBlurriness:u.backgroundBlurriness,backgroundIntensity:u.backgroundIntensity,backgroundRotation:(i=(s=u.backgroundRotation)==null||s.clone==null?void 0:s.clone())!==null&&i!==void 0?i:[0,0,0],environmentIntensity:u.environmentIntensity,environmentRotation:(c=(a=u.environmentRotation)==null||a.clone==null?void 0:a.clone())!==null&&c!==void 0?c:[0,0,0]};return l!=="only"&&(u.environment=t),l&&(u.background=t),cr(u,r),()=>{l!=="only"&&(u.environment=p),l&&(u.background=d),cr(u,f)}}function nr({scene:l,background:e=!1,map:n,...t}){const r=Ee(i=>i.scene);return I.useLayoutEffect(()=>{if(n)return tr(e,l,r,n,t)}),null}function Qr({background:l=!1,scene:e,blur:n,backgroundBlurriness:t,backgroundIntensity:r,backgroundRotation:i,environmentIntensity:s,environmentRotation:c,...a}){const u=xn(a),d=Ee(p=>p.scene);return I.useLayoutEffect(()=>tr(l,e,d,u,{backgroundBlurriness:n??t,backgroundIntensity:r,backgroundRotation:i,environmentIntensity:s,environmentRotation:c})),I.useEffect(()=>()=>{u.dispose()},[u]),null}function ka({children:l,near:e=.1,far:n=1e3,resolution:t=256,frames:r=1,map:i,background:s=!1,blur:c,backgroundBlurriness:a,backgroundIntensity:u,backgroundRotation:d,environmentIntensity:p,environmentRotation:f,scene:v,files:w,path:g,preset:y=void 0,extensions:b}){const E=Ee(M=>M.gl),D=Ee(M=>M.scene),C=I.useRef(null),[_]=I.useState(()=>new Lr),T=I.useMemo(()=>{const M=new $s(t);return M.texture.type=He,M},[t]);I.useEffect(()=>()=>{T.dispose()},[T]),I.useLayoutEffect(()=>{if(r===1){const M=E.autoClear;E.autoClear=!0,C.current.update(E,_),E.autoClear=M}return tr(s,v,D,T.texture,{backgroundBlurriness:c??a,backgroundIntensity:u,backgroundRotation:d,environmentIntensity:p,environmentRotation:f})},[l,_,T.texture,v,D,s,r,E]);let O=1;return en(()=>{if(r===1/0||O<r){const M=E.autoClear;E.autoClear=!0,C.current.update(E,_),E.autoClear=M,O++}}),I.createElement(I.Fragment,null,Qs(I.createElement(I.Fragment,null,l,I.createElement("cubeCamera",{ref:C,args:[e,n,T]}),w||y?I.createElement(Qr,{background:!0,files:w,preset:y,path:g,extensions:b}):i?I.createElement(nr,{background:!0,map:i,extensions:b}):null),_))}function Fa(l){var e,n,t,r;const i=xn(l),s=l.map||i;I.useMemo(()=>Cr({GroundProjectedEnvImpl:vi}),[]),I.useEffect(()=>()=>{i.dispose()},[i]);const c=I.useMemo(()=>[s],[s]),a=(e=l.ground)==null?void 0:e.height,u=(n=l.ground)==null?void 0:n.radius,d=(t=(r=l.ground)==null?void 0:r.scale)!==null&&t!==void 0?t:1e3;return I.createElement(I.Fragment,null,I.createElement(nr,Oe({},l,{map:s})),I.createElement("groundProjectedEnvImpl",{args:c,scale:d,height:a,radius:u}))}function Ua(l){return l.ground?I.createElement(Fa,l):l.map?I.createElement(nr,l):l.children?I.createElement(ka,l):I.createElement(Qr,l)}const Ba=I.forwardRef(({scale:l=10,frames:e=1/0,opacity:n=1,width:t=1,height:r=1,blur:i=1,near:s=0,far:c=10,resolution:a=512,smooth:u=!0,color:d="#000000",depthWrite:p=!1,renderOrder:f,...v},w)=>{const g=I.useRef(null),y=Ee(j=>j.scene),b=Ee(j=>j.gl),E=I.useRef(null);t=t*(Array.isArray(l)?l[0]:l||1),r=r*(Array.isArray(l)?l[1]:l||1);const[D,C,_,T,O,M,L]=I.useMemo(()=>{const j=new Qt(a,a),ee=new Qt(a,a);ee.texture.generateMipmaps=j.texture.generateMipmaps=!1;const $=new Vn(t,r).rotateX(Math.PI/2),ye=new Jt($),me=new Js;me.depthTest=me.depthWrite=!1,me.onBeforeCompile=ue=>{ue.uniforms={...ue.uniforms,ucolor:{value:new st(d)}},ue.fragmentShader=ue.fragmentShader.replace("void main() {",`uniform vec3 ucolor;
           void main() {
          `),ue.fragmentShader=ue.fragmentShader.replace("vec4( vec3( 1.0 - fragCoordZ ), opacity );","vec4( ucolor * fragCoordZ * 2.0, ( 1.0 - fragCoordZ ) * 1.0 );")};const Ae=new $t(ua),J=new $t(ha);return J.depthTest=Ae.depthTest=!1,[j,$,me,ye,Ae,J,ee]},[a,t,r,l,d]),N=j=>{T.visible=!0,T.material=O,O.uniforms.tDiffuse.value=D.texture,O.uniforms.h.value=j*1/256,b.setRenderTarget(L),b.render(T,E.current),T.material=M,M.uniforms.tDiffuse.value=L.texture,M.uniforms.v.value=j*1/256,b.setRenderTarget(D),b.render(T,E.current),T.visible=!1};let W=0,K,Z;return en(()=>{E.current&&(e===1/0||W<e)&&(W++,K=y.background,Z=y.overrideMaterial,g.current.visible=!1,y.background=null,y.overrideMaterial=_,b.setRenderTarget(D),b.render(y,E.current),N(i),u&&N(i*.4),b.setRenderTarget(null),g.current.visible=!0,y.overrideMaterial=Z,y.background=K)}),I.useImperativeHandle(w,()=>g.current,[]),I.createElement("group",Oe({"rotation-x":Math.PI/2},v,{ref:g}),I.createElement("mesh",{renderOrder:f,geometry:C,scale:[1,-1,1],rotation:[-Math.PI/2,0,0]},I.createElement("meshBasicMaterial",{transparent:!0,map:D.texture,opacity:n,depthWrite:p})),I.createElement("orthographicCamera",{ref:E,args:[-t/2,t/2,r/2,-r/2,s,c]}))});function Ha(l){return l.isLight}function Ga(l){return!!l.geometry}const Jr=I.createContext(null),za=Wr({color:new st,blend:2,alphaTest:.75,opacity:0,map:null},`varying vec2 vUv;
   void main() {
     gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);
     vUv = uv;
   }`,`varying vec2 vUv;
   uniform sampler2D map;
   uniform vec3 color;
   uniform float opacity;
   uniform float alphaTest;
   uniform float blend;
   void main() {
     vec4 sampledDiffuseColor = texture2D(map, vUv);
     gl_FragColor = vec4(color * sampledDiffuseColor.r * blend, max(0.0, (1.0 - (sampledDiffuseColor.r + sampledDiffuseColor.g + sampledDiffuseColor.b) / alphaTest)) * opacity);
     #include <tonemapping_fragment>
     #include <${Zr>=154?"colorspace_fragment":"encodings_fragment"}>
   }`),ja=I.forwardRef(({children:l,temporal:e,frames:n=40,limit:t=1/0,blend:r=20,scale:i=10,opacity:s=1,alphaTest:c=.75,color:a="black",colorBlend:u=2,resolution:d=1024,toneMapped:p=!0,...f},v)=>{Cr({SoftShadowMaterial:za});const w=Ee(T=>T.gl),g=Ee(T=>T.scene),y=Ee(T=>T.camera),b=Ee(T=>T.invalidate),E=I.useRef(null),D=I.useRef(null),[C]=I.useState(()=>new Za(w,g,d));I.useLayoutEffect(()=>{C.configure(E.current)},[]);const _=I.useMemo(()=>({lights:new Map,temporal:!!e,frames:Math.max(2,n),blend:Math.max(2,n===1/0?r:n),count:0,getMesh:()=>E.current,reset:()=>{C.clear();const T=E.current.material;T.opacity=0,T.alphaTest=0,_.count=0},update:(T=1)=>{const O=E.current.material;_.temporal?(O.opacity=Math.min(s,O.opacity+s/_.blend),O.alphaTest=Math.min(c,O.alphaTest+c/_.blend)):(O.opacity=s,O.alphaTest=c),D.current.visible=!0,C.prepare();for(let M=0;M<T;M++)_.lights.forEach(L=>L.update()),C.update(y,_.blend);D.current.visible=!1,C.finish()}}),[C,y,g,e,n,r,s,c]);return I.useLayoutEffect(()=>{_.reset(),!_.temporal&&_.frames!==1/0&&_.update(_.blend)}),I.useImperativeHandle(v,()=>_,[_]),en(()=>{(_.temporal||_.frames===1/0)&&_.count<_.frames&&_.count<t&&(b(),_.update(),_.count++)}),I.createElement("group",f,I.createElement("group",{traverse:()=>null,ref:D},I.createElement(Jr.Provider,{value:_},l)),I.createElement("mesh",{receiveShadow:!0,ref:E,scale:i,rotation:[-Math.PI/2,0,0]},I.createElement("planeGeometry",null),I.createElement("softShadowMaterial",{transparent:!0,depthWrite:!1,toneMapped:p,color:a,blend:u,map:C.progressiveLightMap2.texture})))}),Wa=I.forwardRef(({castShadow:l=!0,bias:e=.001,mapSize:n=512,size:t=5,near:r=.5,far:i=500,frames:s=1,position:c=[0,0,0],radius:a=1,amount:u=8,intensity:d=Zr>=155?Math.PI:1,ambient:p=.5,...f},v)=>{const w=I.useRef(null),g=new Q(...c).length(),y=I.useContext(Jr),b=I.useCallback(()=>{let D;if(w.current)for(let C=0;C<w.current.children.length;C++)if(D=w.current.children[C],Math.random()>p)D.position.set(c[0]+un.randFloatSpread(a),c[1]+un.randFloatSpread(a),c[2]+un.randFloatSpread(a));else{let _=Math.acos(2*Math.random()-1)-Math.PI/2,T=2*Math.PI*Math.random();D.position.set(Math.cos(_)*Math.cos(T)*g,Math.abs(Math.cos(_)*Math.sin(T)*g),Math.sin(_)*g)}},[a,p,g,...c]),E=I.useMemo(()=>({update:b}),[b]);return I.useImperativeHandle(v,()=>E,[E]),I.useLayoutEffect(()=>{var D;const C=w.current;return y&&((D=y.lights)==null||D.set(C.uuid,E)),()=>{var _;return void(y==null||(_=y.lights)==null?void 0:_.delete(C.uuid))}},[y,E]),I.createElement("group",Oe({ref:w},f),Array.from({length:u},(D,C)=>I.createElement("directionalLight",{key:C,castShadow:l,"shadow-bias":e,"shadow-mapSize":[n,n],intensity:d/u},I.createElement("orthographicCamera",{attach:"shadow-camera",args:[-t,t,t,-t,r,i]}))))});class Za{constructor(e,n,t=1024){this.renderer=e,this.res=t,this.scene=n,this.buffer1Active=!1,this.lights=[],this.meshes=[],this.object=null,this.clearColor=new st,this.clearAlpha=0;const r={type:He,magFilter:Un,minFilter:Un};this.progressiveLightMap1=new Qt(this.res,this.res,r),this.progressiveLightMap2=new Qt(this.res,this.res,r),this.discardMat=new ya,this.targetMat=new ei({fog:!1}),this.previousShadowMap={value:this.progressiveLightMap1.texture},this.averagingWindow={value:100},this.targetMat.onBeforeCompile=i=>{i.vertexShader=`varying vec2 vUv;
`+i.vertexShader.slice(0,-1)+"vUv = uv; gl_Position = vec4((uv - 0.5) * 2.0, 1.0, 1.0); }";const s=i.fragmentShader.indexOf("void main() {");i.fragmentShader=`varying vec2 vUv;
`+i.fragmentShader.slice(0,s)+`uniform sampler2D previousShadowMap;
	uniform float averagingWindow;
`+i.fragmentShader.slice(s-1,-1)+`
vec3 texelOld = texture2D(previousShadowMap, vUv).rgb;
        gl_FragColor.rgb = mix(texelOld, gl_FragColor.rgb, 1.0/ averagingWindow);
      }`,i.uniforms.previousShadowMap=this.previousShadowMap,i.uniforms.averagingWindow=this.averagingWindow}}clear(){this.renderer.getClearColor(this.clearColor),this.clearAlpha=this.renderer.getClearAlpha(),this.renderer.setClearColor("black",1),this.renderer.setRenderTarget(this.progressiveLightMap1),this.renderer.clear(),this.renderer.setRenderTarget(this.progressiveLightMap2),this.renderer.clear(),this.renderer.setRenderTarget(null),this.renderer.setClearColor(this.clearColor,this.clearAlpha),this.lights=[],this.meshes=[],this.scene.traverse(e=>{Ga(e)?this.meshes.push({object:e,material:e.material}):Ha(e)&&this.lights.push({object:e,intensity:e.intensity})})}prepare(){this.lights.forEach(e=>e.object.intensity=0),this.meshes.forEach(e=>e.object.material=this.discardMat)}finish(){this.lights.forEach(e=>e.object.intensity=e.intensity),this.meshes.forEach(e=>e.object.material=e.material)}configure(e){this.object=e}update(e,n=100){if(!this.object)return;this.averagingWindow.value=n,this.object.material=this.targetMat;const t=this.buffer1Active?this.progressiveLightMap1:this.progressiveLightMap2,r=this.buffer1Active?this.progressiveLightMap2:this.progressiveLightMap1,i=this.scene.background;this.scene.background=null,this.renderer.setRenderTarget(t),this.previousShadowMap.value=r.texture,this.buffer1Active=!this.buffer1Active,this.renderer.render(this.scene,e),this.renderer.setRenderTarget(null),this.scene.background=i}}const Ka={rembrandt:{main:[1,2,1],fill:[-2,-.5,-2]},portrait:{main:[-1,2,.5],fill:[-1,.5,-1.5]},upfront:{main:[0,2,1],fill:[-1,.5,-1.5]},soft:{main:[-2,4,4],fill:[-1,.5,-1.5]}};function Xa({radius:l,adjustCamera:e}){const n=Ea();return I.useEffect(()=>{e&&n.refresh().clip().fit()},[l,e]),null}function so({children:l,center:e,adjustCamera:n=!0,intensity:t=.5,shadows:r="contact",environment:i="city",preset:s="rembrandt",...c}){var a,u,d,p,f,v,w,g;const y=typeof s=="string"?Ka[s]:s,[{radius:b,height:E},D]=I.useState({radius:0,width:0,height:0,depth:0}),C=(a=r?.bias)!==null&&a!==void 0?a:-1e-4,_=(u=r?.normalBias)!==null&&u!==void 0?u:0,T=(d=r?.size)!==null&&d!==void 0?d:1024,O=(p=r?.offset)!==null&&p!==void 0?p:0,M=r==="contact"||r?.type==="contact",L=r==="accumulative"||r?.type==="accumulative",N={...typeof r=="object"?r:{}},W=i?typeof i=="string"?{preset:i}:i:null,K=I.useCallback(Z=>{const{width:j,height:ee,depth:$,boundingSphere:ye}=Z;D({radius:ye.radius,width:j,height:ee,depth:$}),e!=null&&e.onCentered&&e.onCentered(Z)},[]);return I.createElement(I.Fragment,null,I.createElement("ambientLight",{intensity:t/3}),I.createElement("spotLight",{penumbra:1,position:[y.main[0]*b,y.main[1]*b,y.main[2]*b],intensity:t*2,castShadow:!!r,"shadow-bias":C,"shadow-normalBias":_,"shadow-mapSize":T}),I.createElement("pointLight",{position:[y.fill[0]*b,y.fill[1]*b,y.fill[2]*b],intensity:t}),I.createElement(Ta,Oe({fit:!!n,clip:!!n,margin:Number(n),observe:!0},c),I.createElement(Xa,{radius:b,adjustCamera:n}),I.createElement(va,Oe({},e,{position:[0,O/2,0],onCentered:K}),l)),I.createElement("group",{position:[0,-E/2-O/2,0]},M&&I.createElement(Ba,Oe({scale:b*4,far:b,blur:2},N)),L&&I.createElement(ja,Oe({temporal:!0,frames:100,alphaTest:.9,toneMapped:!0,scale:b*4},N),I.createElement(Wa,{amount:(f=N.amount)!==null&&f!==void 0?f:8,radius:(v=N.radius)!==null&&v!==void 0?v:b,ambient:(w=N.ambient)!==null&&w!==void 0?w:.5,intensity:(g=N.intensity)!==null&&g!==void 0?g:1,position:[y.main[0]*b,y.main[1]*b,y.main[2]*b],size:b*4,bias:-C,mapSize:T}))),i&&I.createElement(Ua,W))}export{ja as A,Ta as B,ro as C,to as D,xi as E,eo as G,Ja as M,no as O,Wa as R,so as S,Oe as _,vr as a,va as b,Ba as c,Ua as d,Qr as e,nr as f,ka as g,Jr as h,xn as i,vn as j,_n as k,Zr as l,qa as m,ya as n,Wr as s,$a as t,Ea as u,Yn as v};
